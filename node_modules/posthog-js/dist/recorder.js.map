{"version":3,"file":"recorder.js","sources":["../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb-snapshot/es/rrweb-snapshot.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/utils.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/types/dist/types.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/mutation.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/error-handler.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observer.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/cross-origin-iframe-mirror.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/iframe-manager.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/shadow-dom-manager.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/ext/tslib/tslib.es6.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/ext/base64-arraybuffer/dist/base64-arraybuffer.es5.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/serialize-args.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/canvas.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/webgl.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/_virtual/_rollup-plugin-web-worker-loader__helper__browser__createBase64WorkerFactory.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/_virtual/image-bitmap-data-url-worker.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/index.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/canvas-manager.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/observers/canvas/2d.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/stylesheet-manager.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/record/processed-node-manager.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/error-stack-parser.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/stringify.js","../node_modules/.pnpm/rrweb@2.0.0-alpha.11_patch_hash=ldhsspyvwscjgedotm5w5frkg4/node_modules/rrweb/es/rrweb/packages/rrweb/src/plugins/console/record/index.js","../src/utils/type-utils.ts","../src/utils/globals.ts","../src/utils/logger.ts","../src/utils/index.ts","../src/utils/request-utils.ts","../src/extensions/replay/config.ts","../src/loader-recorder.ts"],"sourcesContent":["var NodeType;\r\n(function (NodeType) {\r\n    NodeType[NodeType[\"Document\"] = 0] = \"Document\";\r\n    NodeType[NodeType[\"DocumentType\"] = 1] = \"DocumentType\";\r\n    NodeType[NodeType[\"Element\"] = 2] = \"Element\";\r\n    NodeType[NodeType[\"Text\"] = 3] = \"Text\";\r\n    NodeType[NodeType[\"CDATA\"] = 4] = \"CDATA\";\r\n    NodeType[NodeType[\"Comment\"] = 5] = \"Comment\";\r\n})(NodeType || (NodeType = {}));\n\nfunction isElement(n) {\r\n    return n.nodeType === n.ELEMENT_NODE;\r\n}\r\nfunction isShadowRoot(n) {\r\n    var host = n === null || n === void 0 ? void 0 : n.host;\r\n    return Boolean((host === null || host === void 0 ? void 0 : host.shadowRoot) === n);\r\n}\r\nfunction isNativeShadowDom(shadowRoot) {\r\n    return Object.prototype.toString.call(shadowRoot) === '[object ShadowRoot]';\r\n}\r\nfunction fixBrowserCompatibilityIssuesInCSS(cssText) {\r\n    if (cssText.includes(' background-clip: text;') &&\r\n        !cssText.includes(' -webkit-background-clip: text;')) {\r\n        cssText = cssText.replace(' background-clip: text;', ' -webkit-background-clip: text; background-clip: text;');\r\n    }\r\n    return cssText;\r\n}\r\nfunction escapeImportStatement(rule) {\r\n    var cssText = rule.cssText;\r\n    if (cssText.split('\"').length < 3)\r\n        return cssText;\r\n    var statement = ['@import', \"url(\".concat(JSON.stringify(rule.href), \")\")];\r\n    if (rule.layerName === '') {\r\n        statement.push(\"layer\");\r\n    }\r\n    else if (rule.layerName) {\r\n        statement.push(\"layer(\".concat(rule.layerName, \")\"));\r\n    }\r\n    if (rule.supportsText) {\r\n        statement.push(\"supports(\".concat(rule.supportsText, \")\"));\r\n    }\r\n    if (rule.media.length) {\r\n        statement.push(rule.media.mediaText);\r\n    }\r\n    return statement.join(' ') + ';';\r\n}\r\nfunction stringifyStylesheet(s) {\r\n    try {\r\n        var rules = s.rules || s.cssRules;\r\n        return rules\r\n            ? fixBrowserCompatibilityIssuesInCSS(Array.from(rules).map(stringifyRule).join(''))\r\n            : null;\r\n    }\r\n    catch (error) {\r\n        return null;\r\n    }\r\n}\r\nfunction stringifyRule(rule) {\r\n    var importStringified;\r\n    if (isCSSImportRule(rule)) {\r\n        try {\r\n            importStringified =\r\n                stringifyStylesheet(rule.styleSheet) ||\r\n                    escapeImportStatement(rule);\r\n        }\r\n        catch (error) {\r\n        }\r\n    }\r\n    return validateStringifiedCssRule(importStringified || rule.cssText);\r\n}\r\nfunction validateStringifiedCssRule(cssStringified) {\r\n    if (cssStringified.includes(':')) {\r\n        var regex = /(\\[(?:[\\w-]+)[^\\\\])(:(?:[\\w-]+)\\])/gm;\r\n        return cssStringified.replace(regex, '$1\\\\$2');\r\n    }\r\n    return cssStringified;\r\n}\r\nfunction isCSSImportRule(rule) {\r\n    return 'styleSheet' in rule;\r\n}\r\nvar Mirror = (function () {\r\n    function Mirror() {\r\n        this.idNodeMap = new Map();\r\n        this.nodeMetaMap = new WeakMap();\r\n    }\r\n    Mirror.prototype.getId = function (n) {\r\n        var _a;\r\n        if (!n)\r\n            return -1;\r\n        var id = (_a = this.getMeta(n)) === null || _a === void 0 ? void 0 : _a.id;\r\n        return id !== null && id !== void 0 ? id : -1;\r\n    };\r\n    Mirror.prototype.getNode = function (id) {\r\n        return this.idNodeMap.get(id) || null;\r\n    };\r\n    Mirror.prototype.getIds = function () {\r\n        return Array.from(this.idNodeMap.keys());\r\n    };\r\n    Mirror.prototype.getMeta = function (n) {\r\n        return this.nodeMetaMap.get(n) || null;\r\n    };\r\n    Mirror.prototype.removeNodeFromMap = function (n) {\r\n        var _this = this;\r\n        var id = this.getId(n);\r\n        this.idNodeMap[\"delete\"](id);\r\n        if (n.childNodes) {\r\n            n.childNodes.forEach(function (childNode) {\r\n                return _this.removeNodeFromMap(childNode);\r\n            });\r\n        }\r\n    };\r\n    Mirror.prototype.has = function (id) {\r\n        return this.idNodeMap.has(id);\r\n    };\r\n    Mirror.prototype.hasNode = function (node) {\r\n        return this.nodeMetaMap.has(node);\r\n    };\r\n    Mirror.prototype.add = function (n, meta) {\r\n        var id = meta.id;\r\n        this.idNodeMap.set(id, n);\r\n        this.nodeMetaMap.set(n, meta);\r\n    };\r\n    Mirror.prototype.replace = function (id, n) {\r\n        var oldNode = this.getNode(id);\r\n        if (oldNode) {\r\n            var meta = this.nodeMetaMap.get(oldNode);\r\n            if (meta)\r\n                this.nodeMetaMap.set(n, meta);\r\n        }\r\n        this.idNodeMap.set(id, n);\r\n    };\r\n    Mirror.prototype.reset = function () {\r\n        this.idNodeMap = new Map();\r\n        this.nodeMetaMap = new WeakMap();\r\n    };\r\n    return Mirror;\r\n}());\r\nfunction createMirror() {\r\n    return new Mirror();\r\n}\r\nfunction maskInputValue(_a) {\r\n    var element = _a.element, maskInputOptions = _a.maskInputOptions, tagName = _a.tagName, type = _a.type, value = _a.value, maskInputFn = _a.maskInputFn;\r\n    var text = value || '';\r\n    var actualType = type && toLowerCase(type);\r\n    if (maskInputOptions[tagName.toLowerCase()] ||\r\n        (actualType && maskInputOptions[actualType])) {\r\n        if (maskInputFn) {\r\n            text = maskInputFn(text, element);\r\n        }\r\n        else {\r\n            text = '*'.repeat(text.length);\r\n        }\r\n    }\r\n    return text;\r\n}\r\nfunction toLowerCase(str) {\r\n    return str.toLowerCase();\r\n}\r\nvar ORIGINAL_ATTRIBUTE_NAME = '__rrweb_original__';\r\nfunction is2DCanvasBlank(canvas) {\r\n    var ctx = canvas.getContext('2d');\r\n    if (!ctx)\r\n        return true;\r\n    var chunkSize = 50;\r\n    for (var x = 0; x < canvas.width; x += chunkSize) {\r\n        for (var y = 0; y < canvas.height; y += chunkSize) {\r\n            var getImageData = ctx.getImageData;\r\n            var originalGetImageData = ORIGINAL_ATTRIBUTE_NAME in getImageData\r\n                ? getImageData[ORIGINAL_ATTRIBUTE_NAME]\r\n                : getImageData;\r\n            var pixelBuffer = new Uint32Array(originalGetImageData.call(ctx, x, y, Math.min(chunkSize, canvas.width - x), Math.min(chunkSize, canvas.height - y)).data.buffer);\r\n            if (pixelBuffer.some(function (pixel) { return pixel !== 0; }))\r\n                return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction isNodeMetaEqual(a, b) {\r\n    if (!a || !b || a.type !== b.type)\r\n        return false;\r\n    if (a.type === NodeType.Document)\r\n        return a.compatMode === b.compatMode;\r\n    else if (a.type === NodeType.DocumentType)\r\n        return (a.name === b.name &&\r\n            a.publicId === b.publicId &&\r\n            a.systemId === b.systemId);\r\n    else if (a.type === NodeType.Comment ||\r\n        a.type === NodeType.Text ||\r\n        a.type === NodeType.CDATA)\r\n        return a.textContent === b.textContent;\r\n    else if (a.type === NodeType.Element)\r\n        return (a.tagName === b.tagName &&\r\n            JSON.stringify(a.attributes) ===\r\n                JSON.stringify(b.attributes) &&\r\n            a.isSVG === b.isSVG &&\r\n            a.needBlock === b.needBlock);\r\n    return false;\r\n}\r\nfunction getInputType(element) {\r\n    var type = element.type;\r\n    return element.hasAttribute('data-rr-is-password')\r\n        ? 'password'\r\n        : type\r\n            ?\r\n                toLowerCase(type)\r\n            : null;\r\n}\n\nvar _id = 1;\r\nvar tagNameRegex = new RegExp('[^a-z0-9-_:]');\r\nvar IGNORED_NODE = -2;\r\nfunction genId() {\r\n    return _id++;\r\n}\r\nfunction getValidTagName(element) {\r\n    if (element instanceof HTMLFormElement) {\r\n        return 'form';\r\n    }\r\n    var processedTagName = toLowerCase(element.tagName);\r\n    if (tagNameRegex.test(processedTagName)) {\r\n        return 'div';\r\n    }\r\n    return processedTagName;\r\n}\r\nfunction extractOrigin(url) {\r\n    var origin = '';\r\n    if (url.indexOf('//') > -1) {\r\n        origin = url.split('/').slice(0, 3).join('/');\r\n    }\r\n    else {\r\n        origin = url.split('/')[0];\r\n    }\r\n    origin = origin.split('?')[0];\r\n    return origin;\r\n}\r\nvar canvasService;\r\nvar canvasCtx;\r\nvar URL_IN_CSS_REF = /url\\((?:(')([^']*)'|(\")(.*?)\"|([^)]*))\\)/gm;\r\nvar URL_PROTOCOL_MATCH = /^(?:[a-z+]+:)?\\/\\//i;\r\nvar URL_WWW_MATCH = /^www\\..*/i;\r\nvar DATA_URI = /^(data:)([^,]*),(.*)/i;\r\nfunction absoluteToStylesheet(cssText, href) {\r\n    return (cssText || '').replace(URL_IN_CSS_REF, function (origin, quote1, path1, quote2, path2, path3) {\r\n        var filePath = path1 || path2 || path3;\r\n        var maybeQuote = quote1 || quote2 || '';\r\n        if (!filePath) {\r\n            return origin;\r\n        }\r\n        if (URL_PROTOCOL_MATCH.test(filePath) || URL_WWW_MATCH.test(filePath)) {\r\n            return \"url(\".concat(maybeQuote).concat(filePath).concat(maybeQuote, \")\");\r\n        }\r\n        if (DATA_URI.test(filePath)) {\r\n            return \"url(\".concat(maybeQuote).concat(filePath).concat(maybeQuote, \")\");\r\n        }\r\n        if (filePath[0] === '/') {\r\n            return \"url(\".concat(maybeQuote).concat(extractOrigin(href) + filePath).concat(maybeQuote, \")\");\r\n        }\r\n        var stack = href.split('/');\r\n        var parts = filePath.split('/');\r\n        stack.pop();\r\n        for (var _i = 0, parts_1 = parts; _i < parts_1.length; _i++) {\r\n            var part = parts_1[_i];\r\n            if (part === '.') {\r\n                continue;\r\n            }\r\n            else if (part === '..') {\r\n                stack.pop();\r\n            }\r\n            else {\r\n                stack.push(part);\r\n            }\r\n        }\r\n        return \"url(\".concat(maybeQuote).concat(stack.join('/')).concat(maybeQuote, \")\");\r\n    });\r\n}\r\nvar SRCSET_NOT_SPACES = /^[^ \\t\\n\\r\\u000c]+/;\r\nvar SRCSET_COMMAS_OR_SPACES = /^[, \\t\\n\\r\\u000c]+/;\r\nfunction getAbsoluteSrcsetString(doc, attributeValue) {\r\n    if (attributeValue.trim() === '') {\r\n        return attributeValue;\r\n    }\r\n    var pos = 0;\r\n    function collectCharacters(regEx) {\r\n        var chars;\r\n        var match = regEx.exec(attributeValue.substring(pos));\r\n        if (match) {\r\n            chars = match[0];\r\n            pos += chars.length;\r\n            return chars;\r\n        }\r\n        return '';\r\n    }\r\n    var output = [];\r\n    while (true) {\r\n        collectCharacters(SRCSET_COMMAS_OR_SPACES);\r\n        if (pos >= attributeValue.length) {\r\n            break;\r\n        }\r\n        var url = collectCharacters(SRCSET_NOT_SPACES);\r\n        if (url.slice(-1) === ',') {\r\n            url = absoluteToDoc(doc, url.substring(0, url.length - 1));\r\n            output.push(url);\r\n        }\r\n        else {\r\n            var descriptorsStr = '';\r\n            url = absoluteToDoc(doc, url);\r\n            var inParens = false;\r\n            while (true) {\r\n                var c = attributeValue.charAt(pos);\r\n                if (c === '') {\r\n                    output.push((url + descriptorsStr).trim());\r\n                    break;\r\n                }\r\n                else if (!inParens) {\r\n                    if (c === ',') {\r\n                        pos += 1;\r\n                        output.push((url + descriptorsStr).trim());\r\n                        break;\r\n                    }\r\n                    else if (c === '(') {\r\n                        inParens = true;\r\n                    }\r\n                }\r\n                else {\r\n                    if (c === ')') {\r\n                        inParens = false;\r\n                    }\r\n                }\r\n                descriptorsStr += c;\r\n                pos += 1;\r\n            }\r\n        }\r\n    }\r\n    return output.join(', ');\r\n}\r\nfunction absoluteToDoc(doc, attributeValue) {\r\n    if (!attributeValue || attributeValue.trim() === '') {\r\n        return attributeValue;\r\n    }\r\n    var a = doc.createElement('a');\r\n    a.href = attributeValue;\r\n    return a.href;\r\n}\r\nfunction isSVGElement(el) {\r\n    return Boolean(el.tagName === 'svg' || el.ownerSVGElement);\r\n}\r\nfunction getHref() {\r\n    var a = document.createElement('a');\r\n    a.href = '';\r\n    return a.href;\r\n}\r\nfunction transformAttribute(doc, tagName, name, value) {\r\n    if (!value) {\r\n        return value;\r\n    }\r\n    if (name === 'src' ||\r\n        (name === 'href' && !(tagName === 'use' && value[0] === '#'))) {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'xlink:href' && value[0] !== '#') {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'background' &&\r\n        (tagName === 'table' || tagName === 'td' || tagName === 'th')) {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    else if (name === 'srcset') {\r\n        return getAbsoluteSrcsetString(doc, value);\r\n    }\r\n    else if (name === 'style') {\r\n        return absoluteToStylesheet(value, getHref());\r\n    }\r\n    else if (tagName === 'object' && name === 'data') {\r\n        return absoluteToDoc(doc, value);\r\n    }\r\n    return value;\r\n}\r\nfunction ignoreAttribute(tagName, name, _value) {\r\n    return (tagName === 'video' || tagName === 'audio') && name === 'autoplay';\r\n}\r\nfunction _isBlockedElement(element, blockClass, blockSelector) {\r\n    try {\r\n        if (typeof blockClass === 'string') {\r\n            if (element.classList.contains(blockClass)) {\r\n                return true;\r\n            }\r\n        }\r\n        else {\r\n            for (var eIndex = element.classList.length; eIndex--;) {\r\n                var className = element.classList[eIndex];\r\n                if (blockClass.test(className)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        if (blockSelector) {\r\n            return element.matches(blockSelector);\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    return false;\r\n}\r\nfunction classMatchesRegex(node, regex, checkAncestors) {\r\n    if (!node)\r\n        return false;\r\n    if (node.nodeType !== node.ELEMENT_NODE) {\r\n        if (!checkAncestors)\r\n            return false;\r\n        return classMatchesRegex(node.parentNode, regex, checkAncestors);\r\n    }\r\n    for (var eIndex = node.classList.length; eIndex--;) {\r\n        var className = node.classList[eIndex];\r\n        if (regex.test(className)) {\r\n            return true;\r\n        }\r\n    }\r\n    if (!checkAncestors)\r\n        return false;\r\n    return classMatchesRegex(node.parentNode, regex, checkAncestors);\r\n}\r\nfunction needMaskingText(node, maskTextClass, maskTextSelector) {\r\n    try {\r\n        var el = node.nodeType === node.ELEMENT_NODE\r\n            ? node\r\n            : node.parentElement;\r\n        if (el === null)\r\n            return false;\r\n        if (typeof maskTextClass === 'string') {\r\n            if (el.classList.contains(maskTextClass))\r\n                return true;\r\n            if (el.closest(\".\".concat(maskTextClass)))\r\n                return true;\r\n        }\r\n        else {\r\n            if (classMatchesRegex(el, maskTextClass, true))\r\n                return true;\r\n        }\r\n        if (maskTextSelector) {\r\n            if (el.matches(maskTextSelector))\r\n                return true;\r\n            if (el.closest(maskTextSelector))\r\n                return true;\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    return false;\r\n}\r\nfunction onceIframeLoaded(iframeEl, listener, iframeLoadTimeout) {\r\n    var win = iframeEl.contentWindow;\r\n    if (!win) {\r\n        return;\r\n    }\r\n    var fired = false;\r\n    var readyState;\r\n    try {\r\n        readyState = win.document.readyState;\r\n    }\r\n    catch (error) {\r\n        return;\r\n    }\r\n    if (readyState !== 'complete') {\r\n        var timer_1 = setTimeout(function () {\r\n            if (!fired) {\r\n                listener();\r\n                fired = true;\r\n            }\r\n        }, iframeLoadTimeout);\r\n        iframeEl.addEventListener('load', function () {\r\n            clearTimeout(timer_1);\r\n            fired = true;\r\n            listener();\r\n        });\r\n        return;\r\n    }\r\n    var blankUrl = 'about:blank';\r\n    if (win.location.href !== blankUrl ||\r\n        iframeEl.src === blankUrl ||\r\n        iframeEl.src === '') {\r\n        setTimeout(listener, 0);\r\n        return iframeEl.addEventListener('load', listener);\r\n    }\r\n    iframeEl.addEventListener('load', listener);\r\n}\r\nfunction onceStylesheetLoaded(link, listener, styleSheetLoadTimeout) {\r\n    var fired = false;\r\n    var styleSheetLoaded;\r\n    try {\r\n        styleSheetLoaded = link.sheet;\r\n    }\r\n    catch (error) {\r\n        return;\r\n    }\r\n    if (styleSheetLoaded)\r\n        return;\r\n    var timer = setTimeout(function () {\r\n        if (!fired) {\r\n            listener();\r\n            fired = true;\r\n        }\r\n    }, styleSheetLoadTimeout);\r\n    link.addEventListener('load', function () {\r\n        clearTimeout(timer);\r\n        fired = true;\r\n        listener();\r\n    });\r\n}\r\nfunction serializeNode(n, options) {\r\n    var doc = options.doc, mirror = options.mirror, blockClass = options.blockClass, blockSelector = options.blockSelector, maskTextClass = options.maskTextClass, maskTextSelector = options.maskTextSelector, inlineStylesheet = options.inlineStylesheet, _a = options.maskInputOptions, maskInputOptions = _a === void 0 ? {} : _a, maskTextFn = options.maskTextFn, maskInputFn = options.maskInputFn, _b = options.dataURLOptions, dataURLOptions = _b === void 0 ? {} : _b, inlineImages = options.inlineImages, recordCanvas = options.recordCanvas, keepIframeSrcFn = options.keepIframeSrcFn, _c = options.newlyAddedElement, newlyAddedElement = _c === void 0 ? false : _c;\r\n    var rootId = getRootId(doc, mirror);\r\n    switch (n.nodeType) {\r\n        case n.DOCUMENT_NODE:\r\n            if (n.compatMode !== 'CSS1Compat') {\r\n                return {\r\n                    type: NodeType.Document,\r\n                    childNodes: [],\r\n                    compatMode: n.compatMode\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    type: NodeType.Document,\r\n                    childNodes: []\r\n                };\r\n            }\r\n        case n.DOCUMENT_TYPE_NODE:\r\n            return {\r\n                type: NodeType.DocumentType,\r\n                name: n.name,\r\n                publicId: n.publicId,\r\n                systemId: n.systemId,\r\n                rootId: rootId\r\n            };\r\n        case n.ELEMENT_NODE:\r\n            return serializeElementNode(n, {\r\n                doc: doc,\r\n                blockClass: blockClass,\r\n                blockSelector: blockSelector,\r\n                inlineStylesheet: inlineStylesheet,\r\n                maskInputOptions: maskInputOptions,\r\n                maskInputFn: maskInputFn,\r\n                dataURLOptions: dataURLOptions,\r\n                inlineImages: inlineImages,\r\n                recordCanvas: recordCanvas,\r\n                keepIframeSrcFn: keepIframeSrcFn,\r\n                newlyAddedElement: newlyAddedElement,\r\n                rootId: rootId\r\n            });\r\n        case n.TEXT_NODE:\r\n            return serializeTextNode(n, {\r\n                maskTextClass: maskTextClass,\r\n                maskTextSelector: maskTextSelector,\r\n                maskTextFn: maskTextFn,\r\n                rootId: rootId\r\n            });\r\n        case n.CDATA_SECTION_NODE:\r\n            return {\r\n                type: NodeType.CDATA,\r\n                textContent: '',\r\n                rootId: rootId\r\n            };\r\n        case n.COMMENT_NODE:\r\n            return {\r\n                type: NodeType.Comment,\r\n                textContent: n.textContent || '',\r\n                rootId: rootId\r\n            };\r\n        default:\r\n            return false;\r\n    }\r\n}\r\nfunction getRootId(doc, mirror) {\r\n    if (!mirror.hasNode(doc))\r\n        return undefined;\r\n    var docId = mirror.getId(doc);\r\n    return docId === 1 ? undefined : docId;\r\n}\r\nfunction serializeTextNode(n, options) {\r\n    var _a;\r\n    var maskTextClass = options.maskTextClass, maskTextSelector = options.maskTextSelector, maskTextFn = options.maskTextFn, rootId = options.rootId;\r\n    var parentTagName = n.parentNode && n.parentNode.tagName;\r\n    var textContent = n.textContent;\r\n    var isStyle = parentTagName === 'STYLE' ? true : undefined;\r\n    var isScript = parentTagName === 'SCRIPT' ? true : undefined;\r\n    if (isStyle && textContent) {\r\n        try {\r\n            if (n.nextSibling || n.previousSibling) {\r\n            }\r\n            else if ((_a = n.parentNode.sheet) === null || _a === void 0 ? void 0 : _a.cssRules) {\r\n                textContent = stringifyStylesheet(n.parentNode.sheet);\r\n            }\r\n        }\r\n        catch (err) {\r\n            console.warn(\"Cannot get CSS styles from text's parentNode. Error: \".concat(err), n);\r\n        }\r\n        textContent = absoluteToStylesheet(textContent, getHref());\r\n    }\r\n    if (isScript) {\r\n        textContent = 'SCRIPT_PLACEHOLDER';\r\n    }\r\n    if (!isStyle &&\r\n        !isScript &&\r\n        textContent &&\r\n        needMaskingText(n, maskTextClass, maskTextSelector)) {\r\n        textContent = maskTextFn\r\n            ? maskTextFn(textContent)\r\n            : textContent.replace(/[\\S]/g, '*');\r\n    }\r\n    return {\r\n        type: NodeType.Text,\r\n        textContent: textContent || '',\r\n        isStyle: isStyle,\r\n        rootId: rootId\r\n    };\r\n}\r\nfunction serializeElementNode(n, options) {\r\n    var doc = options.doc, blockClass = options.blockClass, blockSelector = options.blockSelector, inlineStylesheet = options.inlineStylesheet, _a = options.maskInputOptions, maskInputOptions = _a === void 0 ? {} : _a, maskInputFn = options.maskInputFn, _b = options.dataURLOptions, dataURLOptions = _b === void 0 ? {} : _b, inlineImages = options.inlineImages, recordCanvas = options.recordCanvas, keepIframeSrcFn = options.keepIframeSrcFn, _c = options.newlyAddedElement, newlyAddedElement = _c === void 0 ? false : _c, rootId = options.rootId;\r\n    var needBlock = _isBlockedElement(n, blockClass, blockSelector);\r\n    var tagName = getValidTagName(n);\r\n    var attributes = {};\r\n    var len = n.attributes.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var attr = n.attributes[i];\r\n        if (!ignoreAttribute(tagName, attr.name, attr.value)) {\r\n            attributes[attr.name] = transformAttribute(doc, tagName, toLowerCase(attr.name), attr.value);\r\n        }\r\n    }\r\n    if (tagName === 'link' && inlineStylesheet) {\r\n        var stylesheet = Array.from(doc.styleSheets).find(function (s) {\r\n            return s.href === n.href;\r\n        });\r\n        var cssText = null;\r\n        if (stylesheet) {\r\n            cssText = stringifyStylesheet(stylesheet);\r\n        }\r\n        if (cssText) {\r\n            delete attributes.rel;\r\n            delete attributes.href;\r\n            attributes._cssText = absoluteToStylesheet(cssText, stylesheet.href);\r\n        }\r\n    }\r\n    if (tagName === 'style' &&\r\n        n.sheet &&\r\n        !(n.innerText || n.textContent || '').trim().length) {\r\n        var cssText = stringifyStylesheet(n.sheet);\r\n        if (cssText) {\r\n            attributes._cssText = absoluteToStylesheet(cssText, getHref());\r\n        }\r\n    }\r\n    if (tagName === 'input' || tagName === 'textarea' || tagName === 'select') {\r\n        var value = n.value;\r\n        var checked = n.checked;\r\n        if (attributes.type !== 'radio' &&\r\n            attributes.type !== 'checkbox' &&\r\n            attributes.type !== 'submit' &&\r\n            attributes.type !== 'button' &&\r\n            value) {\r\n            var type = getInputType(n);\r\n            attributes.value = maskInputValue({\r\n                element: n,\r\n                type: type,\r\n                tagName: tagName,\r\n                value: value,\r\n                maskInputOptions: maskInputOptions,\r\n                maskInputFn: maskInputFn\r\n            });\r\n        }\r\n        else if (checked) {\r\n            attributes.checked = checked;\r\n        }\r\n    }\r\n    if (tagName === 'option') {\r\n        if (n.selected && !maskInputOptions['select']) {\r\n            attributes.selected = true;\r\n        }\r\n        else {\r\n            delete attributes.selected;\r\n        }\r\n    }\r\n    if (tagName === 'canvas' && recordCanvas) {\r\n        if (n.__context === '2d') {\r\n            if (!is2DCanvasBlank(n)) {\r\n                attributes.rr_dataURL = n.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            }\r\n        }\r\n        else if (!('__context' in n)) {\r\n            var canvasDataURL = n.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            var blankCanvas = document.createElement('canvas');\r\n            blankCanvas.width = n.width;\r\n            blankCanvas.height = n.height;\r\n            var blankCanvasDataURL = blankCanvas.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            if (canvasDataURL !== blankCanvasDataURL) {\r\n                attributes.rr_dataURL = canvasDataURL;\r\n            }\r\n        }\r\n    }\r\n    if (tagName === 'img' && inlineImages) {\r\n        if (!canvasService) {\r\n            canvasService = doc.createElement('canvas');\r\n            canvasCtx = canvasService.getContext('2d');\r\n        }\r\n        var image_1 = n;\r\n        var oldValue_1 = image_1.crossOrigin;\r\n        image_1.crossOrigin = 'anonymous';\r\n        var recordInlineImage_1 = function () {\r\n            image_1.removeEventListener('load', recordInlineImage_1);\r\n            try {\r\n                canvasService.width = image_1.naturalWidth;\r\n                canvasService.height = image_1.naturalHeight;\r\n                canvasCtx.drawImage(image_1, 0, 0);\r\n                attributes.rr_dataURL = canvasService.toDataURL(dataURLOptions.type, dataURLOptions.quality);\r\n            }\r\n            catch (err) {\r\n                console.warn(\"Cannot inline img src=\".concat(image_1.currentSrc, \"! Error: \").concat(err));\r\n            }\r\n            oldValue_1\r\n                ? (attributes.crossOrigin = oldValue_1)\r\n                : image_1.removeAttribute('crossorigin');\r\n        };\r\n        if (image_1.complete && image_1.naturalWidth !== 0)\r\n            recordInlineImage_1();\r\n        else\r\n            image_1.addEventListener('load', recordInlineImage_1);\r\n    }\r\n    if (tagName === 'audio' || tagName === 'video') {\r\n        attributes.rr_mediaState = n.paused\r\n            ? 'paused'\r\n            : 'played';\r\n        attributes.rr_mediaCurrentTime = n.currentTime;\r\n    }\r\n    if (!newlyAddedElement) {\r\n        if (n.scrollLeft) {\r\n            attributes.rr_scrollLeft = n.scrollLeft;\r\n        }\r\n        if (n.scrollTop) {\r\n            attributes.rr_scrollTop = n.scrollTop;\r\n        }\r\n    }\r\n    if (needBlock) {\r\n        var _d = n.getBoundingClientRect(), width = _d.width, height = _d.height;\r\n        attributes = {\r\n            \"class\": attributes[\"class\"],\r\n            rr_width: \"\".concat(width, \"px\"),\r\n            rr_height: \"\".concat(height, \"px\")\r\n        };\r\n    }\r\n    if (tagName === 'iframe' && !keepIframeSrcFn(attributes.src)) {\r\n        if (!n.contentDocument) {\r\n            attributes.rr_src = attributes.src;\r\n        }\r\n        delete attributes.src;\r\n    }\r\n    return {\r\n        type: NodeType.Element,\r\n        tagName: tagName,\r\n        attributes: attributes,\r\n        childNodes: [],\r\n        isSVG: isSVGElement(n) || undefined,\r\n        needBlock: needBlock,\r\n        rootId: rootId\r\n    };\r\n}\r\nfunction lowerIfExists(maybeAttr) {\r\n    if (maybeAttr === undefined || maybeAttr === null) {\r\n        return '';\r\n    }\r\n    else {\r\n        return maybeAttr.toLowerCase();\r\n    }\r\n}\r\nfunction slimDOMExcluded(sn, slimDOMOptions) {\r\n    if (slimDOMOptions.comment && sn.type === NodeType.Comment) {\r\n        return true;\r\n    }\r\n    else if (sn.type === NodeType.Element) {\r\n        if (slimDOMOptions.script &&\r\n            (sn.tagName === 'script' ||\r\n                (sn.tagName === 'link' &&\r\n                    (sn.attributes.rel === 'preload' ||\r\n                        sn.attributes.rel === 'modulepreload') &&\r\n                    sn.attributes.as === 'script') ||\r\n                (sn.tagName === 'link' &&\r\n                    sn.attributes.rel === 'prefetch' &&\r\n                    typeof sn.attributes.href === 'string' &&\r\n                    sn.attributes.href.endsWith('.js')))) {\r\n            return true;\r\n        }\r\n        else if (slimDOMOptions.headFavicon &&\r\n            ((sn.tagName === 'link' && sn.attributes.rel === 'shortcut icon') ||\r\n                (sn.tagName === 'meta' &&\r\n                    (lowerIfExists(sn.attributes.name).match(/^msapplication-tile(image|color)$/) ||\r\n                        lowerIfExists(sn.attributes.name) === 'application-name' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'icon' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'apple-touch-icon' ||\r\n                        lowerIfExists(sn.attributes.rel) === 'shortcut icon')))) {\r\n            return true;\r\n        }\r\n        else if (sn.tagName === 'meta') {\r\n            if (slimDOMOptions.headMetaDescKeywords &&\r\n                lowerIfExists(sn.attributes.name).match(/^description|keywords$/)) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaSocial &&\r\n                (lowerIfExists(sn.attributes.property).match(/^(og|twitter|fb):/) ||\r\n                    lowerIfExists(sn.attributes.name).match(/^(og|twitter):/) ||\r\n                    lowerIfExists(sn.attributes.name) === 'pinterest')) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaRobots &&\r\n                (lowerIfExists(sn.attributes.name) === 'robots' ||\r\n                    lowerIfExists(sn.attributes.name) === 'googlebot' ||\r\n                    lowerIfExists(sn.attributes.name) === 'bingbot')) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaHttpEquiv &&\r\n                sn.attributes['http-equiv'] !== undefined) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaAuthorship &&\r\n                (lowerIfExists(sn.attributes.name) === 'author' ||\r\n                    lowerIfExists(sn.attributes.name) === 'generator' ||\r\n                    lowerIfExists(sn.attributes.name) === 'framework' ||\r\n                    lowerIfExists(sn.attributes.name) === 'publisher' ||\r\n                    lowerIfExists(sn.attributes.name) === 'progid' ||\r\n                    lowerIfExists(sn.attributes.property).match(/^article:/) ||\r\n                    lowerIfExists(sn.attributes.property).match(/^product:/))) {\r\n                return true;\r\n            }\r\n            else if (slimDOMOptions.headMetaVerification &&\r\n                (lowerIfExists(sn.attributes.name) === 'google-site-verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'yandex-verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'csrf-token' ||\r\n                    lowerIfExists(sn.attributes.name) === 'p:domain_verify' ||\r\n                    lowerIfExists(sn.attributes.name) === 'verify-v1' ||\r\n                    lowerIfExists(sn.attributes.name) === 'verification' ||\r\n                    lowerIfExists(sn.attributes.name) === 'shopify-checkout-api-token')) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction serializeNodeWithId(n, options) {\r\n    var doc = options.doc, mirror = options.mirror, blockClass = options.blockClass, blockSelector = options.blockSelector, maskTextClass = options.maskTextClass, maskTextSelector = options.maskTextSelector, _a = options.skipChild, skipChild = _a === void 0 ? false : _a, _b = options.inlineStylesheet, inlineStylesheet = _b === void 0 ? true : _b, _c = options.maskInputOptions, maskInputOptions = _c === void 0 ? {} : _c, maskTextFn = options.maskTextFn, maskInputFn = options.maskInputFn, slimDOMOptions = options.slimDOMOptions, _d = options.dataURLOptions, dataURLOptions = _d === void 0 ? {} : _d, _e = options.inlineImages, inlineImages = _e === void 0 ? false : _e, _f = options.recordCanvas, recordCanvas = _f === void 0 ? false : _f, onSerialize = options.onSerialize, onIframeLoad = options.onIframeLoad, _g = options.iframeLoadTimeout, iframeLoadTimeout = _g === void 0 ? 5000 : _g, onStylesheetLoad = options.onStylesheetLoad, _h = options.stylesheetLoadTimeout, stylesheetLoadTimeout = _h === void 0 ? 5000 : _h, _j = options.keepIframeSrcFn, keepIframeSrcFn = _j === void 0 ? function () { return false; } : _j, _k = options.newlyAddedElement, newlyAddedElement = _k === void 0 ? false : _k;\r\n    var _l = options.preserveWhiteSpace, preserveWhiteSpace = _l === void 0 ? true : _l;\r\n    var _serializedNode = serializeNode(n, {\r\n        doc: doc,\r\n        mirror: mirror,\r\n        blockClass: blockClass,\r\n        blockSelector: blockSelector,\r\n        maskTextClass: maskTextClass,\r\n        maskTextSelector: maskTextSelector,\r\n        inlineStylesheet: inlineStylesheet,\r\n        maskInputOptions: maskInputOptions,\r\n        maskTextFn: maskTextFn,\r\n        maskInputFn: maskInputFn,\r\n        dataURLOptions: dataURLOptions,\r\n        inlineImages: inlineImages,\r\n        recordCanvas: recordCanvas,\r\n        keepIframeSrcFn: keepIframeSrcFn,\r\n        newlyAddedElement: newlyAddedElement\r\n    });\r\n    if (!_serializedNode) {\r\n        console.warn(n, 'not serialized');\r\n        return null;\r\n    }\r\n    var id;\r\n    if (mirror.hasNode(n)) {\r\n        id = mirror.getId(n);\r\n    }\r\n    else if (slimDOMExcluded(_serializedNode, slimDOMOptions) ||\r\n        (!preserveWhiteSpace &&\r\n            _serializedNode.type === NodeType.Text &&\r\n            !_serializedNode.isStyle &&\r\n            !_serializedNode.textContent.replace(/^\\s+|\\s+$/gm, '').length)) {\r\n        id = IGNORED_NODE;\r\n    }\r\n    else {\r\n        id = genId();\r\n    }\r\n    var serializedNode = Object.assign(_serializedNode, { id: id });\r\n    mirror.add(n, serializedNode);\r\n    if (id === IGNORED_NODE) {\r\n        return null;\r\n    }\r\n    if (onSerialize) {\r\n        onSerialize(n);\r\n    }\r\n    var recordChild = !skipChild;\r\n    if (serializedNode.type === NodeType.Element) {\r\n        recordChild = recordChild && !serializedNode.needBlock;\r\n        delete serializedNode.needBlock;\r\n        var shadowRoot = n.shadowRoot;\r\n        if (shadowRoot && isNativeShadowDom(shadowRoot))\r\n            serializedNode.isShadowHost = true;\r\n    }\r\n    if ((serializedNode.type === NodeType.Document ||\r\n        serializedNode.type === NodeType.Element) &&\r\n        recordChild) {\r\n        if (slimDOMOptions.headWhitespace &&\r\n            serializedNode.type === NodeType.Element &&\r\n            serializedNode.tagName === 'head') {\r\n            preserveWhiteSpace = false;\r\n        }\r\n        var bypassOptions = {\r\n            doc: doc,\r\n            mirror: mirror,\r\n            blockClass: blockClass,\r\n            blockSelector: blockSelector,\r\n            maskTextClass: maskTextClass,\r\n            maskTextSelector: maskTextSelector,\r\n            skipChild: skipChild,\r\n            inlineStylesheet: inlineStylesheet,\r\n            maskInputOptions: maskInputOptions,\r\n            maskTextFn: maskTextFn,\r\n            maskInputFn: maskInputFn,\r\n            slimDOMOptions: slimDOMOptions,\r\n            dataURLOptions: dataURLOptions,\r\n            inlineImages: inlineImages,\r\n            recordCanvas: recordCanvas,\r\n            preserveWhiteSpace: preserveWhiteSpace,\r\n            onSerialize: onSerialize,\r\n            onIframeLoad: onIframeLoad,\r\n            iframeLoadTimeout: iframeLoadTimeout,\r\n            onStylesheetLoad: onStylesheetLoad,\r\n            stylesheetLoadTimeout: stylesheetLoadTimeout,\r\n            keepIframeSrcFn: keepIframeSrcFn\r\n        };\r\n        for (var _i = 0, _m = Array.from(n.childNodes); _i < _m.length; _i++) {\r\n            var childN = _m[_i];\r\n            var serializedChildNode = serializeNodeWithId(childN, bypassOptions);\r\n            if (serializedChildNode) {\r\n                serializedNode.childNodes.push(serializedChildNode);\r\n            }\r\n        }\r\n        if (isElement(n) && n.shadowRoot) {\r\n            for (var _o = 0, _p = Array.from(n.shadowRoot.childNodes); _o < _p.length; _o++) {\r\n                var childN = _p[_o];\r\n                var serializedChildNode = serializeNodeWithId(childN, bypassOptions);\r\n                if (serializedChildNode) {\r\n                    isNativeShadowDom(n.shadowRoot) &&\r\n                        (serializedChildNode.isShadow = true);\r\n                    serializedNode.childNodes.push(serializedChildNode);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    if (n.parentNode &&\r\n        isShadowRoot(n.parentNode) &&\r\n        isNativeShadowDom(n.parentNode)) {\r\n        serializedNode.isShadow = true;\r\n    }\r\n    if (serializedNode.type === NodeType.Element &&\r\n        serializedNode.tagName === 'iframe') {\r\n        onceIframeLoaded(n, function () {\r\n            var iframeDoc = n.contentDocument;\r\n            if (iframeDoc && onIframeLoad) {\r\n                var serializedIframeNode = serializeNodeWithId(iframeDoc, {\r\n                    doc: iframeDoc,\r\n                    mirror: mirror,\r\n                    blockClass: blockClass,\r\n                    blockSelector: blockSelector,\r\n                    maskTextClass: maskTextClass,\r\n                    maskTextSelector: maskTextSelector,\r\n                    skipChild: false,\r\n                    inlineStylesheet: inlineStylesheet,\r\n                    maskInputOptions: maskInputOptions,\r\n                    maskTextFn: maskTextFn,\r\n                    maskInputFn: maskInputFn,\r\n                    slimDOMOptions: slimDOMOptions,\r\n                    dataURLOptions: dataURLOptions,\r\n                    inlineImages: inlineImages,\r\n                    recordCanvas: recordCanvas,\r\n                    preserveWhiteSpace: preserveWhiteSpace,\r\n                    onSerialize: onSerialize,\r\n                    onIframeLoad: onIframeLoad,\r\n                    iframeLoadTimeout: iframeLoadTimeout,\r\n                    onStylesheetLoad: onStylesheetLoad,\r\n                    stylesheetLoadTimeout: stylesheetLoadTimeout,\r\n                    keepIframeSrcFn: keepIframeSrcFn\r\n                });\r\n                if (serializedIframeNode) {\r\n                    onIframeLoad(n, serializedIframeNode);\r\n                }\r\n            }\r\n        }, iframeLoadTimeout);\r\n    }\r\n    if (serializedNode.type === NodeType.Element &&\r\n        serializedNode.tagName === 'link' &&\r\n        serializedNode.attributes.rel === 'stylesheet') {\r\n        onceStylesheetLoaded(n, function () {\r\n            if (onStylesheetLoad) {\r\n                var serializedLinkNode = serializeNodeWithId(n, {\r\n                    doc: doc,\r\n                    mirror: mirror,\r\n                    blockClass: blockClass,\r\n                    blockSelector: blockSelector,\r\n                    maskTextClass: maskTextClass,\r\n                    maskTextSelector: maskTextSelector,\r\n                    skipChild: false,\r\n                    inlineStylesheet: inlineStylesheet,\r\n                    maskInputOptions: maskInputOptions,\r\n                    maskTextFn: maskTextFn,\r\n                    maskInputFn: maskInputFn,\r\n                    slimDOMOptions: slimDOMOptions,\r\n                    dataURLOptions: dataURLOptions,\r\n                    inlineImages: inlineImages,\r\n                    recordCanvas: recordCanvas,\r\n                    preserveWhiteSpace: preserveWhiteSpace,\r\n                    onSerialize: onSerialize,\r\n                    onIframeLoad: onIframeLoad,\r\n                    iframeLoadTimeout: iframeLoadTimeout,\r\n                    onStylesheetLoad: onStylesheetLoad,\r\n                    stylesheetLoadTimeout: stylesheetLoadTimeout,\r\n                    keepIframeSrcFn: keepIframeSrcFn\r\n                });\r\n                if (serializedLinkNode) {\r\n                    onStylesheetLoad(n, serializedLinkNode);\r\n                }\r\n            }\r\n        }, stylesheetLoadTimeout);\r\n    }\r\n    return serializedNode;\r\n}\r\nfunction snapshot(n, options) {\r\n    var _a = options || {}, _b = _a.mirror, mirror = _b === void 0 ? new Mirror() : _b, _c = _a.blockClass, blockClass = _c === void 0 ? 'rr-block' : _c, _d = _a.blockSelector, blockSelector = _d === void 0 ? null : _d, _e = _a.maskTextClass, maskTextClass = _e === void 0 ? 'rr-mask' : _e, _f = _a.maskTextSelector, maskTextSelector = _f === void 0 ? null : _f, _g = _a.inlineStylesheet, inlineStylesheet = _g === void 0 ? true : _g, _h = _a.inlineImages, inlineImages = _h === void 0 ? false : _h, _j = _a.recordCanvas, recordCanvas = _j === void 0 ? false : _j, _k = _a.maskAllInputs, maskAllInputs = _k === void 0 ? false : _k, maskTextFn = _a.maskTextFn, maskInputFn = _a.maskInputFn, _l = _a.slimDOM, slimDOM = _l === void 0 ? false : _l, dataURLOptions = _a.dataURLOptions, preserveWhiteSpace = _a.preserveWhiteSpace, onSerialize = _a.onSerialize, onIframeLoad = _a.onIframeLoad, iframeLoadTimeout = _a.iframeLoadTimeout, onStylesheetLoad = _a.onStylesheetLoad, stylesheetLoadTimeout = _a.stylesheetLoadTimeout, _m = _a.keepIframeSrcFn, keepIframeSrcFn = _m === void 0 ? function () { return false; } : _m;\r\n    var maskInputOptions = maskAllInputs === true\r\n        ? {\r\n            color: true,\r\n            date: true,\r\n            'datetime-local': true,\r\n            email: true,\r\n            month: true,\r\n            number: true,\r\n            range: true,\r\n            search: true,\r\n            tel: true,\r\n            text: true,\r\n            time: true,\r\n            url: true,\r\n            week: true,\r\n            textarea: true,\r\n            select: true,\r\n            password: true\r\n        }\r\n        : maskAllInputs === false\r\n            ? {\r\n                password: true\r\n            }\r\n            : maskAllInputs;\r\n    var slimDOMOptions = slimDOM === true || slimDOM === 'all'\r\n        ?\r\n            {\r\n                script: true,\r\n                comment: true,\r\n                headFavicon: true,\r\n                headWhitespace: true,\r\n                headMetaDescKeywords: slimDOM === 'all',\r\n                headMetaSocial: true,\r\n                headMetaRobots: true,\r\n                headMetaHttpEquiv: true,\r\n                headMetaAuthorship: true,\r\n                headMetaVerification: true\r\n            }\r\n        : slimDOM === false\r\n            ? {}\r\n            : slimDOM;\r\n    return serializeNodeWithId(n, {\r\n        doc: n,\r\n        mirror: mirror,\r\n        blockClass: blockClass,\r\n        blockSelector: blockSelector,\r\n        maskTextClass: maskTextClass,\r\n        maskTextSelector: maskTextSelector,\r\n        skipChild: false,\r\n        inlineStylesheet: inlineStylesheet,\r\n        maskInputOptions: maskInputOptions,\r\n        maskTextFn: maskTextFn,\r\n        maskInputFn: maskInputFn,\r\n        slimDOMOptions: slimDOMOptions,\r\n        dataURLOptions: dataURLOptions,\r\n        inlineImages: inlineImages,\r\n        recordCanvas: recordCanvas,\r\n        preserveWhiteSpace: preserveWhiteSpace,\r\n        onSerialize: onSerialize,\r\n        onIframeLoad: onIframeLoad,\r\n        iframeLoadTimeout: iframeLoadTimeout,\r\n        onStylesheetLoad: onStylesheetLoad,\r\n        stylesheetLoadTimeout: stylesheetLoadTimeout,\r\n        keepIframeSrcFn: keepIframeSrcFn,\r\n        newlyAddedElement: false\r\n    });\r\n}\r\n\nvar commentre = /\\/\\*[^*]*\\*+([^/*][^*]*\\*+)*\\//g;\r\nfunction parse(css, options) {\r\n    if (options === void 0) { options = {}; }\r\n    var lineno = 1;\r\n    var column = 1;\r\n    function updatePosition(str) {\r\n        var lines = str.match(/\\n/g);\r\n        if (lines) {\r\n            lineno += lines.length;\r\n        }\r\n        var i = str.lastIndexOf('\\n');\r\n        column = i === -1 ? column + str.length : str.length - i;\r\n    }\r\n    function position() {\r\n        var start = { line: lineno, column: column };\r\n        return function (node) {\r\n            node.position = new Position(start);\r\n            whitespace();\r\n            return node;\r\n        };\r\n    }\r\n    var Position = (function () {\r\n        function Position(start) {\r\n            this.start = start;\r\n            this.end = { line: lineno, column: column };\r\n            this.source = options.source;\r\n        }\r\n        return Position;\r\n    }());\r\n    Position.prototype.content = css;\r\n    var errorsList = [];\r\n    function error(msg) {\r\n        var err = new Error(\"\".concat(options.source || '', \":\").concat(lineno, \":\").concat(column, \": \").concat(msg));\r\n        err.reason = msg;\r\n        err.filename = options.source;\r\n        err.line = lineno;\r\n        err.column = column;\r\n        err.source = css;\r\n        if (options.silent) {\r\n            errorsList.push(err);\r\n        }\r\n        else {\r\n            throw err;\r\n        }\r\n    }\r\n    function stylesheet() {\r\n        var rulesList = rules();\r\n        return {\r\n            type: 'stylesheet',\r\n            stylesheet: {\r\n                source: options.source,\r\n                rules: rulesList,\r\n                parsingErrors: errorsList\r\n            }\r\n        };\r\n    }\r\n    function open() {\r\n        return match(/^{\\s*/);\r\n    }\r\n    function close() {\r\n        return match(/^}/);\r\n    }\r\n    function rules() {\r\n        var node;\r\n        var rules = [];\r\n        whitespace();\r\n        comments(rules);\r\n        while (css.length && css.charAt(0) !== '}' && (node = atrule() || rule())) {\r\n            if (node) {\r\n                rules.push(node);\r\n                comments(rules);\r\n            }\r\n        }\r\n        return rules;\r\n    }\r\n    function match(re) {\r\n        var m = re.exec(css);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var str = m[0];\r\n        updatePosition(str);\r\n        css = css.slice(str.length);\r\n        return m;\r\n    }\r\n    function whitespace() {\r\n        match(/^\\s*/);\r\n    }\r\n    function comments(rules) {\r\n        if (rules === void 0) { rules = []; }\r\n        var c;\r\n        while ((c = comment())) {\r\n            if (c) {\r\n                rules.push(c);\r\n            }\r\n            c = comment();\r\n        }\r\n        return rules;\r\n    }\r\n    function comment() {\r\n        var pos = position();\r\n        if ('/' !== css.charAt(0) || '*' !== css.charAt(1)) {\r\n            return;\r\n        }\r\n        var i = 2;\r\n        while ('' !== css.charAt(i) &&\r\n            ('*' !== css.charAt(i) || '/' !== css.charAt(i + 1))) {\r\n            ++i;\r\n        }\r\n        i += 2;\r\n        if ('' === css.charAt(i - 1)) {\r\n            return error('End of comment missing');\r\n        }\r\n        var str = css.slice(2, i - 2);\r\n        column += 2;\r\n        updatePosition(str);\r\n        css = css.slice(i);\r\n        column += 2;\r\n        return pos({\r\n            type: 'comment',\r\n            comment: str\r\n        });\r\n    }\r\n    function selector() {\r\n        var m = match(/^([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        return trim(m[0])\r\n            .replace(/\\/\\*([^*]|[\\r\\n]|(\\*+([^*/]|[\\r\\n])))*\\*\\/+/g, '')\r\n            .replace(/\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'/g, function (m) {\r\n            return m.replace(/,/g, '\\u200C');\r\n        })\r\n            .split(/\\s*(?![^(]*\\)),\\s*/)\r\n            .map(function (s) {\r\n            return s.replace(/\\u200C/g, ',');\r\n        });\r\n    }\r\n    function declaration() {\r\n        var pos = position();\r\n        var propMatch = match(/^(\\*?[-#\\/\\*\\\\\\w]+(\\[[0-9a-z_-]+\\])?)\\s*/);\r\n        if (!propMatch) {\r\n            return;\r\n        }\r\n        var prop = trim(propMatch[0]);\r\n        if (!match(/^:\\s*/)) {\r\n            return error(\"property missing ':'\");\r\n        }\r\n        var val = match(/^((?:'(?:\\\\'|.)*?'|\"(?:\\\\\"|.)*?\"|\\([^\\)]*?\\)|[^};])+)/);\r\n        var ret = pos({\r\n            type: 'declaration',\r\n            property: prop.replace(commentre, ''),\r\n            value: val ? trim(val[0]).replace(commentre, '') : ''\r\n        });\r\n        match(/^[;\\s]*/);\r\n        return ret;\r\n    }\r\n    function declarations() {\r\n        var decls = [];\r\n        if (!open()) {\r\n            return error(\"missing '{'\");\r\n        }\r\n        comments(decls);\r\n        var decl;\r\n        while ((decl = declaration())) {\r\n            if (decl !== false) {\r\n                decls.push(decl);\r\n                comments(decls);\r\n            }\r\n            decl = declaration();\r\n        }\r\n        if (!close()) {\r\n            return error(\"missing '}'\");\r\n        }\r\n        return decls;\r\n    }\r\n    function keyframe() {\r\n        var m;\r\n        var vals = [];\r\n        var pos = position();\r\n        while ((m = match(/^((\\d+\\.\\d+|\\.\\d+|\\d+)%?|[a-z]+)\\s*/))) {\r\n            vals.push(m[1]);\r\n            match(/^,\\s*/);\r\n        }\r\n        if (!vals.length) {\r\n            return;\r\n        }\r\n        return pos({\r\n            type: 'keyframe',\r\n            values: vals,\r\n            declarations: declarations()\r\n        });\r\n    }\r\n    function atkeyframes() {\r\n        var pos = position();\r\n        var m = match(/^@([-\\w]+)?keyframes\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var vendor = m[1];\r\n        m = match(/^([-\\w]+)\\s*/);\r\n        if (!m) {\r\n            return error('@keyframes missing name');\r\n        }\r\n        var name = m[1];\r\n        if (!open()) {\r\n            return error(\"@keyframes missing '{'\");\r\n        }\r\n        var frame;\r\n        var frames = comments();\r\n        while ((frame = keyframe())) {\r\n            frames.push(frame);\r\n            frames = frames.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(\"@keyframes missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'keyframes',\r\n            name: name,\r\n            vendor: vendor,\r\n            keyframes: frames\r\n        });\r\n    }\r\n    function atsupports() {\r\n        var pos = position();\r\n        var m = match(/^@supports *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var supports = trim(m[1]);\r\n        if (!open()) {\r\n            return error(\"@supports missing '{'\");\r\n        }\r\n        var style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(\"@supports missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'supports',\r\n            supports: supports,\r\n            rules: style\r\n        });\r\n    }\r\n    function athost() {\r\n        var pos = position();\r\n        var m = match(/^@host\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        if (!open()) {\r\n            return error(\"@host missing '{'\");\r\n        }\r\n        var style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(\"@host missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'host',\r\n            rules: style\r\n        });\r\n    }\r\n    function atmedia() {\r\n        var pos = position();\r\n        var m = match(/^@media *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var media = trim(m[1]);\r\n        if (!open()) {\r\n            return error(\"@media missing '{'\");\r\n        }\r\n        var style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(\"@media missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'media',\r\n            media: media,\r\n            rules: style\r\n        });\r\n    }\r\n    function atcustommedia() {\r\n        var pos = position();\r\n        var m = match(/^@custom-media\\s+(--[^\\s]+)\\s*([^{;]+);/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        return pos({\r\n            type: 'custom-media',\r\n            name: trim(m[1]),\r\n            media: trim(m[2])\r\n        });\r\n    }\r\n    function atpage() {\r\n        var pos = position();\r\n        var m = match(/^@page */);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var sel = selector() || [];\r\n        if (!open()) {\r\n            return error(\"@page missing '{'\");\r\n        }\r\n        var decls = comments();\r\n        var decl;\r\n        while ((decl = declaration())) {\r\n            decls.push(decl);\r\n            decls = decls.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(\"@page missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'page',\r\n            selectors: sel,\r\n            declarations: decls\r\n        });\r\n    }\r\n    function atdocument() {\r\n        var pos = position();\r\n        var m = match(/^@([-\\w]+)?document *([^{]+)/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        var vendor = trim(m[1]);\r\n        var doc = trim(m[2]);\r\n        if (!open()) {\r\n            return error(\"@document missing '{'\");\r\n        }\r\n        var style = comments().concat(rules());\r\n        if (!close()) {\r\n            return error(\"@document missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'document',\r\n            document: doc,\r\n            vendor: vendor,\r\n            rules: style\r\n        });\r\n    }\r\n    function atfontface() {\r\n        var pos = position();\r\n        var m = match(/^@font-face\\s*/);\r\n        if (!m) {\r\n            return;\r\n        }\r\n        if (!open()) {\r\n            return error(\"@font-face missing '{'\");\r\n        }\r\n        var decls = comments();\r\n        var decl;\r\n        while ((decl = declaration())) {\r\n            decls.push(decl);\r\n            decls = decls.concat(comments());\r\n        }\r\n        if (!close()) {\r\n            return error(\"@font-face missing '}'\");\r\n        }\r\n        return pos({\r\n            type: 'font-face',\r\n            declarations: decls\r\n        });\r\n    }\r\n    var atimport = _compileAtrule('import');\r\n    var atcharset = _compileAtrule('charset');\r\n    var atnamespace = _compileAtrule('namespace');\r\n    function _compileAtrule(name) {\r\n        var re = new RegExp('^@' + name + '\\\\s*([^;]+);');\r\n        return function () {\r\n            var pos = position();\r\n            var m = match(re);\r\n            if (!m) {\r\n                return;\r\n            }\r\n            var ret = { type: name };\r\n            ret[name] = m[1].trim();\r\n            return pos(ret);\r\n        };\r\n    }\r\n    function atrule() {\r\n        if (css[0] !== '@') {\r\n            return;\r\n        }\r\n        return (atkeyframes() ||\r\n            atmedia() ||\r\n            atcustommedia() ||\r\n            atsupports() ||\r\n            atimport() ||\r\n            atcharset() ||\r\n            atnamespace() ||\r\n            atdocument() ||\r\n            atpage() ||\r\n            athost() ||\r\n            atfontface());\r\n    }\r\n    function rule() {\r\n        var pos = position();\r\n        var sel = selector();\r\n        if (!sel) {\r\n            return error('selector missing');\r\n        }\r\n        comments();\r\n        return pos({\r\n            type: 'rule',\r\n            selectors: sel,\r\n            declarations: declarations()\r\n        });\r\n    }\r\n    return addParent(stylesheet());\r\n}\r\nfunction trim(str) {\r\n    return str ? str.replace(/^\\s+|\\s+$/g, '') : '';\r\n}\r\nfunction addParent(obj, parent) {\r\n    var isNode = obj && typeof obj.type === 'string';\r\n    var childParent = isNode ? obj : parent;\r\n    for (var _i = 0, _a = Object.keys(obj); _i < _a.length; _i++) {\r\n        var k = _a[_i];\r\n        var value = obj[k];\r\n        if (Array.isArray(value)) {\r\n            value.forEach(function (v) {\r\n                addParent(v, childParent);\r\n            });\r\n        }\r\n        else if (value && typeof value === 'object') {\r\n            addParent(value, childParent);\r\n        }\r\n    }\r\n    if (isNode) {\r\n        Object.defineProperty(obj, 'parent', {\r\n            configurable: true,\r\n            writable: true,\r\n            enumerable: false,\r\n            value: parent || null\r\n        });\r\n    }\r\n    return obj;\r\n}\n\nvar tagMap = {\r\n    script: 'noscript',\r\n    altglyph: 'altGlyph',\r\n    altglyphdef: 'altGlyphDef',\r\n    altglyphitem: 'altGlyphItem',\r\n    animatecolor: 'animateColor',\r\n    animatemotion: 'animateMotion',\r\n    animatetransform: 'animateTransform',\r\n    clippath: 'clipPath',\r\n    feblend: 'feBlend',\r\n    fecolormatrix: 'feColorMatrix',\r\n    fecomponenttransfer: 'feComponentTransfer',\r\n    fecomposite: 'feComposite',\r\n    feconvolvematrix: 'feConvolveMatrix',\r\n    fediffuselighting: 'feDiffuseLighting',\r\n    fedisplacementmap: 'feDisplacementMap',\r\n    fedistantlight: 'feDistantLight',\r\n    fedropshadow: 'feDropShadow',\r\n    feflood: 'feFlood',\r\n    fefunca: 'feFuncA',\r\n    fefuncb: 'feFuncB',\r\n    fefuncg: 'feFuncG',\r\n    fefuncr: 'feFuncR',\r\n    fegaussianblur: 'feGaussianBlur',\r\n    feimage: 'feImage',\r\n    femerge: 'feMerge',\r\n    femergenode: 'feMergeNode',\r\n    femorphology: 'feMorphology',\r\n    feoffset: 'feOffset',\r\n    fepointlight: 'fePointLight',\r\n    fespecularlighting: 'feSpecularLighting',\r\n    fespotlight: 'feSpotLight',\r\n    fetile: 'feTile',\r\n    feturbulence: 'feTurbulence',\r\n    foreignobject: 'foreignObject',\r\n    glyphref: 'glyphRef',\r\n    lineargradient: 'linearGradient',\r\n    radialgradient: 'radialGradient'\r\n};\r\nfunction getTagName(n) {\r\n    var tagName = tagMap[n.tagName] ? tagMap[n.tagName] : n.tagName;\r\n    if (tagName === 'link' && n.attributes._cssText) {\r\n        tagName = 'style';\r\n    }\r\n    return tagName;\r\n}\r\nfunction escapeRegExp(str) {\r\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n}\r\nvar HOVER_SELECTOR = /([^\\\\]):hover/;\r\nvar HOVER_SELECTOR_GLOBAL = new RegExp(HOVER_SELECTOR.source, 'g');\r\nfunction addHoverClass(cssText, cache) {\r\n    var cachedStyle = cache === null || cache === void 0 ? void 0 : cache.stylesWithHoverClass.get(cssText);\r\n    if (cachedStyle)\r\n        return cachedStyle;\r\n    var ast = parse(cssText, {\r\n        silent: true\r\n    });\r\n    if (!ast.stylesheet) {\r\n        return cssText;\r\n    }\r\n    var selectors = [];\r\n    ast.stylesheet.rules.forEach(function (rule) {\r\n        if ('selectors' in rule) {\r\n            (rule.selectors || []).forEach(function (selector) {\r\n                if (HOVER_SELECTOR.test(selector)) {\r\n                    selectors.push(selector);\r\n                }\r\n            });\r\n        }\r\n    });\r\n    if (selectors.length === 0) {\r\n        return cssText;\r\n    }\r\n    var selectorMatcher = new RegExp(selectors\r\n        .filter(function (selector, index) { return selectors.indexOf(selector) === index; })\r\n        .sort(function (a, b) { return b.length - a.length; })\r\n        .map(function (selector) {\r\n        return escapeRegExp(selector);\r\n    })\r\n        .join('|'), 'g');\r\n    var result = cssText.replace(selectorMatcher, function (selector) {\r\n        var newSelector = selector.replace(HOVER_SELECTOR_GLOBAL, '$1.\\\\:hover');\r\n        return \"\".concat(selector, \", \").concat(newSelector);\r\n    });\r\n    cache === null || cache === void 0 ? void 0 : cache.stylesWithHoverClass.set(cssText, result);\r\n    return result;\r\n}\r\nfunction createCache() {\r\n    var stylesWithHoverClass = new Map();\r\n    return {\r\n        stylesWithHoverClass: stylesWithHoverClass\r\n    };\r\n}\r\nfunction buildNode(n, options) {\r\n    var doc = options.doc, hackCss = options.hackCss, cache = options.cache;\r\n    switch (n.type) {\r\n        case NodeType.Document:\r\n            return doc.implementation.createDocument(null, '', null);\r\n        case NodeType.DocumentType:\r\n            return doc.implementation.createDocumentType(n.name || 'html', n.publicId, n.systemId);\r\n        case NodeType.Element: {\r\n            var tagName = getTagName(n);\r\n            var node_1;\r\n            if (n.isSVG) {\r\n                node_1 = doc.createElementNS('http://www.w3.org/2000/svg', tagName);\r\n            }\r\n            else {\r\n                node_1 = doc.createElement(tagName);\r\n            }\r\n            var specialAttributes = {};\r\n            for (var name_1 in n.attributes) {\r\n                if (!Object.prototype.hasOwnProperty.call(n.attributes, name_1)) {\r\n                    continue;\r\n                }\r\n                var value = n.attributes[name_1];\r\n                if (tagName === 'option' &&\r\n                    name_1 === 'selected' &&\r\n                    value === false) {\r\n                    continue;\r\n                }\r\n                if (value === null) {\r\n                    continue;\r\n                }\r\n                if (value === true)\r\n                    value = '';\r\n                if (name_1.startsWith('rr_')) {\r\n                    specialAttributes[name_1] = value;\r\n                    continue;\r\n                }\r\n                var isTextarea = tagName === 'textarea' && name_1 === 'value';\r\n                var isRemoteOrDynamicCss = tagName === 'style' && name_1 === '_cssText';\r\n                if (isRemoteOrDynamicCss && hackCss && typeof value === 'string') {\r\n                    value = addHoverClass(value, cache);\r\n                }\r\n                if ((isTextarea || isRemoteOrDynamicCss) && typeof value === 'string') {\r\n                    var child = doc.createTextNode(value);\r\n                    for (var _i = 0, _a = Array.from(node_1.childNodes); _i < _a.length; _i++) {\r\n                        var c = _a[_i];\r\n                        if (c.nodeType === node_1.TEXT_NODE) {\r\n                            node_1.removeChild(c);\r\n                        }\r\n                    }\r\n                    node_1.appendChild(child);\r\n                    continue;\r\n                }\r\n                try {\r\n                    if (n.isSVG && name_1 === 'xlink:href') {\r\n                        node_1.setAttributeNS('http://www.w3.org/1999/xlink', name_1, value.toString());\r\n                    }\r\n                    else if (name_1 === 'onload' ||\r\n                        name_1 === 'onclick' ||\r\n                        name_1.substring(0, 7) === 'onmouse') {\r\n                        node_1.setAttribute('_' + name_1, value.toString());\r\n                    }\r\n                    else if (tagName === 'meta' &&\r\n                        n.attributes['http-equiv'] === 'Content-Security-Policy' &&\r\n                        name_1 === 'content') {\r\n                        node_1.setAttribute('csp-content', value.toString());\r\n                        continue;\r\n                    }\r\n                    else if (tagName === 'link' &&\r\n                        (n.attributes.rel === 'preload' ||\r\n                            n.attributes.rel === 'modulepreload') &&\r\n                        n.attributes.as === 'script') {\r\n                    }\r\n                    else if (tagName === 'link' &&\r\n                        n.attributes.rel === 'prefetch' &&\r\n                        typeof n.attributes.href === 'string' &&\r\n                        n.attributes.href.endsWith('.js')) {\r\n                    }\r\n                    else if (tagName === 'img' &&\r\n                        n.attributes.srcset &&\r\n                        n.attributes.rr_dataURL) {\r\n                        node_1.setAttribute('rrweb-original-srcset', n.attributes.srcset);\r\n                    }\r\n                    else {\r\n                        node_1.setAttribute(name_1, value.toString());\r\n                    }\r\n                }\r\n                catch (error) {\r\n                }\r\n            }\r\n            var _loop_1 = function (name_2) {\r\n                var value = specialAttributes[name_2];\r\n                if (tagName === 'canvas' && name_2 === 'rr_dataURL') {\r\n                    var image_1 = document.createElement('img');\r\n                    image_1.onload = function () {\r\n                        var ctx = node_1.getContext('2d');\r\n                        if (ctx) {\r\n                            ctx.drawImage(image_1, 0, 0, image_1.width, image_1.height);\r\n                        }\r\n                    };\r\n                    image_1.src = value.toString();\r\n                    if (node_1.RRNodeType)\r\n                        node_1.rr_dataURL = value.toString();\r\n                }\r\n                else if (tagName === 'img' && name_2 === 'rr_dataURL') {\r\n                    var image = node_1;\r\n                    if (!image.currentSrc.startsWith('data:')) {\r\n                        image.setAttribute('rrweb-original-src', n.attributes.src);\r\n                        image.src = value.toString();\r\n                    }\r\n                }\r\n                if (name_2 === 'rr_width') {\r\n                    node_1.style.width = value.toString();\r\n                }\r\n                else if (name_2 === 'rr_height') {\r\n                    node_1.style.height = value.toString();\r\n                }\r\n                else if (name_2 === 'rr_mediaCurrentTime' &&\r\n                    typeof value === 'number') {\r\n                    node_1.currentTime = value;\r\n                }\r\n                else if (name_2 === 'rr_mediaState') {\r\n                    switch (value) {\r\n                        case 'played':\r\n                            node_1\r\n                                .play()[\"catch\"](function (e) { return console.warn('media playback error', e); });\r\n                            break;\r\n                        case 'paused':\r\n                            node_1.pause();\r\n                            break;\r\n                    }\r\n                }\r\n            };\r\n            for (var name_2 in specialAttributes) {\r\n                _loop_1(name_2);\r\n            }\r\n            if (n.isShadowHost) {\r\n                if (!node_1.shadowRoot) {\r\n                    node_1.attachShadow({ mode: 'open' });\r\n                }\r\n                else {\r\n                    while (node_1.shadowRoot.firstChild) {\r\n                        node_1.shadowRoot.removeChild(node_1.shadowRoot.firstChild);\r\n                    }\r\n                }\r\n            }\r\n            return node_1;\r\n        }\r\n        case NodeType.Text:\r\n            return doc.createTextNode(n.isStyle && hackCss\r\n                ? addHoverClass(n.textContent, cache)\r\n                : n.textContent);\r\n        case NodeType.CDATA:\r\n            return doc.createCDATASection(n.textContent);\r\n        case NodeType.Comment:\r\n            return doc.createComment(n.textContent);\r\n        default:\r\n            return null;\r\n    }\r\n}\r\nfunction buildNodeWithSN(n, options) {\r\n    var doc = options.doc, mirror = options.mirror, _a = options.skipChild, skipChild = _a === void 0 ? false : _a, _b = options.hackCss, hackCss = _b === void 0 ? true : _b, afterAppend = options.afterAppend, cache = options.cache;\r\n    if (mirror.has(n.id)) {\r\n        var nodeInMirror = mirror.getNode(n.id);\r\n        var meta = mirror.getMeta(nodeInMirror);\r\n        if (isNodeMetaEqual(meta, n))\r\n            return mirror.getNode(n.id);\r\n    }\r\n    var node = buildNode(n, { doc: doc, hackCss: hackCss, cache: cache });\r\n    if (!node) {\r\n        return null;\r\n    }\r\n    if (n.rootId && mirror.getNode(n.rootId) !== doc) {\r\n        mirror.replace(n.rootId, doc);\r\n    }\r\n    if (n.type === NodeType.Document) {\r\n        doc.close();\r\n        doc.open();\r\n        if (n.compatMode === 'BackCompat' &&\r\n            n.childNodes &&\r\n            n.childNodes[0].type !== NodeType.DocumentType) {\r\n            if (n.childNodes[0].type === NodeType.Element &&\r\n                'xmlns' in n.childNodes[0].attributes &&\r\n                n.childNodes[0].attributes.xmlns === 'http://www.w3.org/1999/xhtml') {\r\n                doc.write('<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"\">');\r\n            }\r\n            else {\r\n                doc.write('<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\" \"\">');\r\n            }\r\n        }\r\n        node = doc;\r\n    }\r\n    mirror.add(node, n);\r\n    if ((n.type === NodeType.Document || n.type === NodeType.Element) &&\r\n        !skipChild) {\r\n        var _loop_2 = function (childN) {\r\n            var childNode = buildNodeWithSN(childN, {\r\n                doc: doc,\r\n                mirror: mirror,\r\n                skipChild: false,\r\n                hackCss: hackCss,\r\n                afterAppend: afterAppend,\r\n                cache: cache\r\n            });\r\n            if (!childNode) {\r\n                console.warn('Failed to rebuild', childN);\r\n                return \"continue\";\r\n            }\r\n            if (childN.isShadow && isElement(node) && node.shadowRoot) {\r\n                node.shadowRoot.appendChild(childNode);\r\n            }\r\n            else if (n.type === NodeType.Document &&\r\n                childN.type == NodeType.Element) {\r\n                var htmlElement = childNode;\r\n                var body_1 = null;\r\n                htmlElement.childNodes.forEach(function (child) {\r\n                    if (child.nodeName === 'BODY')\r\n                        body_1 = child;\r\n                });\r\n                if (body_1) {\r\n                    htmlElement.removeChild(body_1);\r\n                    node.appendChild(childNode);\r\n                    htmlElement.appendChild(body_1);\r\n                }\r\n                else {\r\n                    node.appendChild(childNode);\r\n                }\r\n            }\r\n            else {\r\n                node.appendChild(childNode);\r\n            }\r\n            if (afterAppend) {\r\n                afterAppend(childNode, childN.id);\r\n            }\r\n        };\r\n        for (var _i = 0, _c = n.childNodes; _i < _c.length; _i++) {\r\n            var childN = _c[_i];\r\n            _loop_2(childN);\r\n        }\r\n    }\r\n    return node;\r\n}\r\nfunction visit(mirror, onVisit) {\r\n    function walk(node) {\r\n        onVisit(node);\r\n    }\r\n    for (var _i = 0, _a = mirror.getIds(); _i < _a.length; _i++) {\r\n        var id = _a[_i];\r\n        if (mirror.has(id)) {\r\n            walk(mirror.getNode(id));\r\n        }\r\n    }\r\n}\r\nfunction handleScroll(node, mirror) {\r\n    var n = mirror.getMeta(node);\r\n    if ((n === null || n === void 0 ? void 0 : n.type) !== NodeType.Element) {\r\n        return;\r\n    }\r\n    var el = node;\r\n    for (var name_3 in n.attributes) {\r\n        if (!(Object.prototype.hasOwnProperty.call(n.attributes, name_3) &&\r\n            name_3.startsWith('rr_'))) {\r\n            continue;\r\n        }\r\n        var value = n.attributes[name_3];\r\n        if (name_3 === 'rr_scrollLeft') {\r\n            el.scrollLeft = value;\r\n        }\r\n        if (name_3 === 'rr_scrollTop') {\r\n            el.scrollTop = value;\r\n        }\r\n    }\r\n}\r\nfunction rebuild(n, options) {\r\n    var doc = options.doc, onVisit = options.onVisit, _a = options.hackCss, hackCss = _a === void 0 ? true : _a, afterAppend = options.afterAppend, cache = options.cache, _b = options.mirror, mirror = _b === void 0 ? new Mirror() : _b;\r\n    var node = buildNodeWithSN(n, {\r\n        doc: doc,\r\n        mirror: mirror,\r\n        skipChild: false,\r\n        hackCss: hackCss,\r\n        afterAppend: afterAppend,\r\n        cache: cache\r\n    });\r\n    visit(mirror, function (visitedNode) {\r\n        if (onVisit) {\r\n            onVisit(visitedNode);\r\n        }\r\n        handleScroll(visitedNode, mirror);\r\n    });\r\n    return node;\r\n}\n\nexport { IGNORED_NODE, Mirror, NodeType, addHoverClass, buildNodeWithSN, classMatchesRegex, createCache, createMirror, escapeImportStatement, genId, getInputType, ignoreAttribute, is2DCanvasBlank, isCSSImportRule, isElement, isNativeShadowDom, isNodeMetaEqual, isShadowRoot, maskInputValue, needMaskingText, rebuild, serializeNodeWithId, snapshot, stringifyRule, stringifyStylesheet, toLowerCase, transformAttribute, validateStringifiedCssRule };\n","import { classMatchesRegex, IGNORED_NODE, isShadowRoot } from '../../rrweb-snapshot/es/rrweb-snapshot.js';\n\nfunction on(type, fn, target = document) {\r\n    const options = { capture: true, passive: true };\r\n    target.addEventListener(type, fn, options);\r\n    return () => target.removeEventListener(type, fn, options);\r\n}\r\nconst DEPARTED_MIRROR_ACCESS_WARNING = 'Please stop import mirror directly. Instead of that,' +\r\n    '\\r\\n' +\r\n    'now you can use replayer.getMirror() to access the mirror instance of a replayer,' +\r\n    '\\r\\n' +\r\n    'or you can use record.mirror to access the mirror instance during recording.';\r\nlet _mirror = {\r\n    map: {},\r\n    getId() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return -1;\r\n    },\r\n    getNode() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return null;\r\n    },\r\n    removeNodeFromMap() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n    },\r\n    has() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n        return false;\r\n    },\r\n    reset() {\r\n        console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n    },\r\n};\r\nif (typeof window !== 'undefined' && window.Proxy && window.Reflect) {\r\n    _mirror = new Proxy(_mirror, {\r\n        get(target, prop, receiver) {\r\n            if (prop === 'map') {\r\n                console.error(DEPARTED_MIRROR_ACCESS_WARNING);\r\n            }\r\n            return Reflect.get(target, prop, receiver);\r\n        },\r\n    });\r\n}\r\nfunction throttle(func, wait, options = {}) {\r\n    let timeout = null;\r\n    let previous = 0;\r\n    return function (...args) {\r\n        const now = Date.now();\r\n        if (!previous && options.leading === false) {\r\n            previous = now;\r\n        }\r\n        const remaining = wait - (now - previous);\r\n        const context = this;\r\n        if (remaining <= 0 || remaining > wait) {\r\n            if (timeout) {\r\n                clearTimeout(timeout);\r\n                timeout = null;\r\n            }\r\n            previous = now;\r\n            func.apply(context, args);\r\n        }\r\n        else if (!timeout && options.trailing !== false) {\r\n            timeout = setTimeout(() => {\r\n                previous = options.leading === false ? 0 : Date.now();\r\n                timeout = null;\r\n                func.apply(context, args);\r\n            }, remaining);\r\n        }\r\n    };\r\n}\r\nfunction hookSetter(target, key, d, isRevoked, win = window) {\r\n    const original = win.Object.getOwnPropertyDescriptor(target, key);\r\n    win.Object.defineProperty(target, key, isRevoked\r\n        ? d\r\n        : {\r\n            set(value) {\r\n                setTimeout(() => {\r\n                    d.set.call(this, value);\r\n                }, 0);\r\n                if (original && original.set) {\r\n                    original.set.call(this, value);\r\n                }\r\n            },\r\n        });\r\n    return () => hookSetter(target, key, original || {}, true);\r\n}\r\nfunction patch(source, name, replacement) {\r\n    try {\r\n        if (!(name in source)) {\r\n            return () => {\r\n            };\r\n        }\r\n        const original = source[name];\r\n        const wrapped = replacement(original);\r\n        if (typeof wrapped === 'function') {\r\n            wrapped.prototype = wrapped.prototype || {};\r\n            Object.defineProperties(wrapped, {\r\n                __rrweb_original__: {\r\n                    enumerable: false,\r\n                    value: original,\r\n                },\r\n            });\r\n        }\r\n        source[name] = wrapped;\r\n        return () => {\r\n            source[name] = original;\r\n        };\r\n    }\r\n    catch (_a) {\r\n        return () => {\r\n        };\r\n    }\r\n}\r\nlet nowTimestamp = Date.now;\r\nif (!(/[1-9][0-9]{12}/.test(Date.now().toString()))) {\r\n    nowTimestamp = () => new Date().getTime();\r\n}\r\nfunction getWindowScroll(win) {\r\n    var _a, _b, _c, _d, _e, _f;\r\n    const doc = win.document;\r\n    return {\r\n        left: doc.scrollingElement\r\n            ? doc.scrollingElement.scrollLeft\r\n            : win.pageXOffset !== undefined\r\n                ? win.pageXOffset\r\n                : (doc === null || doc === void 0 ? void 0 : doc.documentElement.scrollLeft) ||\r\n                    ((_b = (_a = doc === null || doc === void 0 ? void 0 : doc.body) === null || _a === void 0 ? void 0 : _a.parentElement) === null || _b === void 0 ? void 0 : _b.scrollLeft) ||\r\n                    ((_c = doc === null || doc === void 0 ? void 0 : doc.body) === null || _c === void 0 ? void 0 : _c.scrollLeft) ||\r\n                    0,\r\n        top: doc.scrollingElement\r\n            ? doc.scrollingElement.scrollTop\r\n            : win.pageYOffset !== undefined\r\n                ? win.pageYOffset\r\n                : (doc === null || doc === void 0 ? void 0 : doc.documentElement.scrollTop) ||\r\n                    ((_e = (_d = doc === null || doc === void 0 ? void 0 : doc.body) === null || _d === void 0 ? void 0 : _d.parentElement) === null || _e === void 0 ? void 0 : _e.scrollTop) ||\r\n                    ((_f = doc === null || doc === void 0 ? void 0 : doc.body) === null || _f === void 0 ? void 0 : _f.scrollTop) ||\r\n                    0,\r\n    };\r\n}\r\nfunction getWindowHeight() {\r\n    return (window.innerHeight ||\r\n        (document.documentElement && document.documentElement.clientHeight) ||\r\n        (document.body && document.body.clientHeight));\r\n}\r\nfunction getWindowWidth() {\r\n    return (window.innerWidth ||\r\n        (document.documentElement && document.documentElement.clientWidth) ||\r\n        (document.body && document.body.clientWidth));\r\n}\r\nfunction isBlocked(node, blockClass, blockSelector, checkAncestors) {\r\n    if (!node) {\r\n        return false;\r\n    }\r\n    const el = node.nodeType === node.ELEMENT_NODE\r\n        ? node\r\n        : node.parentElement;\r\n    if (!el)\r\n        return false;\r\n    try {\r\n        if (typeof blockClass === 'string') {\r\n            if (el.classList.contains(blockClass))\r\n                return true;\r\n            if (checkAncestors && el.closest('.' + blockClass) !== null)\r\n                return true;\r\n        }\r\n        else {\r\n            if (classMatchesRegex(el, blockClass, checkAncestors))\r\n                return true;\r\n        }\r\n    }\r\n    catch (e) {\r\n    }\r\n    if (blockSelector) {\r\n        if (el.matches(blockSelector))\r\n            return true;\r\n        if (checkAncestors && el.closest(blockSelector) !== null)\r\n            return true;\r\n    }\r\n    return false;\r\n}\r\nfunction isSerialized(n, mirror) {\r\n    return mirror.getId(n) !== -1;\r\n}\r\nfunction isIgnored(n, mirror) {\r\n    return mirror.getId(n) === IGNORED_NODE;\r\n}\r\nfunction isAncestorRemoved(target, mirror) {\r\n    if (isShadowRoot(target)) {\r\n        return false;\r\n    }\r\n    const id = mirror.getId(target);\r\n    if (!mirror.has(id)) {\r\n        return true;\r\n    }\r\n    if (target.parentNode &&\r\n        target.parentNode.nodeType === target.DOCUMENT_NODE) {\r\n        return false;\r\n    }\r\n    if (!target.parentNode) {\r\n        return true;\r\n    }\r\n    return isAncestorRemoved(target.parentNode, mirror);\r\n}\r\nfunction legacy_isTouchEvent(event) {\r\n    return Boolean(event.changedTouches);\r\n}\r\nfunction polyfill(win = window) {\r\n    if ('NodeList' in win && !win.NodeList.prototype.forEach) {\r\n        win.NodeList.prototype.forEach = Array.prototype\r\n            .forEach;\r\n    }\r\n    if ('DOMTokenList' in win && !win.DOMTokenList.prototype.forEach) {\r\n        win.DOMTokenList.prototype.forEach = Array.prototype\r\n            .forEach;\r\n    }\r\n    if (!Node.prototype.contains) {\r\n        Node.prototype.contains = (...args) => {\r\n            let node = args[0];\r\n            if (!(0 in args)) {\r\n                throw new TypeError('1 argument is required');\r\n            }\r\n            do {\r\n                if (this === node) {\r\n                    return true;\r\n                }\r\n            } while ((node = node && node.parentNode));\r\n            return false;\r\n        };\r\n    }\r\n}\r\nfunction queueToResolveTrees(queue) {\r\n    const queueNodeMap = {};\r\n    const putIntoMap = (m, parent) => {\r\n        const nodeInTree = {\r\n            value: m,\r\n            parent,\r\n            children: [],\r\n        };\r\n        queueNodeMap[m.node.id] = nodeInTree;\r\n        return nodeInTree;\r\n    };\r\n    const queueNodeTrees = [];\r\n    for (const mutation of queue) {\r\n        const { nextId, parentId } = mutation;\r\n        if (nextId && nextId in queueNodeMap) {\r\n            const nextInTree = queueNodeMap[nextId];\r\n            if (nextInTree.parent) {\r\n                const idx = nextInTree.parent.children.indexOf(nextInTree);\r\n                nextInTree.parent.children.splice(idx, 0, putIntoMap(mutation, nextInTree.parent));\r\n            }\r\n            else {\r\n                const idx = queueNodeTrees.indexOf(nextInTree);\r\n                queueNodeTrees.splice(idx, 0, putIntoMap(mutation, null));\r\n            }\r\n            continue;\r\n        }\r\n        if (parentId in queueNodeMap) {\r\n            const parentInTree = queueNodeMap[parentId];\r\n            parentInTree.children.push(putIntoMap(mutation, parentInTree));\r\n            continue;\r\n        }\r\n        queueNodeTrees.push(putIntoMap(mutation, null));\r\n    }\r\n    return queueNodeTrees;\r\n}\r\nfunction iterateResolveTree(tree, cb) {\r\n    cb(tree.value);\r\n    for (let i = tree.children.length - 1; i >= 0; i--) {\r\n        iterateResolveTree(tree.children[i], cb);\r\n    }\r\n}\r\nfunction isSerializedIframe(n, mirror) {\r\n    return Boolean(n.nodeName === 'IFRAME' && mirror.getMeta(n));\r\n}\r\nfunction isSerializedStylesheet(n, mirror) {\r\n    return Boolean(n.nodeName === 'LINK' &&\r\n        n.nodeType === n.ELEMENT_NODE &&\r\n        n.getAttribute &&\r\n        n.getAttribute('rel') === 'stylesheet' &&\r\n        mirror.getMeta(n));\r\n}\r\nfunction getBaseDimension(node, rootIframe) {\r\n    var _a, _b;\r\n    const frameElement = (_b = (_a = node.ownerDocument) === null || _a === void 0 ? void 0 : _a.defaultView) === null || _b === void 0 ? void 0 : _b.frameElement;\r\n    if (!frameElement || frameElement === rootIframe) {\r\n        return {\r\n            x: 0,\r\n            y: 0,\r\n            relativeScale: 1,\r\n            absoluteScale: 1,\r\n        };\r\n    }\r\n    const frameDimension = frameElement.getBoundingClientRect();\r\n    const frameBaseDimension = getBaseDimension(frameElement, rootIframe);\r\n    const relativeScale = frameDimension.height / frameElement.clientHeight;\r\n    return {\r\n        x: frameDimension.x * frameBaseDimension.relativeScale +\r\n            frameBaseDimension.x,\r\n        y: frameDimension.y * frameBaseDimension.relativeScale +\r\n            frameBaseDimension.y,\r\n        relativeScale,\r\n        absoluteScale: frameBaseDimension.absoluteScale * relativeScale,\r\n    };\r\n}\r\nfunction hasShadowRoot(n) {\r\n    return Boolean(n === null || n === void 0 ? void 0 : n.shadowRoot);\r\n}\r\nfunction getNestedRule(rules, position) {\r\n    const rule = rules[position[0]];\r\n    if (position.length === 1) {\r\n        return rule;\r\n    }\r\n    else {\r\n        return getNestedRule(rule.cssRules[position[1]].cssRules, position.slice(2));\r\n    }\r\n}\r\nfunction getPositionsAndIndex(nestedIndex) {\r\n    const positions = [...nestedIndex];\r\n    const index = positions.pop();\r\n    return { positions, index };\r\n}\r\nfunction uniqueTextMutations(mutations) {\r\n    const idSet = new Set();\r\n    const uniqueMutations = [];\r\n    for (let i = mutations.length; i--;) {\r\n        const mutation = mutations[i];\r\n        if (!idSet.has(mutation.id)) {\r\n            uniqueMutations.push(mutation);\r\n            idSet.add(mutation.id);\r\n        }\r\n    }\r\n    return uniqueMutations;\r\n}\r\nclass StyleSheetMirror {\r\n    constructor() {\r\n        this.id = 1;\r\n        this.styleIDMap = new WeakMap();\r\n        this.idStyleMap = new Map();\r\n    }\r\n    getId(stylesheet) {\r\n        var _a;\r\n        return (_a = this.styleIDMap.get(stylesheet)) !== null && _a !== void 0 ? _a : -1;\r\n    }\r\n    has(stylesheet) {\r\n        return this.styleIDMap.has(stylesheet);\r\n    }\r\n    add(stylesheet, id) {\r\n        if (this.has(stylesheet))\r\n            return this.getId(stylesheet);\r\n        let newId;\r\n        if (id === undefined) {\r\n            newId = this.id++;\r\n        }\r\n        else\r\n            newId = id;\r\n        this.styleIDMap.set(stylesheet, newId);\r\n        this.idStyleMap.set(newId, stylesheet);\r\n        return newId;\r\n    }\r\n    getStyle(id) {\r\n        return this.idStyleMap.get(id) || null;\r\n    }\r\n    reset() {\r\n        this.styleIDMap = new WeakMap();\r\n        this.idStyleMap = new Map();\r\n        this.id = 1;\r\n    }\r\n    generateId() {\r\n        return this.id++;\r\n    }\r\n}\r\nfunction getShadowHost(n) {\r\n    var _a, _b;\r\n    let shadowHost = null;\r\n    if (((_b = (_a = n.getRootNode) === null || _a === void 0 ? void 0 : _a.call(n)) === null || _b === void 0 ? void 0 : _b.nodeType) === Node.DOCUMENT_FRAGMENT_NODE &&\r\n        n.getRootNode().host)\r\n        shadowHost = n.getRootNode().host;\r\n    return shadowHost;\r\n}\r\nfunction getRootShadowHost(n) {\r\n    let rootShadowHost = n;\r\n    let shadowHost;\r\n    while ((shadowHost = getShadowHost(rootShadowHost)))\r\n        rootShadowHost = shadowHost;\r\n    return rootShadowHost;\r\n}\r\nfunction shadowHostInDom(n) {\r\n    const doc = n.ownerDocument;\r\n    if (!doc)\r\n        return false;\r\n    const shadowHost = getRootShadowHost(n);\r\n    return doc.contains(shadowHost);\r\n}\r\nfunction inDom(n) {\r\n    const doc = n.ownerDocument;\r\n    if (!doc)\r\n        return false;\r\n    return doc.contains(n) || shadowHostInDom(n);\r\n}\n\nexport { StyleSheetMirror, _mirror, getBaseDimension, getNestedRule, getPositionsAndIndex, getRootShadowHost, getShadowHost, getWindowHeight, getWindowScroll, getWindowWidth, hasShadowRoot, hookSetter, inDom, isAncestorRemoved, isBlocked, isIgnored, isSerialized, isSerializedIframe, isSerializedStylesheet, iterateResolveTree, legacy_isTouchEvent, nowTimestamp, on, patch, polyfill, queueToResolveTrees, shadowHostInDom, throttle, uniqueTextMutations };\n","var EventType = /* @__PURE__ */ ((EventType2) => {\n  EventType2[EventType2[\"DomContentLoaded\"] = 0] = \"DomContentLoaded\";\n  EventType2[EventType2[\"Load\"] = 1] = \"Load\";\n  EventType2[EventType2[\"FullSnapshot\"] = 2] = \"FullSnapshot\";\n  EventType2[EventType2[\"IncrementalSnapshot\"] = 3] = \"IncrementalSnapshot\";\n  EventType2[EventType2[\"Meta\"] = 4] = \"Meta\";\n  EventType2[EventType2[\"Custom\"] = 5] = \"Custom\";\n  EventType2[EventType2[\"Plugin\"] = 6] = \"Plugin\";\n  return EventType2;\n})(EventType || {});\nvar IncrementalSource = /* @__PURE__ */ ((IncrementalSource2) => {\n  IncrementalSource2[IncrementalSource2[\"Mutation\"] = 0] = \"Mutation\";\n  IncrementalSource2[IncrementalSource2[\"MouseMove\"] = 1] = \"MouseMove\";\n  IncrementalSource2[IncrementalSource2[\"MouseInteraction\"] = 2] = \"MouseInteraction\";\n  IncrementalSource2[IncrementalSource2[\"Scroll\"] = 3] = \"Scroll\";\n  IncrementalSource2[IncrementalSource2[\"ViewportResize\"] = 4] = \"ViewportResize\";\n  IncrementalSource2[IncrementalSource2[\"Input\"] = 5] = \"Input\";\n  IncrementalSource2[IncrementalSource2[\"TouchMove\"] = 6] = \"TouchMove\";\n  IncrementalSource2[IncrementalSource2[\"MediaInteraction\"] = 7] = \"MediaInteraction\";\n  IncrementalSource2[IncrementalSource2[\"StyleSheetRule\"] = 8] = \"StyleSheetRule\";\n  IncrementalSource2[IncrementalSource2[\"CanvasMutation\"] = 9] = \"CanvasMutation\";\n  IncrementalSource2[IncrementalSource2[\"Font\"] = 10] = \"Font\";\n  IncrementalSource2[IncrementalSource2[\"Log\"] = 11] = \"Log\";\n  IncrementalSource2[IncrementalSource2[\"Drag\"] = 12] = \"Drag\";\n  IncrementalSource2[IncrementalSource2[\"StyleDeclaration\"] = 13] = \"StyleDeclaration\";\n  IncrementalSource2[IncrementalSource2[\"Selection\"] = 14] = \"Selection\";\n  IncrementalSource2[IncrementalSource2[\"AdoptedStyleSheet\"] = 15] = \"AdoptedStyleSheet\";\n  return IncrementalSource2;\n})(IncrementalSource || {});\nvar MouseInteractions = /* @__PURE__ */ ((MouseInteractions2) => {\n  MouseInteractions2[MouseInteractions2[\"MouseUp\"] = 0] = \"MouseUp\";\n  MouseInteractions2[MouseInteractions2[\"MouseDown\"] = 1] = \"MouseDown\";\n  MouseInteractions2[MouseInteractions2[\"Click\"] = 2] = \"Click\";\n  MouseInteractions2[MouseInteractions2[\"ContextMenu\"] = 3] = \"ContextMenu\";\n  MouseInteractions2[MouseInteractions2[\"DblClick\"] = 4] = \"DblClick\";\n  MouseInteractions2[MouseInteractions2[\"Focus\"] = 5] = \"Focus\";\n  MouseInteractions2[MouseInteractions2[\"Blur\"] = 6] = \"Blur\";\n  MouseInteractions2[MouseInteractions2[\"TouchStart\"] = 7] = \"TouchStart\";\n  MouseInteractions2[MouseInteractions2[\"TouchMove_Departed\"] = 8] = \"TouchMove_Departed\";\n  MouseInteractions2[MouseInteractions2[\"TouchEnd\"] = 9] = \"TouchEnd\";\n  MouseInteractions2[MouseInteractions2[\"TouchCancel\"] = 10] = \"TouchCancel\";\n  return MouseInteractions2;\n})(MouseInteractions || {});\nvar PointerTypes = /* @__PURE__ */ ((PointerTypes2) => {\n  PointerTypes2[PointerTypes2[\"Mouse\"] = 0] = \"Mouse\";\n  PointerTypes2[PointerTypes2[\"Pen\"] = 1] = \"Pen\";\n  PointerTypes2[PointerTypes2[\"Touch\"] = 2] = \"Touch\";\n  return PointerTypes2;\n})(PointerTypes || {});\nvar CanvasContext = /* @__PURE__ */ ((CanvasContext2) => {\n  CanvasContext2[CanvasContext2[\"2D\"] = 0] = \"2D\";\n  CanvasContext2[CanvasContext2[\"WebGL\"] = 1] = \"WebGL\";\n  CanvasContext2[CanvasContext2[\"WebGL2\"] = 2] = \"WebGL2\";\n  return CanvasContext2;\n})(CanvasContext || {});\nvar ReplayerEvents = /* @__PURE__ */ ((ReplayerEvents2) => {\n  ReplayerEvents2[\"Start\"] = \"start\";\n  ReplayerEvents2[\"Pause\"] = \"pause\";\n  ReplayerEvents2[\"Resume\"] = \"resume\";\n  ReplayerEvents2[\"Resize\"] = \"resize\";\n  ReplayerEvents2[\"Finish\"] = \"finish\";\n  ReplayerEvents2[\"FullsnapshotRebuilded\"] = \"fullsnapshot-rebuilded\";\n  ReplayerEvents2[\"LoadStylesheetStart\"] = \"load-stylesheet-start\";\n  ReplayerEvents2[\"LoadStylesheetEnd\"] = \"load-stylesheet-end\";\n  ReplayerEvents2[\"SkipStart\"] = \"skip-start\";\n  ReplayerEvents2[\"SkipEnd\"] = \"skip-end\";\n  ReplayerEvents2[\"MouseInteraction\"] = \"mouse-interaction\";\n  ReplayerEvents2[\"EventCast\"] = \"event-cast\";\n  ReplayerEvents2[\"CustomEvent\"] = \"custom-event\";\n  ReplayerEvents2[\"Flush\"] = \"flush\";\n  ReplayerEvents2[\"StateChange\"] = \"state-change\";\n  ReplayerEvents2[\"PlayBack\"] = \"play-back\";\n  ReplayerEvents2[\"Destroy\"] = \"destroy\";\n  return ReplayerEvents2;\n})(ReplayerEvents || {});\n\nexport { CanvasContext, EventType, IncrementalSource, MouseInteractions, PointerTypes, ReplayerEvents };\n","import {\r\n  isShadowRoot,\r\n  isNativeShadowDom,\r\n  getInputType,\r\n  maskInputValue,\r\n  ignoreAttribute,\r\n  transformAttribute,\r\n  toLowerCase,\r\n  needMaskingText,\r\n  IGNORED_NODE,\r\n  serializeNodeWithId,\r\n} from \"../../../rrweb-snapshot/es/rrweb-snapshot.js\";\r\nimport {\r\n  isIgnored,\r\n  isBlocked,\r\n  isSerialized,\r\n  isAncestorRemoved,\r\n  hasShadowRoot,\r\n  inDom,\r\n  getShadowHost,\r\n  isSerializedIframe,\r\n  isSerializedStylesheet,\r\n} from \"../utils.js\";\r\n\nfunction isNodeInLinkedList(n) {\r\n  return \"__ln\" in n;\r\n}\r\nclass DoubleLinkedList {\r\n  constructor() {\r\n    this.length = 0;\r\n    this.head = null;\r\n    this.tail = null;\r\n  }\r\n  get(position) {\r\n    if (position >= this.length) {\r\n      throw new Error(\"Position outside of list range\");\r\n    }\r\n    let current = this.head;\r\n    for (let index = 0; index < position; index++) {\r\n      current =\r\n        (current === null || current === void 0 ? void 0 : current.next) ||\r\n        null;\r\n    }\r\n    return current;\r\n  }\r\n  addNode(n) {\r\n    const node = {\r\n      value: n,\r\n      previous: null,\r\n      next: null,\r\n    };\r\n    n.__ln = node;\r\n    if (n.previousSibling && isNodeInLinkedList(n.previousSibling)) {\r\n      const current = n.previousSibling.__ln.next;\r\n      node.next = current;\r\n      node.previous = n.previousSibling.__ln;\r\n      n.previousSibling.__ln.next = node;\r\n      if (current) {\r\n        current.previous = node;\r\n      }\r\n    } else if (\r\n      n.nextSibling &&\r\n      isNodeInLinkedList(n.nextSibling) &&\r\n      n.nextSibling.__ln.previous\r\n    ) {\r\n      const current = n.nextSibling.__ln.previous;\r\n      node.previous = current;\r\n      node.next = n.nextSibling.__ln;\r\n      n.nextSibling.__ln.previous = node;\r\n      if (current) {\r\n        current.next = node;\r\n      }\r\n    } else {\r\n      if (this.head) {\r\n        this.head.previous = node;\r\n      }\r\n      node.next = this.head;\r\n      this.head = node;\r\n    }\r\n    if (node.next === null) {\r\n      this.tail = node;\r\n    }\r\n    this.length++;\r\n  }\r\n  removeNode(n) {\r\n    const current = n.__ln;\r\n    if (!this.head) {\r\n      return;\r\n    }\r\n    if (!current.previous) {\r\n      this.head = current.next;\r\n      if (this.head) {\r\n        this.head.previous = null;\r\n      } else {\r\n        this.tail = null;\r\n      }\r\n    } else {\r\n      current.previous.next = current.next;\r\n      if (current.next) {\r\n        current.next.previous = current.previous;\r\n      } else {\r\n        this.tail = current.previous;\r\n      }\r\n    }\r\n    if (n.__ln) {\r\n      delete n.__ln;\r\n    }\r\n    this.length--;\r\n  }\r\n}\r\nconst moveKey = (id, parentId) => `${id}@${parentId}`;\r\nclass MutationBuffer {\r\n  constructor() {\r\n    this.frozen = false;\r\n    this.locked = false;\r\n    this.texts = [];\r\n    this.attributes = [];\r\n    this.removes = [];\r\n    this.mapRemoves = [];\r\n    this.movedMap = {};\r\n    this.addedSet = new Set();\r\n    this.movedSet = new Set();\r\n    this.droppedSet = new Set();\r\n    this.unattachedDoc = null;\r\n    this.processMutations = (mutations) => {\r\n      mutations.forEach(this.processMutation);\r\n      this.emit();\r\n    };\r\n    this.emit = () => {\r\n      if (this.frozen || this.locked) {\r\n        return;\r\n      }\r\n      const adds = [];\r\n      const addedIds = new Set();\r\n      const addList = new DoubleLinkedList();\r\n      const getNextId = (n) => {\r\n        let ns = n;\r\n        let nextId = IGNORED_NODE;\r\n        while (nextId === IGNORED_NODE) {\r\n          ns = ns && ns.nextSibling;\r\n          nextId = ns && this.mirror.getId(ns);\r\n        }\r\n        return nextId;\r\n      };\r\n      const pushAdd = (n) => {\r\n        if (!n.parentNode || !inDom(n)) {\r\n          return;\r\n        }\r\n        const parentId = isShadowRoot(n.parentNode)\r\n          ? this.mirror.getId(getShadowHost(n))\r\n          : this.mirror.getId(n.parentNode);\r\n        const nextId = getNextId(n);\r\n        if (parentId === -1 || nextId === -1) {\r\n          return addList.addNode(n);\r\n        }\r\n        const sn = serializeNodeWithId(n, {\r\n          doc: this.doc,\r\n          mirror: this.mirror,\r\n          blockClass: this.blockClass,\r\n          blockSelector: this.blockSelector,\r\n          maskTextClass: this.maskTextClass,\r\n          maskTextSelector: this.maskTextSelector,\r\n          skipChild: true,\r\n          newlyAddedElement: true,\r\n          inlineStylesheet: this.inlineStylesheet,\r\n          maskInputOptions: this.maskInputOptions,\r\n          maskTextFn: this.maskTextFn,\r\n          maskInputFn: this.maskInputFn,\r\n          slimDOMOptions: this.slimDOMOptions,\r\n          dataURLOptions: this.dataURLOptions,\r\n          recordCanvas: this.recordCanvas,\r\n          inlineImages: this.inlineImages,\r\n          onSerialize: (currentN) => {\r\n            if (isSerializedIframe(currentN, this.mirror)) {\r\n              this.iframeManager.addIframe(currentN);\r\n            }\r\n            if (isSerializedStylesheet(currentN, this.mirror)) {\r\n              this.stylesheetManager.trackLinkElement(currentN);\r\n            }\r\n            if (hasShadowRoot(n)) {\r\n              this.shadowDomManager.addShadowRoot(n.shadowRoot, this.doc);\r\n            }\r\n          },\r\n          onIframeLoad: (iframe, childSn) => {\r\n            this.iframeManager.attachIframe(iframe, childSn);\r\n            this.shadowDomManager.observeAttachShadow(iframe);\r\n          },\r\n          onStylesheetLoad: (link, childSn) => {\r\n            this.stylesheetManager.attachLinkElement(link, childSn);\r\n          },\r\n        });\r\n        if (sn) {\r\n          adds.push({\r\n            parentId,\r\n            nextId,\r\n            node: sn,\r\n          });\r\n          addedIds.add(sn.id);\r\n        }\r\n      };\r\n      while (this.mapRemoves.length) {\r\n        this.mirror.removeNodeFromMap(this.mapRemoves.shift());\r\n      }\r\n      for (const n of this.movedSet) {\r\n        if (\r\n          isParentRemoved(this.removes, n, this.mirror) &&\r\n          !this.movedSet.has(n.parentNode)\r\n        ) {\r\n          continue;\r\n        }\r\n        pushAdd(n);\r\n      }\r\n      for (const n of this.addedSet) {\r\n        if (\r\n          !isAncestorInSet(this.droppedSet, n) &&\r\n          !isParentRemoved(this.removes, n, this.mirror)\r\n        ) {\r\n          pushAdd(n);\r\n        } else if (isAncestorInSet(this.movedSet, n)) {\r\n          pushAdd(n);\r\n        } else {\r\n          this.droppedSet.add(n);\r\n        }\r\n      }\r\n      let candidate = null;\r\n      while (addList.length) {\r\n        let node = null;\r\n        if (candidate) {\r\n          const parentId = this.mirror.getId(candidate.value.parentNode);\r\n          const nextId = getNextId(candidate.value);\r\n          if (parentId !== -1 && nextId !== -1) {\r\n            node = candidate;\r\n          }\r\n        }\r\n        if (!node) {\r\n          let tailNode = addList.tail;\r\n          while (tailNode) {\r\n            const _node = tailNode;\r\n            tailNode = tailNode.previous;\r\n            if (_node) {\r\n              const parentId = this.mirror.getId(_node.value.parentNode);\r\n              const nextId = getNextId(_node.value);\r\n              if (nextId === -1) continue;\r\n              else if (parentId !== -1) {\r\n                node = _node;\r\n                break;\r\n              } else {\r\n                const unhandledNode = _node.value;\r\n                if (\r\n                  unhandledNode.parentNode &&\r\n                  unhandledNode.parentNode.nodeType ===\r\n                    Node.DOCUMENT_FRAGMENT_NODE\r\n                ) {\r\n                  const shadowHost = unhandledNode.parentNode.host;\r\n                  const parentId = this.mirror.getId(shadowHost);\r\n                  if (parentId !== -1) {\r\n                    node = _node;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (!node) {\r\n          while (addList.head) {\r\n            addList.removeNode(addList.head.value);\r\n          }\r\n          break;\r\n        }\r\n        candidate = node.previous;\r\n        addList.removeNode(node.value);\r\n        pushAdd(node.value);\r\n      }\r\n      const payload = {\r\n        texts: this.texts\r\n          .map((text) => ({\r\n            id: this.mirror.getId(text.node),\r\n            value: text.value,\r\n          }))\r\n          .filter((text) => !addedIds.has(text.id))\r\n          .filter((text) => this.mirror.has(text.id)),\r\n        attributes: this.attributes\r\n          .map((attribute) => {\r\n            const { attributes } = attribute;\r\n            if (typeof attributes.style === \"string\") {\r\n              const diffAsStr = JSON.stringify(attribute.styleDiff);\r\n              const unchangedAsStr = JSON.stringify(attribute._unchangedStyles);\r\n              if (diffAsStr.length < attributes.style.length) {\r\n                if (\r\n                  (diffAsStr + unchangedAsStr).split(\"var(\").length ===\r\n                  attributes.style.split(\"var(\").length\r\n                ) {\r\n                  attributes.style = attribute.styleDiff;\r\n                }\r\n              }\r\n            }\r\n            return {\r\n              id: this.mirror.getId(attribute.node),\r\n              attributes: attributes,\r\n            };\r\n          })\r\n          .filter((attribute) => !addedIds.has(attribute.id))\r\n          .filter((attribute) => this.mirror.has(attribute.id)),\r\n        removes: this.removes,\r\n        adds,\r\n      };\r\n      if (\r\n        !payload.texts.length &&\r\n        !payload.attributes.length &&\r\n        !payload.removes.length &&\r\n        !payload.adds.length\r\n      ) {\r\n        return;\r\n      }\r\n      this.texts = [];\r\n      this.attributes = [];\r\n      this.removes = [];\r\n      this.addedSet = new Set();\r\n      this.movedSet = new Set();\r\n      this.droppedSet = new Set();\r\n      this.movedMap = {};\r\n      this.mutationCb(payload);\r\n    };\r\n    this.processMutation = (m) => {\r\n      if (isIgnored(m.target, this.mirror)) {\r\n        return;\r\n      }\r\n      switch (m.type) {\r\n        case \"characterData\": {\r\n          const value = m.target.textContent;\r\n          if (\r\n            !isBlocked(m.target, this.blockClass, this.blockSelector, false) &&\r\n            value !== m.oldValue\r\n          ) {\r\n            this.texts.push({\r\n              value:\r\n                needMaskingText(\r\n                  m.target,\r\n                  this.maskTextClass,\r\n                  this.maskTextSelector\r\n                ) && value\r\n                  ? this.maskTextFn\r\n                    ? this.maskTextFn(value)\r\n                    : value.replace(/[\\S]/g, \"*\")\r\n                  : value,\r\n              node: m.target,\r\n            });\r\n          }\r\n          break;\r\n        }\r\n        case \"attributes\": {\r\n          const target = m.target;\r\n          let attributeName = m.attributeName;\r\n          let value = m.target.getAttribute(attributeName);\r\n          if (attributeName === \"value\") {\r\n            const type = getInputType(target);\r\n            value = maskInputValue({\r\n              element: target,\r\n              maskInputOptions: this.maskInputOptions,\r\n              tagName: target.tagName,\r\n              type,\r\n              value,\r\n              maskInputFn: this.maskInputFn,\r\n            });\r\n          }\r\n          if (\r\n            isBlocked(m.target, this.blockClass, this.blockSelector, false) ||\r\n            value === m.oldValue\r\n          ) {\r\n            return;\r\n          }\r\n          let item = this.attributes.find((a) => a.node === m.target);\r\n          if (\r\n            target.tagName === \"IFRAME\" &&\r\n            attributeName === \"src\" &&\r\n            !this.keepIframeSrcFn(value)\r\n          ) {\r\n            if (!target.contentDocument) {\r\n              attributeName = \"rr_src\";\r\n            } else {\r\n              return;\r\n            }\r\n          }\r\n          if (!item) {\r\n            item = {\r\n              node: m.target,\r\n              attributes: {},\r\n              styleDiff: {},\r\n              _unchangedStyles: {},\r\n            };\r\n            this.attributes.push(item);\r\n          }\r\n          if (\r\n            attributeName === \"type\" &&\r\n            target.tagName === \"INPUT\" &&\r\n            (m.oldValue || \"\").toLowerCase() === \"password\"\r\n          ) {\r\n            target.setAttribute(\"data-rr-is-password\", \"true\");\r\n          }\r\n          if (!ignoreAttribute(target.tagName, attributeName)) {\r\n            item.attributes[attributeName] = transformAttribute(\r\n              this.doc,\r\n              toLowerCase(target.tagName),\r\n              toLowerCase(attributeName),\r\n              value\r\n            );\r\n            if (attributeName === \"style\") {\r\n              if (!this.unattachedDoc) {\r\n                try {\r\n                  // avoid upsetting original document from a Content Security point of view\r\n                  this.unattachedDoc =\r\n                    document.implementation.createHTMLDocument();\r\n                } catch (e) {\r\n                  // fallback to more direct method\r\n                  this.unattachedDoc = this.doc;\r\n                }\r\n              }\r\n              const old = this.unattachedDoc.createElement(\"span\");\r\n              if (m.oldValue) {\r\n                old.setAttribute(\"style\", m.oldValue);\r\n              }\r\n              for (const pname of Array.from(target.style)) {\r\n                const newValue = target.style.getPropertyValue(pname);\r\n                const newPriority = target.style.getPropertyPriority(pname);\r\n                if (\r\n                  newValue !== old.style.getPropertyValue(pname) ||\r\n                  newPriority !== old.style.getPropertyPriority(pname)\r\n                ) {\r\n                  if (newPriority === \"\") {\r\n                    item.styleDiff[pname] = newValue;\r\n                  } else {\r\n                    item.styleDiff[pname] = [newValue, newPriority];\r\n                  }\r\n                } else {\r\n                  item._unchangedStyles[pname] = [newValue, newPriority];\r\n                }\r\n              }\r\n              for (const pname of Array.from(old.style)) {\r\n                if (target.style.getPropertyValue(pname) === \"\") {\r\n                  item.styleDiff[pname] = false;\r\n                }\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        }\r\n        case \"childList\": {\r\n          if (isBlocked(m.target, this.blockClass, this.blockSelector, true))\r\n            return;\r\n          m.addedNodes.forEach((n) => this.genAdds(n, m.target));\r\n          m.removedNodes.forEach((n) => {\r\n            const nodeId = this.mirror.getId(n);\r\n            const parentId = isShadowRoot(m.target)\r\n              ? this.mirror.getId(m.target.host)\r\n              : this.mirror.getId(m.target);\r\n            if (\r\n              isBlocked(m.target, this.blockClass, this.blockSelector, false) ||\r\n              isIgnored(n, this.mirror) ||\r\n              !isSerialized(n, this.mirror)\r\n            ) {\r\n              return;\r\n            }\r\n            if (this.addedSet.has(n)) {\r\n              deepDelete(this.addedSet, n);\r\n              this.droppedSet.add(n);\r\n            } else if (this.addedSet.has(m.target) && nodeId === -1);\r\n            else if (isAncestorRemoved(m.target, this.mirror));\r\n            else if (\r\n              this.movedSet.has(n) &&\r\n              this.movedMap[moveKey(nodeId, parentId)]\r\n            ) {\r\n              deepDelete(this.movedSet, n);\r\n            } else {\r\n              this.removes.push({\r\n                parentId,\r\n                id: nodeId,\r\n                isShadow:\r\n                  isShadowRoot(m.target) && isNativeShadowDom(m.target)\r\n                    ? true\r\n                    : undefined,\r\n              });\r\n            }\r\n            this.mapRemoves.push(n);\r\n          });\r\n          break;\r\n        }\r\n      }\r\n    };\r\n    this.genAdds = (n, target) => {\r\n      if (this.processedNodeManager.inOtherBuffer(n, this)) return;\r\n      if (this.addedSet.has(n) || this.movedSet.has(n)) return;\r\n      if (this.mirror.hasNode(n)) {\r\n        if (isIgnored(n, this.mirror)) {\r\n          return;\r\n        }\r\n        this.movedSet.add(n);\r\n        let targetId = null;\r\n        if (target && this.mirror.hasNode(target)) {\r\n          targetId = this.mirror.getId(target);\r\n        }\r\n        if (targetId && targetId !== -1) {\r\n          this.movedMap[moveKey(this.mirror.getId(n), targetId)] = true;\r\n        }\r\n      } else {\r\n        this.addedSet.add(n);\r\n        this.droppedSet.delete(n);\r\n      }\r\n      if (!isBlocked(n, this.blockClass, this.blockSelector, false)) {\r\n        n.childNodes.forEach((childN) => this.genAdds(childN));\r\n        if (hasShadowRoot(n)) {\r\n          n.shadowRoot.childNodes.forEach((childN) => {\r\n            this.processedNodeManager.add(childN, this);\r\n            this.genAdds(childN, n);\r\n          });\r\n        }\r\n      }\r\n    };\r\n  }\r\n  init(options) {\r\n    [\r\n      \"mutationCb\",\r\n      \"blockClass\",\r\n      \"blockSelector\",\r\n      \"maskTextClass\",\r\n      \"maskTextSelector\",\r\n      \"inlineStylesheet\",\r\n      \"maskInputOptions\",\r\n      \"maskTextFn\",\r\n      \"maskInputFn\",\r\n      \"keepIframeSrcFn\",\r\n      \"recordCanvas\",\r\n      \"inlineImages\",\r\n      \"slimDOMOptions\",\r\n      \"dataURLOptions\",\r\n      \"doc\",\r\n      \"mirror\",\r\n      \"iframeManager\",\r\n      \"stylesheetManager\",\r\n      \"shadowDomManager\",\r\n      \"canvasManager\",\r\n      \"processedNodeManager\",\r\n    ].forEach((key) => {\r\n      this[key] = options[key];\r\n    });\r\n  }\r\n  freeze() {\r\n    this.frozen = true;\r\n    this.canvasManager.freeze();\r\n  }\r\n  unfreeze() {\r\n    this.frozen = false;\r\n    this.canvasManager.unfreeze();\r\n    this.emit();\r\n  }\r\n  isFrozen() {\r\n    return this.frozen;\r\n  }\r\n  lock() {\r\n    this.locked = true;\r\n    this.canvasManager.lock();\r\n  }\r\n  unlock() {\r\n    this.locked = false;\r\n    this.canvasManager.unlock();\r\n    this.emit();\r\n  }\r\n  reset() {\r\n    this.shadowDomManager.reset();\r\n    this.canvasManager.reset();\r\n  }\r\n}\r\nfunction deepDelete(addsSet, n) {\r\n  addsSet.delete(n);\r\n  n.childNodes.forEach((childN) => deepDelete(addsSet, childN));\r\n}\r\nfunction isParentRemoved(removes, n, mirror) {\r\n  if (removes.length === 0) return false;\r\n  return _isParentRemoved(removes, n, mirror);\r\n}\r\nfunction _isParentRemoved(removes, n, mirror) {\r\n  const { parentNode } = n;\r\n  if (!parentNode) {\r\n    return false;\r\n  }\r\n  const parentId = mirror.getId(parentNode);\r\n  if (removes.some((r) => r.id === parentId)) {\r\n    return true;\r\n  }\r\n  return _isParentRemoved(removes, parentNode, mirror);\r\n}\r\nfunction isAncestorInSet(set, n) {\r\n  if (set.size === 0) return false;\r\n  return _isAncestorInSet(set, n);\r\n}\r\nfunction _isAncestorInSet(set, n) {\r\n  const { parentNode } = n;\r\n  if (!parentNode) {\r\n    return false;\r\n  }\r\n  if (set.has(parentNode)) {\r\n    return true;\r\n  }\r\n  return _isAncestorInSet(set, parentNode);\r\n}\n\nexport { MutationBuffer as default };\n","let errorHandler;\r\nfunction registerErrorHandler(handler) {\r\n    errorHandler = handler;\r\n}\r\nfunction unregisterErrorHandler() {\r\n    errorHandler = undefined;\r\n}\r\nconst callbackWrapper = (cb) => {\r\n    if (!errorHandler) {\r\n        return cb;\r\n    }\r\n    const rrwebWrapped = ((...rest) => {\r\n        try {\r\n            return cb(...rest);\r\n        }\r\n        catch (error) {\r\n            if (errorHandler && errorHandler(error) === true) {\r\n                return;\r\n            }\r\n            throw error;\r\n        }\r\n    });\r\n    return rrwebWrapped;\r\n};\n\nexport { callbackWrapper, registerErrorHandler, unregisterErrorHandler };\n","import { toLowerCase, getInputType, maskInputValue } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { on, throttle, isBlocked, getWindowScroll, getWindowHeight, getWindowWidth, hookSetter, patch, legacy_isTouchEvent, nowTimestamp } from '../utils.js';\nimport { MouseInteractions, IncrementalSource, PointerTypes } from '../../../types/dist/types.js';\nimport MutationBuffer from './mutation.js';\nimport { callbackWrapper } from './error-handler.js';\n\nconst mutationBuffers = [];\r\nfunction getEventTarget(event) {\r\n    try {\r\n        if ('composedPath' in event) {\r\n            const path = event.composedPath();\r\n            if (path.length) {\r\n                return path[0];\r\n            }\r\n        }\r\n        else if ('path' in event && event.path.length) {\r\n            return event.path[0];\r\n        }\r\n    }\r\n    catch (_a) {\r\n    }\r\n    return event && event.target;\r\n}\r\nfunction initMutationObserver(options, rootEl) {\r\n    var _a, _b;\r\n    const mutationBuffer = new MutationBuffer();\r\n    mutationBuffers.push(mutationBuffer);\r\n    mutationBuffer.init(options);\r\n    let mutationObserverCtor = window.MutationObserver ||\r\n        window.__rrMutationObserver;\r\n    const angularZoneSymbol = (_b = (_a = window === null || window === void 0 ? void 0 : window.Zone) === null || _a === void 0 ? void 0 : _a.__symbol__) === null || _b === void 0 ? void 0 : _b.call(_a, 'MutationObserver');\r\n    if (angularZoneSymbol &&\r\n        window[angularZoneSymbol]) {\r\n        mutationObserverCtor = window[angularZoneSymbol];\r\n    }\r\n    const observer = new mutationObserverCtor(callbackWrapper(mutationBuffer.processMutations.bind(mutationBuffer)));\r\n    observer.observe(rootEl, {\r\n        attributes: true,\r\n        attributeOldValue: true,\r\n        characterData: true,\r\n        characterDataOldValue: true,\r\n        childList: true,\r\n        subtree: true,\r\n    });\r\n    return observer;\r\n}\r\nfunction initMoveObserver({ mousemoveCb, sampling, doc, mirror, }) {\r\n    if (sampling.mousemove === false) {\r\n        return () => {\r\n        };\r\n    }\r\n    const threshold = typeof sampling.mousemove === 'number' ? sampling.mousemove : 50;\r\n    const callbackThreshold = typeof sampling.mousemoveCallback === 'number'\r\n        ? sampling.mousemoveCallback\r\n        : 500;\r\n    let positions = [];\r\n    let timeBaseline;\r\n    const wrappedCb = throttle(callbackWrapper((source) => {\r\n        const totalOffset = Date.now() - timeBaseline;\r\n        mousemoveCb(positions.map((p) => {\r\n            p.timeOffset -= totalOffset;\r\n            return p;\r\n        }), source);\r\n        positions = [];\r\n        timeBaseline = null;\r\n    }), callbackThreshold);\r\n    const updatePosition = callbackWrapper(throttle(callbackWrapper((evt) => {\r\n        const target = getEventTarget(evt);\r\n        const { clientX, clientY } = legacy_isTouchEvent(evt)\r\n            ? evt.changedTouches[0]\r\n            : evt;\r\n        if (!timeBaseline) {\r\n            timeBaseline = nowTimestamp();\r\n        }\r\n        positions.push({\r\n            x: clientX,\r\n            y: clientY,\r\n            id: mirror.getId(target),\r\n            timeOffset: nowTimestamp() - timeBaseline,\r\n        });\r\n        wrappedCb(typeof DragEvent !== 'undefined' && evt instanceof DragEvent\r\n            ? IncrementalSource.Drag\r\n            : evt instanceof MouseEvent\r\n                ? IncrementalSource.MouseMove\r\n                : IncrementalSource.TouchMove);\r\n    }), threshold, {\r\n        trailing: false,\r\n    }));\r\n    const handlers = [\r\n        on('mousemove', updatePosition, doc),\r\n        on('touchmove', updatePosition, doc),\r\n        on('drag', updatePosition, doc),\r\n    ];\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initMouseInteractionObserver({ mouseInteractionCb, doc, mirror, blockClass, blockSelector, sampling, }) {\r\n    if (sampling.mouseInteraction === false) {\r\n        return () => {\r\n        };\r\n    }\r\n    const disableMap = sampling.mouseInteraction === true ||\r\n        sampling.mouseInteraction === undefined\r\n        ? {}\r\n        : sampling.mouseInteraction;\r\n    const handlers = [];\r\n    let currentPointerType = null;\r\n    const getHandler = (eventKey) => {\r\n        return (event) => {\r\n            const target = getEventTarget(event);\r\n            if (isBlocked(target, blockClass, blockSelector, true)) {\r\n                return;\r\n            }\r\n            let pointerType = null;\r\n            let thisEventKey = eventKey;\r\n            if ('pointerType' in event) {\r\n                switch (event.pointerType) {\r\n                    case 'mouse':\r\n                        pointerType = PointerTypes.Mouse;\r\n                        break;\r\n                    case 'touch':\r\n                        pointerType = PointerTypes.Touch;\r\n                        break;\r\n                    case 'pen':\r\n                        pointerType = PointerTypes.Pen;\r\n                        break;\r\n                }\r\n                if (pointerType === PointerTypes.Touch) {\r\n                    if (MouseInteractions[eventKey] === MouseInteractions.MouseDown) {\r\n                        thisEventKey = 'TouchStart';\r\n                    }\r\n                    else if (MouseInteractions[eventKey] === MouseInteractions.MouseUp) {\r\n                        thisEventKey = 'TouchEnd';\r\n                    }\r\n                }\r\n                else if (pointerType === PointerTypes.Pen) ;\r\n            }\r\n            else if (legacy_isTouchEvent(event)) {\r\n                pointerType = PointerTypes.Touch;\r\n            }\r\n            if (pointerType !== null) {\r\n                currentPointerType = pointerType;\r\n                if ((thisEventKey.startsWith('Touch') &&\r\n                    pointerType === PointerTypes.Touch) ||\r\n                    (thisEventKey.startsWith('Mouse') &&\r\n                        pointerType === PointerTypes.Mouse)) {\r\n                    pointerType = null;\r\n                }\r\n            }\r\n            else if (MouseInteractions[eventKey] === MouseInteractions.Click) {\r\n                pointerType = currentPointerType;\r\n                currentPointerType = null;\r\n            }\r\n            const e = legacy_isTouchEvent(event) ? event.changedTouches[0] : event;\r\n            if (!e) {\r\n                return;\r\n            }\r\n            const id = mirror.getId(target);\r\n            const { clientX, clientY } = e;\r\n            callbackWrapper(mouseInteractionCb)(Object.assign({ type: MouseInteractions[thisEventKey], id, x: clientX, y: clientY }, (pointerType !== null && { pointerType })));\r\n        };\r\n    };\r\n    Object.keys(MouseInteractions)\r\n        .filter((key) => Number.isNaN(Number(key)) &&\r\n        !key.endsWith('_Departed') &&\r\n        disableMap[key] !== false)\r\n        .forEach((eventKey) => {\r\n        let eventName = toLowerCase(eventKey);\r\n        const handler = getHandler(eventKey);\r\n        if (window.PointerEvent) {\r\n            switch (MouseInteractions[eventKey]) {\r\n                case MouseInteractions.MouseDown:\r\n                case MouseInteractions.MouseUp:\r\n                    eventName = eventName.replace('mouse', 'pointer');\r\n                    break;\r\n                case MouseInteractions.TouchStart:\r\n                case MouseInteractions.TouchEnd:\r\n                    return;\r\n            }\r\n        }\r\n        handlers.push(on(eventName, handler, doc));\r\n    });\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initScrollObserver({ scrollCb, doc, mirror, blockClass, blockSelector, sampling, }) {\r\n    const updatePosition = callbackWrapper(throttle(callbackWrapper((evt) => {\r\n        const target = getEventTarget(evt);\r\n        if (!target ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        const id = mirror.getId(target);\r\n        if (target === doc && doc.defaultView) {\r\n            const scrollLeftTop = getWindowScroll(doc.defaultView);\r\n            scrollCb({\r\n                id,\r\n                x: scrollLeftTop.left,\r\n                y: scrollLeftTop.top,\r\n            });\r\n        }\r\n        else {\r\n            scrollCb({\r\n                id,\r\n                x: target.scrollLeft,\r\n                y: target.scrollTop,\r\n            });\r\n        }\r\n    }), sampling.scroll || 100));\r\n    return on('scroll', updatePosition, doc);\r\n}\r\nfunction initViewportResizeObserver({ viewportResizeCb }, { win }) {\r\n    let lastH = -1;\r\n    let lastW = -1;\r\n    const updateDimension = callbackWrapper(throttle(callbackWrapper(() => {\r\n        const height = getWindowHeight();\r\n        const width = getWindowWidth();\r\n        if (lastH !== height || lastW !== width) {\r\n            viewportResizeCb({\r\n                width: Number(width),\r\n                height: Number(height),\r\n            });\r\n            lastH = height;\r\n            lastW = width;\r\n        }\r\n    }), 200));\r\n    return on('resize', updateDimension, win);\r\n}\r\nfunction wrapEventWithUserTriggeredFlag(v, enable) {\r\n    const value = Object.assign({}, v);\r\n    if (!enable)\r\n        delete value.userTriggered;\r\n    return value;\r\n}\r\nconst INPUT_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\r\nconst lastInputValueMap = new WeakMap();\r\nfunction initInputObserver({ inputCb, doc, mirror, blockClass, blockSelector, ignoreClass, ignoreSelector, maskInputOptions, maskInputFn, sampling, userTriggeredOnInput, }) {\r\n    function eventHandler(event) {\r\n        let target = getEventTarget(event);\r\n        const userTriggered = event.isTrusted;\r\n        const tagName = target && target.tagName;\r\n        if (target && tagName === 'OPTION') {\r\n            target = target.parentElement;\r\n        }\r\n        if (!target ||\r\n            !tagName ||\r\n            INPUT_TAGS.indexOf(tagName) < 0 ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        if (target.classList.contains(ignoreClass) ||\r\n            (ignoreSelector && target.matches(ignoreSelector))) {\r\n            return;\r\n        }\r\n        let text = target.value;\r\n        let isChecked = false;\r\n        const type = getInputType(target) || '';\r\n        if (type === 'radio' || type === 'checkbox') {\r\n            isChecked = target.checked;\r\n        }\r\n        else if (maskInputOptions[tagName.toLowerCase()] ||\r\n            maskInputOptions[type]) {\r\n            text = maskInputValue({\r\n                element: target,\r\n                maskInputOptions,\r\n                tagName,\r\n                type,\r\n                value: text,\r\n                maskInputFn,\r\n            });\r\n        }\r\n        cbWithDedup(target, callbackWrapper(wrapEventWithUserTriggeredFlag)({ text, isChecked, userTriggered }, userTriggeredOnInput));\r\n        const name = target.name;\r\n        if (type === 'radio' && name && isChecked) {\r\n            doc\r\n                .querySelectorAll(`input[type=\"radio\"][name=\"${name}\"]`)\r\n                .forEach((el) => {\r\n                if (el !== target) {\r\n                    cbWithDedup(el, callbackWrapper(wrapEventWithUserTriggeredFlag)({\r\n                        text: el.value,\r\n                        isChecked: !isChecked,\r\n                        userTriggered: false,\r\n                    }, userTriggeredOnInput));\r\n                }\r\n            });\r\n        }\r\n    }\r\n    function cbWithDedup(target, v) {\r\n        const lastInputValue = lastInputValueMap.get(target);\r\n        if (!lastInputValue ||\r\n            lastInputValue.text !== v.text ||\r\n            lastInputValue.isChecked !== v.isChecked) {\r\n            lastInputValueMap.set(target, v);\r\n            const id = mirror.getId(target);\r\n            callbackWrapper(inputCb)(Object.assign(Object.assign({}, v), { id }));\r\n        }\r\n    }\r\n    const events = sampling.input === 'last' ? ['change'] : ['input', 'change'];\r\n    const handlers = events.map((eventName) => on(eventName, callbackWrapper(eventHandler), doc));\r\n    const currentWindow = doc.defaultView;\r\n    if (!currentWindow) {\r\n        return () => {\r\n            handlers.forEach((h) => h());\r\n        };\r\n    }\r\n    const propertyDescriptor = currentWindow.Object.getOwnPropertyDescriptor(currentWindow.HTMLInputElement.prototype, 'value');\r\n    const hookProperties = [\r\n        [currentWindow.HTMLInputElement.prototype, 'value'],\r\n        [currentWindow.HTMLInputElement.prototype, 'checked'],\r\n        [currentWindow.HTMLSelectElement.prototype, 'value'],\r\n        [currentWindow.HTMLTextAreaElement.prototype, 'value'],\r\n        [currentWindow.HTMLSelectElement.prototype, 'selectedIndex'],\r\n        [currentWindow.HTMLOptionElement.prototype, 'selected'],\r\n    ];\r\n    if (propertyDescriptor && propertyDescriptor.set) {\r\n        handlers.push(...hookProperties.map((p) => hookSetter(p[0], p[1], {\r\n            set() {\r\n                callbackWrapper(eventHandler)({\r\n                    target: this,\r\n                    isTrusted: false,\r\n                });\r\n            },\r\n        }, false, currentWindow)));\r\n    }\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction getNestedCSSRulePositions(rule) {\r\n    const positions = [];\r\n    function recurse(childRule, pos) {\r\n        if ((hasNestedCSSRule('CSSGroupingRule') &&\r\n            childRule.parentRule instanceof CSSGroupingRule) ||\r\n            (hasNestedCSSRule('CSSMediaRule') &&\r\n                childRule.parentRule instanceof CSSMediaRule) ||\r\n            (hasNestedCSSRule('CSSSupportsRule') &&\r\n                childRule.parentRule instanceof CSSSupportsRule) ||\r\n            (hasNestedCSSRule('CSSConditionRule') &&\r\n                childRule.parentRule instanceof CSSConditionRule)) {\r\n            const rules = Array.from(childRule.parentRule.cssRules);\r\n            const index = rules.indexOf(childRule);\r\n            pos.unshift(index);\r\n        }\r\n        else if (childRule.parentStyleSheet) {\r\n            const rules = Array.from(childRule.parentStyleSheet.cssRules);\r\n            const index = rules.indexOf(childRule);\r\n            pos.unshift(index);\r\n        }\r\n        return pos;\r\n    }\r\n    return recurse(rule, positions);\r\n}\r\nfunction getIdAndStyleId(sheet, mirror, styleMirror) {\r\n    let id, styleId;\r\n    if (!sheet)\r\n        return {};\r\n    if (sheet.ownerNode)\r\n        id = mirror.getId(sheet.ownerNode);\r\n    else\r\n        styleId = styleMirror.getId(sheet);\r\n    return {\r\n        styleId,\r\n        id,\r\n    };\r\n}\r\nfunction initStyleSheetObserver({ styleSheetRuleCb, mirror, stylesheetManager }, { win }) {\r\n    if (!win.CSSStyleSheet || !win.CSSStyleSheet.prototype) {\r\n        return () => {\r\n        };\r\n    }\r\n    const insertRule = win.CSSStyleSheet.prototype.insertRule;\r\n    win.CSSStyleSheet.prototype.insertRule = new Proxy(insertRule, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            const [rule, index] = argumentsList;\r\n            const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleSheetRuleCb({\r\n                    id,\r\n                    styleId,\r\n                    adds: [{ rule, index }],\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    const deleteRule = win.CSSStyleSheet.prototype.deleteRule;\r\n    win.CSSStyleSheet.prototype.deleteRule = new Proxy(deleteRule, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            const [index] = argumentsList;\r\n            const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleSheetRuleCb({\r\n                    id,\r\n                    styleId,\r\n                    removes: [{ index }],\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    let replace;\r\n    if (win.CSSStyleSheet.prototype.replace) {\r\n        replace = win.CSSStyleSheet.prototype.replace;\r\n        win.CSSStyleSheet.prototype.replace = new Proxy(replace, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [text] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        replace: text,\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    }\r\n    let replaceSync;\r\n    if (win.CSSStyleSheet.prototype.replaceSync) {\r\n        replaceSync = win.CSSStyleSheet.prototype.replaceSync;\r\n        win.CSSStyleSheet.prototype.replaceSync = new Proxy(replaceSync, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [text] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        replaceSync: text,\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    }\r\n    const supportedNestedCSSRuleTypes = {};\r\n    if (canMonkeyPatchNestedCSSRule('CSSGroupingRule')) {\r\n        supportedNestedCSSRuleTypes.CSSGroupingRule = win.CSSGroupingRule;\r\n    }\r\n    else {\r\n        if (canMonkeyPatchNestedCSSRule('CSSMediaRule')) {\r\n            supportedNestedCSSRuleTypes.CSSMediaRule = win.CSSMediaRule;\r\n        }\r\n        if (canMonkeyPatchNestedCSSRule('CSSConditionRule')) {\r\n            supportedNestedCSSRuleTypes.CSSConditionRule = win.CSSConditionRule;\r\n        }\r\n        if (canMonkeyPatchNestedCSSRule('CSSSupportsRule')) {\r\n            supportedNestedCSSRuleTypes.CSSSupportsRule = win.CSSSupportsRule;\r\n        }\r\n    }\r\n    const unmodifiedFunctions = {};\r\n    Object.entries(supportedNestedCSSRuleTypes).forEach(([typeKey, type]) => {\r\n        unmodifiedFunctions[typeKey] = {\r\n            insertRule: type.prototype.insertRule,\r\n            deleteRule: type.prototype.deleteRule,\r\n        };\r\n        type.prototype.insertRule = new Proxy(unmodifiedFunctions[typeKey].insertRule, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [rule, index] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        adds: [\r\n                            {\r\n                                rule,\r\n                                index: [\r\n                                    ...getNestedCSSRulePositions(thisArg),\r\n                                    index || 0,\r\n                                ],\r\n                            },\r\n                        ],\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n        type.prototype.deleteRule = new Proxy(unmodifiedFunctions[typeKey].deleteRule, {\r\n            apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n                const [index] = argumentsList;\r\n                const { id, styleId } = getIdAndStyleId(thisArg.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n                if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                    styleSheetRuleCb({\r\n                        id,\r\n                        styleId,\r\n                        removes: [\r\n                            { index: [...getNestedCSSRulePositions(thisArg), index] },\r\n                        ],\r\n                    });\r\n                }\r\n                return target.apply(thisArg, argumentsList);\r\n            }),\r\n        });\r\n    });\r\n    return callbackWrapper(() => {\r\n        win.CSSStyleSheet.prototype.insertRule = insertRule;\r\n        win.CSSStyleSheet.prototype.deleteRule = deleteRule;\r\n        replace && (win.CSSStyleSheet.prototype.replace = replace);\r\n        replaceSync && (win.CSSStyleSheet.prototype.replaceSync = replaceSync);\r\n        Object.entries(supportedNestedCSSRuleTypes).forEach(([typeKey, type]) => {\r\n            type.prototype.insertRule = unmodifiedFunctions[typeKey].insertRule;\r\n            type.prototype.deleteRule = unmodifiedFunctions[typeKey].deleteRule;\r\n        });\r\n    });\r\n}\r\nfunction initAdoptedStyleSheetObserver({ mirror, stylesheetManager, }, host) {\r\n    var _a, _b, _c;\r\n    let hostId = null;\r\n    if (host.nodeName === '#document')\r\n        hostId = mirror.getId(host);\r\n    else\r\n        hostId = mirror.getId(host.host);\r\n    const patchTarget = host.nodeName === '#document'\r\n        ? (_a = host.defaultView) === null || _a === void 0 ? void 0 : _a.Document\r\n        : (_c = (_b = host.ownerDocument) === null || _b === void 0 ? void 0 : _b.defaultView) === null || _c === void 0 ? void 0 : _c.ShadowRoot;\r\n    const originalPropertyDescriptor = Object.getOwnPropertyDescriptor(patchTarget === null || patchTarget === void 0 ? void 0 : patchTarget.prototype, 'adoptedStyleSheets');\r\n    if (hostId === null ||\r\n        hostId === -1 ||\r\n        !patchTarget ||\r\n        !originalPropertyDescriptor)\r\n        return () => {\r\n        };\r\n    Object.defineProperty(host, 'adoptedStyleSheets', {\r\n        configurable: originalPropertyDescriptor.configurable,\r\n        enumerable: originalPropertyDescriptor.enumerable,\r\n        get() {\r\n            var _a;\r\n            return (_a = originalPropertyDescriptor.get) === null || _a === void 0 ? void 0 : _a.call(this);\r\n        },\r\n        set(sheets) {\r\n            var _a;\r\n            const result = (_a = originalPropertyDescriptor.set) === null || _a === void 0 ? void 0 : _a.call(this, sheets);\r\n            if (hostId !== null && hostId !== -1) {\r\n                try {\r\n                    stylesheetManager.adoptStyleSheets(sheets, hostId);\r\n                }\r\n                catch (e) {\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n    });\r\n    return callbackWrapper(() => {\r\n        Object.defineProperty(host, 'adoptedStyleSheets', {\r\n            configurable: originalPropertyDescriptor.configurable,\r\n            enumerable: originalPropertyDescriptor.enumerable,\r\n            get: originalPropertyDescriptor.get,\r\n            set: originalPropertyDescriptor.set,\r\n        });\r\n    });\r\n}\r\nfunction initStyleDeclarationObserver({ styleDeclarationCb, mirror, ignoreCSSAttributes, stylesheetManager, }, { win }) {\r\n    const setProperty = win.CSSStyleDeclaration.prototype.setProperty;\r\n    win.CSSStyleDeclaration.prototype.setProperty = new Proxy(setProperty, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            var _a;\r\n            const [property, value, priority] = argumentsList;\r\n            if (ignoreCSSAttributes.has(property)) {\r\n                return setProperty.apply(thisArg, [property, value, priority]);\r\n            }\r\n            const { id, styleId } = getIdAndStyleId((_a = thisArg.parentRule) === null || _a === void 0 ? void 0 : _a.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleDeclarationCb({\r\n                    id,\r\n                    styleId,\r\n                    set: {\r\n                        property,\r\n                        value,\r\n                        priority,\r\n                    },\r\n                    index: getNestedCSSRulePositions(thisArg.parentRule),\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    const removeProperty = win.CSSStyleDeclaration.prototype.removeProperty;\r\n    win.CSSStyleDeclaration.prototype.removeProperty = new Proxy(removeProperty, {\r\n        apply: callbackWrapper((target, thisArg, argumentsList) => {\r\n            var _a;\r\n            const [property] = argumentsList;\r\n            if (ignoreCSSAttributes.has(property)) {\r\n                return removeProperty.apply(thisArg, [property]);\r\n            }\r\n            const { id, styleId } = getIdAndStyleId((_a = thisArg.parentRule) === null || _a === void 0 ? void 0 : _a.parentStyleSheet, mirror, stylesheetManager.styleMirror);\r\n            if ((id && id !== -1) || (styleId && styleId !== -1)) {\r\n                styleDeclarationCb({\r\n                    id,\r\n                    styleId,\r\n                    remove: {\r\n                        property,\r\n                    },\r\n                    index: getNestedCSSRulePositions(thisArg.parentRule),\r\n                });\r\n            }\r\n            return target.apply(thisArg, argumentsList);\r\n        }),\r\n    });\r\n    return callbackWrapper(() => {\r\n        win.CSSStyleDeclaration.prototype.setProperty = setProperty;\r\n        win.CSSStyleDeclaration.prototype.removeProperty = removeProperty;\r\n    });\r\n}\r\nfunction initMediaInteractionObserver({ mediaInteractionCb, blockClass, blockSelector, mirror, sampling, doc, }) {\r\n    const handler = callbackWrapper((type) => throttle(callbackWrapper((event) => {\r\n        const target = getEventTarget(event);\r\n        if (!target ||\r\n            isBlocked(target, blockClass, blockSelector, true)) {\r\n            return;\r\n        }\r\n        const { currentTime, volume, muted, playbackRate } = target;\r\n        mediaInteractionCb({\r\n            type,\r\n            id: mirror.getId(target),\r\n            currentTime,\r\n            volume,\r\n            muted,\r\n            playbackRate,\r\n        });\r\n    }), sampling.media || 500));\r\n    const handlers = [\r\n        on('play', handler(0), doc),\r\n        on('pause', handler(1), doc),\r\n        on('seeked', handler(2), doc),\r\n        on('volumechange', handler(3), doc),\r\n        on('ratechange', handler(4), doc),\r\n    ];\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initFontObserver({ fontCb, doc }) {\r\n    const win = doc.defaultView;\r\n    if (!win) {\r\n        return () => {\r\n        };\r\n    }\r\n    const handlers = [];\r\n    const fontMap = new WeakMap();\r\n    const originalFontFace = win.FontFace;\r\n    win.FontFace = function FontFace(family, source, descriptors) {\r\n        const fontFace = new originalFontFace(family, source, descriptors);\r\n        fontMap.set(fontFace, {\r\n            family,\r\n            buffer: typeof source !== 'string',\r\n            descriptors,\r\n            fontSource: typeof source === 'string'\r\n                ? source\r\n                : JSON.stringify(Array.from(new Uint8Array(source))),\r\n        });\r\n        return fontFace;\r\n    };\r\n    const restoreHandler = patch(doc.fonts, 'add', function (original) {\r\n        return function (fontFace) {\r\n            setTimeout(callbackWrapper(() => {\r\n                const p = fontMap.get(fontFace);\r\n                if (p) {\r\n                    fontCb(p);\r\n                    fontMap.delete(fontFace);\r\n                }\r\n            }), 0);\r\n            return original.apply(this, [fontFace]);\r\n        };\r\n    });\r\n    handlers.push(() => {\r\n        win.FontFace = originalFontFace;\r\n    });\r\n    handlers.push(restoreHandler);\r\n    return callbackWrapper(() => {\r\n        handlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction initSelectionObserver(param) {\r\n    const { doc, mirror, blockClass, blockSelector, selectionCb } = param;\r\n    let collapsed = true;\r\n    const updateSelection = callbackWrapper(() => {\r\n        const selection = doc.getSelection();\r\n        if (!selection || (collapsed && (selection === null || selection === void 0 ? void 0 : selection.isCollapsed)))\r\n            return;\r\n        collapsed = selection.isCollapsed || false;\r\n        const ranges = [];\r\n        const count = selection.rangeCount || 0;\r\n        for (let i = 0; i < count; i++) {\r\n            const range = selection.getRangeAt(i);\r\n            const { startContainer, startOffset, endContainer, endOffset } = range;\r\n            const blocked = isBlocked(startContainer, blockClass, blockSelector, true) ||\r\n                isBlocked(endContainer, blockClass, blockSelector, true);\r\n            if (blocked)\r\n                continue;\r\n            ranges.push({\r\n                start: mirror.getId(startContainer),\r\n                startOffset,\r\n                end: mirror.getId(endContainer),\r\n                endOffset,\r\n            });\r\n        }\r\n        selectionCb({ ranges });\r\n    });\r\n    updateSelection();\r\n    return on('selectionchange', updateSelection);\r\n}\r\nfunction mergeHooks(o, hooks) {\r\n    const { mutationCb, mousemoveCb, mouseInteractionCb, scrollCb, viewportResizeCb, inputCb, mediaInteractionCb, styleSheetRuleCb, styleDeclarationCb, canvasMutationCb, fontCb, selectionCb, } = o;\r\n    o.mutationCb = (...p) => {\r\n        if (hooks.mutation) {\r\n            hooks.mutation(...p);\r\n        }\r\n        mutationCb(...p);\r\n    };\r\n    o.mousemoveCb = (...p) => {\r\n        if (hooks.mousemove) {\r\n            hooks.mousemove(...p);\r\n        }\r\n        mousemoveCb(...p);\r\n    };\r\n    o.mouseInteractionCb = (...p) => {\r\n        if (hooks.mouseInteraction) {\r\n            hooks.mouseInteraction(...p);\r\n        }\r\n        mouseInteractionCb(...p);\r\n    };\r\n    o.scrollCb = (...p) => {\r\n        if (hooks.scroll) {\r\n            hooks.scroll(...p);\r\n        }\r\n        scrollCb(...p);\r\n    };\r\n    o.viewportResizeCb = (...p) => {\r\n        if (hooks.viewportResize) {\r\n            hooks.viewportResize(...p);\r\n        }\r\n        viewportResizeCb(...p);\r\n    };\r\n    o.inputCb = (...p) => {\r\n        if (hooks.input) {\r\n            hooks.input(...p);\r\n        }\r\n        inputCb(...p);\r\n    };\r\n    o.mediaInteractionCb = (...p) => {\r\n        if (hooks.mediaInteaction) {\r\n            hooks.mediaInteaction(...p);\r\n        }\r\n        mediaInteractionCb(...p);\r\n    };\r\n    o.styleSheetRuleCb = (...p) => {\r\n        if (hooks.styleSheetRule) {\r\n            hooks.styleSheetRule(...p);\r\n        }\r\n        styleSheetRuleCb(...p);\r\n    };\r\n    o.styleDeclarationCb = (...p) => {\r\n        if (hooks.styleDeclaration) {\r\n            hooks.styleDeclaration(...p);\r\n        }\r\n        styleDeclarationCb(...p);\r\n    };\r\n    o.canvasMutationCb = (...p) => {\r\n        if (hooks.canvasMutation) {\r\n            hooks.canvasMutation(...p);\r\n        }\r\n        canvasMutationCb(...p);\r\n    };\r\n    o.fontCb = (...p) => {\r\n        if (hooks.font) {\r\n            hooks.font(...p);\r\n        }\r\n        fontCb(...p);\r\n    };\r\n    o.selectionCb = (...p) => {\r\n        if (hooks.selection) {\r\n            hooks.selection(...p);\r\n        }\r\n        selectionCb(...p);\r\n    };\r\n}\r\nfunction initObservers(o, hooks = {}) {\r\n    const currentWindow = o.doc.defaultView;\r\n    if (!currentWindow) {\r\n        return () => {\r\n        };\r\n    }\r\n    mergeHooks(o, hooks);\r\n    const mutationObserver = initMutationObserver(o, o.doc);\r\n    const mousemoveHandler = initMoveObserver(o);\r\n    const mouseInteractionHandler = initMouseInteractionObserver(o);\r\n    const scrollHandler = initScrollObserver(o);\r\n    const viewportResizeHandler = initViewportResizeObserver(o, {\r\n        win: currentWindow,\r\n    });\r\n    const inputHandler = initInputObserver(o);\r\n    const mediaInteractionHandler = initMediaInteractionObserver(o);\r\n    const styleSheetObserver = initStyleSheetObserver(o, { win: currentWindow });\r\n    const adoptedStyleSheetObserver = initAdoptedStyleSheetObserver(o, o.doc);\r\n    const styleDeclarationObserver = initStyleDeclarationObserver(o, {\r\n        win: currentWindow,\r\n    });\r\n    const fontObserver = o.collectFonts\r\n        ? initFontObserver(o)\r\n        : () => {\r\n        };\r\n    const selectionObserver = initSelectionObserver(o);\r\n    const pluginHandlers = [];\r\n    for (const plugin of o.plugins) {\r\n        pluginHandlers.push(plugin.observer(plugin.callback, currentWindow, plugin.options));\r\n    }\r\n    return callbackWrapper(() => {\r\n        mutationBuffers.forEach((b) => b.reset());\r\n        mutationObserver.disconnect();\r\n        mousemoveHandler();\r\n        mouseInteractionHandler();\r\n        scrollHandler();\r\n        viewportResizeHandler();\r\n        inputHandler();\r\n        mediaInteractionHandler();\r\n        styleSheetObserver();\r\n        adoptedStyleSheetObserver();\r\n        styleDeclarationObserver();\r\n        fontObserver();\r\n        selectionObserver();\r\n        pluginHandlers.forEach((h) => h());\r\n    });\r\n}\r\nfunction hasNestedCSSRule(prop) {\r\n    return typeof window[prop] !== 'undefined';\r\n}\r\nfunction canMonkeyPatchNestedCSSRule(prop) {\r\n    return Boolean(typeof window[prop] !== 'undefined' &&\r\n        window[prop].prototype &&\r\n        'insertRule' in window[prop].prototype &&\r\n        'deleteRule' in window[prop].prototype);\r\n}\n\nexport { INPUT_TAGS, initAdoptedStyleSheetObserver, initMutationObserver, initObservers, initScrollObserver, mutationBuffers };\n","class CrossOriginIframeMirror {\r\n    constructor(generateIdFn) {\r\n        this.generateIdFn = generateIdFn;\r\n        this.iframeIdToRemoteIdMap = new WeakMap();\r\n        this.iframeRemoteIdToIdMap = new WeakMap();\r\n    }\r\n    getId(iframe, remoteId, idToRemoteMap, remoteToIdMap) {\r\n        const idToRemoteIdMap = idToRemoteMap || this.getIdToRemoteIdMap(iframe);\r\n        const remoteIdToIdMap = remoteToIdMap || this.getRemoteIdToIdMap(iframe);\r\n        let id = idToRemoteIdMap.get(remoteId);\r\n        if (!id) {\r\n            id = this.generateIdFn();\r\n            idToRemoteIdMap.set(remoteId, id);\r\n            remoteIdToIdMap.set(id, remoteId);\r\n        }\r\n        return id;\r\n    }\r\n    getIds(iframe, remoteId) {\r\n        const idToRemoteIdMap = this.getIdToRemoteIdMap(iframe);\r\n        const remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);\r\n        return remoteId.map((id) => this.getId(iframe, id, idToRemoteIdMap, remoteIdToIdMap));\r\n    }\r\n    getRemoteId(iframe, id, map) {\r\n        const remoteIdToIdMap = map || this.getRemoteIdToIdMap(iframe);\r\n        if (typeof id !== 'number')\r\n            return id;\r\n        const remoteId = remoteIdToIdMap.get(id);\r\n        if (!remoteId)\r\n            return -1;\r\n        return remoteId;\r\n    }\r\n    getRemoteIds(iframe, ids) {\r\n        const remoteIdToIdMap = this.getRemoteIdToIdMap(iframe);\r\n        return ids.map((id) => this.getRemoteId(iframe, id, remoteIdToIdMap));\r\n    }\r\n    reset(iframe) {\r\n        if (!iframe) {\r\n            this.iframeIdToRemoteIdMap = new WeakMap();\r\n            this.iframeRemoteIdToIdMap = new WeakMap();\r\n            return;\r\n        }\r\n        this.iframeIdToRemoteIdMap.delete(iframe);\r\n        this.iframeRemoteIdToIdMap.delete(iframe);\r\n    }\r\n    getIdToRemoteIdMap(iframe) {\r\n        let idToRemoteIdMap = this.iframeIdToRemoteIdMap.get(iframe);\r\n        if (!idToRemoteIdMap) {\r\n            idToRemoteIdMap = new Map();\r\n            this.iframeIdToRemoteIdMap.set(iframe, idToRemoteIdMap);\r\n        }\r\n        return idToRemoteIdMap;\r\n    }\r\n    getRemoteIdToIdMap(iframe) {\r\n        let remoteIdToIdMap = this.iframeRemoteIdToIdMap.get(iframe);\r\n        if (!remoteIdToIdMap) {\r\n            remoteIdToIdMap = new Map();\r\n            this.iframeRemoteIdToIdMap.set(iframe, remoteIdToIdMap);\r\n        }\r\n        return remoteIdToIdMap;\r\n    }\r\n}\n\nexport { CrossOriginIframeMirror as default };\n","import { genId, NodeType } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport CrossOriginIframeMirror from './cross-origin-iframe-mirror.js';\nimport { EventType, IncrementalSource } from '../../../types/dist/types.js';\n\nclass IframeManager {\r\n    constructor(options) {\r\n        this.iframes = new WeakMap();\r\n        this.crossOriginIframeMap = new WeakMap();\r\n        this.crossOriginIframeMirror = new CrossOriginIframeMirror(genId);\r\n        this.crossOriginIframeRootIdMap = new WeakMap();\r\n        this.mutationCb = options.mutationCb;\r\n        this.wrappedEmit = options.wrappedEmit;\r\n        this.stylesheetManager = options.stylesheetManager;\r\n        this.recordCrossOriginIframes = options.recordCrossOriginIframes;\r\n        this.crossOriginIframeStyleMirror = new CrossOriginIframeMirror(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror));\r\n        this.mirror = options.mirror;\r\n        if (this.recordCrossOriginIframes) {\r\n            window.addEventListener('message', this.handleMessage.bind(this));\r\n        }\r\n    }\r\n    addIframe(iframeEl) {\r\n        this.iframes.set(iframeEl, true);\r\n        if (iframeEl.contentWindow)\r\n            this.crossOriginIframeMap.set(iframeEl.contentWindow, iframeEl);\r\n    }\r\n    addLoadListener(cb) {\r\n        this.loadListener = cb;\r\n    }\r\n    attachIframe(iframeEl, childSn) {\r\n        var _a;\r\n        this.mutationCb({\r\n            adds: [\r\n                {\r\n                    parentId: this.mirror.getId(iframeEl),\r\n                    nextId: null,\r\n                    node: childSn,\r\n                },\r\n            ],\r\n            removes: [],\r\n            texts: [],\r\n            attributes: [],\r\n            isAttachIframe: true,\r\n        });\r\n        (_a = this.loadListener) === null || _a === void 0 ? void 0 : _a.call(this, iframeEl);\r\n        if (iframeEl.contentDocument &&\r\n            iframeEl.contentDocument.adoptedStyleSheets &&\r\n            iframeEl.contentDocument.adoptedStyleSheets.length > 0)\r\n            this.stylesheetManager.adoptStyleSheets(iframeEl.contentDocument.adoptedStyleSheets, this.mirror.getId(iframeEl.contentDocument));\r\n    }\r\n    handleMessage(message) {\r\n        const crossOriginMessageEvent = message;\r\n        if (crossOriginMessageEvent.data.type !== 'rrweb' ||\r\n            crossOriginMessageEvent.origin !== crossOriginMessageEvent.data.origin)\r\n            return;\r\n        const iframeSourceWindow = message.source;\r\n        if (!iframeSourceWindow)\r\n            return;\r\n        const iframeEl = this.crossOriginIframeMap.get(message.source);\r\n        if (!iframeEl)\r\n            return;\r\n        const transformedEvent = this.transformCrossOriginEvent(iframeEl, crossOriginMessageEvent.data.event);\r\n        if (transformedEvent)\r\n            this.wrappedEmit(transformedEvent, crossOriginMessageEvent.data.isCheckout);\r\n    }\r\n    transformCrossOriginEvent(iframeEl, e) {\r\n        var _a;\r\n        switch (e.type) {\r\n            case EventType.FullSnapshot: {\r\n                this.crossOriginIframeMirror.reset(iframeEl);\r\n                this.crossOriginIframeStyleMirror.reset(iframeEl);\r\n                this.replaceIdOnNode(e.data.node, iframeEl);\r\n                const rootId = e.data.node.id;\r\n                this.crossOriginIframeRootIdMap.set(iframeEl, rootId);\r\n                this.patchRootIdOnNode(e.data.node, rootId);\r\n                return {\r\n                    timestamp: e.timestamp,\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: {\r\n                        source: IncrementalSource.Mutation,\r\n                        adds: [\r\n                            {\r\n                                parentId: this.mirror.getId(iframeEl),\r\n                                nextId: null,\r\n                                node: e.data.node,\r\n                            },\r\n                        ],\r\n                        removes: [],\r\n                        texts: [],\r\n                        attributes: [],\r\n                        isAttachIframe: true,\r\n                    },\r\n                };\r\n            }\r\n            case EventType.Meta:\r\n            case EventType.Load:\r\n            case EventType.DomContentLoaded: {\r\n                return false;\r\n            }\r\n            case EventType.Plugin: {\r\n                return e;\r\n            }\r\n            case EventType.Custom: {\r\n                this.replaceIds(e.data.payload, iframeEl, ['id', 'parentId', 'previousId', 'nextId']);\r\n                return e;\r\n            }\r\n            case EventType.IncrementalSnapshot: {\r\n                switch (e.data.source) {\r\n                    case IncrementalSource.Mutation: {\r\n                        e.data.adds.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, [\r\n                                'parentId',\r\n                                'nextId',\r\n                                'previousId',\r\n                            ]);\r\n                            this.replaceIdOnNode(n.node, iframeEl);\r\n                            const rootId = this.crossOriginIframeRootIdMap.get(iframeEl);\r\n                            rootId && this.patchRootIdOnNode(n.node, rootId);\r\n                        });\r\n                        e.data.removes.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['parentId', 'id']);\r\n                        });\r\n                        e.data.attributes.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['id']);\r\n                        });\r\n                        e.data.texts.forEach((n) => {\r\n                            this.replaceIds(n, iframeEl, ['id']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Drag:\r\n                    case IncrementalSource.TouchMove:\r\n                    case IncrementalSource.MouseMove: {\r\n                        e.data.positions.forEach((p) => {\r\n                            this.replaceIds(p, iframeEl, ['id']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.ViewportResize: {\r\n                        return false;\r\n                    }\r\n                    case IncrementalSource.MediaInteraction:\r\n                    case IncrementalSource.MouseInteraction:\r\n                    case IncrementalSource.Scroll:\r\n                    case IncrementalSource.CanvasMutation:\r\n                    case IncrementalSource.Input: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.StyleSheetRule:\r\n                    case IncrementalSource.StyleDeclaration: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        this.replaceStyleIds(e.data, iframeEl, ['styleId']);\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Font: {\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.Selection: {\r\n                        e.data.ranges.forEach((range) => {\r\n                            this.replaceIds(range, iframeEl, ['start', 'end']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                    case IncrementalSource.AdoptedStyleSheet: {\r\n                        this.replaceIds(e.data, iframeEl, ['id']);\r\n                        this.replaceStyleIds(e.data, iframeEl, ['styleIds']);\r\n                        (_a = e.data.styles) === null || _a === void 0 ? void 0 : _a.forEach((style) => {\r\n                            this.replaceStyleIds(style, iframeEl, ['styleId']);\r\n                        });\r\n                        return e;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    replace(iframeMirror, obj, iframeEl, keys) {\r\n        for (const key of keys) {\r\n            if (!Array.isArray(obj[key]) && typeof obj[key] !== 'number')\r\n                continue;\r\n            if (Array.isArray(obj[key])) {\r\n                obj[key] = iframeMirror.getIds(iframeEl, obj[key]);\r\n            }\r\n            else {\r\n                obj[key] = iframeMirror.getId(iframeEl, obj[key]);\r\n            }\r\n        }\r\n        return obj;\r\n    }\r\n    replaceIds(obj, iframeEl, keys) {\r\n        return this.replace(this.crossOriginIframeMirror, obj, iframeEl, keys);\r\n    }\r\n    replaceStyleIds(obj, iframeEl, keys) {\r\n        return this.replace(this.crossOriginIframeStyleMirror, obj, iframeEl, keys);\r\n    }\r\n    replaceIdOnNode(node, iframeEl) {\r\n        this.replaceIds(node, iframeEl, ['id', 'rootId']);\r\n        if ('childNodes' in node) {\r\n            node.childNodes.forEach((child) => {\r\n                this.replaceIdOnNode(child, iframeEl);\r\n            });\r\n        }\r\n    }\r\n    patchRootIdOnNode(node, rootId) {\r\n        if (node.type !== NodeType.Document && !node.rootId)\r\n            node.rootId = rootId;\r\n        if ('childNodes' in node) {\r\n            node.childNodes.forEach((child) => {\r\n                this.patchRootIdOnNode(child, rootId);\r\n            });\r\n        }\r\n    }\r\n}\n\nexport { IframeManager };\n","import { initMutationObserver, initScrollObserver, initAdoptedStyleSheetObserver } from './observer.js';\nimport { patch, inDom } from '../utils.js';\nimport { isNativeShadowDom } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\n\nclass ShadowDomManager {\r\n    constructor(options) {\r\n        this.shadowDoms = new WeakSet();\r\n        this.restoreHandlers = [];\r\n        this.mutationCb = options.mutationCb;\r\n        this.scrollCb = options.scrollCb;\r\n        this.bypassOptions = options.bypassOptions;\r\n        this.mirror = options.mirror;\r\n        this.init();\r\n    }\r\n    init() {\r\n        this.reset();\r\n        this.patchAttachShadow(Element, document);\r\n    }\r\n    addShadowRoot(shadowRoot, doc) {\r\n        if (!isNativeShadowDom(shadowRoot))\r\n            return;\r\n        if (this.shadowDoms.has(shadowRoot))\r\n            return;\r\n        this.shadowDoms.add(shadowRoot);\r\n        const observer = initMutationObserver(Object.assign(Object.assign({}, this.bypassOptions), { doc, mutationCb: this.mutationCb, mirror: this.mirror, shadowDomManager: this }), shadowRoot);\r\n        this.restoreHandlers.push(() => observer.disconnect());\r\n        this.restoreHandlers.push(initScrollObserver(Object.assign(Object.assign({}, this.bypassOptions), { scrollCb: this.scrollCb, doc: shadowRoot, mirror: this.mirror })));\r\n        setTimeout(() => {\r\n            if (shadowRoot.adoptedStyleSheets &&\r\n                shadowRoot.adoptedStyleSheets.length > 0)\r\n                this.bypassOptions.stylesheetManager.adoptStyleSheets(shadowRoot.adoptedStyleSheets, this.mirror.getId(shadowRoot.host));\r\n            this.restoreHandlers.push(initAdoptedStyleSheetObserver({\r\n                mirror: this.mirror,\r\n                stylesheetManager: this.bypassOptions.stylesheetManager,\r\n            }, shadowRoot));\r\n        }, 0);\r\n    }\r\n    observeAttachShadow(iframeElement) {\r\n        if (!iframeElement.contentWindow || !iframeElement.contentDocument)\r\n            return;\r\n        this.patchAttachShadow(iframeElement.contentWindow.Element, iframeElement.contentDocument);\r\n    }\r\n    patchAttachShadow(element, doc) {\r\n        const manager = this;\r\n        this.restoreHandlers.push(patch(element.prototype, 'attachShadow', function (original) {\r\n            return function (option) {\r\n                const shadowRoot = original.call(this, option);\r\n                if (this.shadowRoot && inDom(this))\r\n                    manager.addShadowRoot(this.shadowRoot, doc);\r\n                return shadowRoot;\r\n            };\r\n        }));\r\n    }\r\n    reset() {\r\n        this.restoreHandlers.forEach((handler) => {\r\n            try {\r\n                handler();\r\n            }\r\n            catch (e) {\r\n            }\r\n        });\r\n        this.restoreHandlers = [];\r\n        this.shadowDoms = new WeakSet();\r\n    }\r\n}\n\nexport { ShadowDomManager };\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nexport { __awaiter, __rest };\n","/*\n * base64-arraybuffer 1.0.1 <https://github.com/niklasvh/base64-arraybuffer>\n * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>\n * Released under MIT License\n */\nvar chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nvar lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (var i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nvar encode = function (arraybuffer) {\n    var bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nvar decode = function (base64) {\n    var bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    var arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n\nexport { decode, encode };\n","import { encode } from './../../../../../../ext/base64-arraybuffer/dist/base64-arraybuffer.es5.js';\n\nconst canvasVarMap = new Map();\r\nfunction variableListFor(ctx, ctor) {\r\n    let contextMap = canvasVarMap.get(ctx);\r\n    if (!contextMap) {\r\n        contextMap = new Map();\r\n        canvasVarMap.set(ctx, contextMap);\r\n    }\r\n    if (!contextMap.has(ctor)) {\r\n        contextMap.set(ctor, []);\r\n    }\r\n    return contextMap.get(ctor);\r\n}\r\nconst saveWebGLVar = (value, win, ctx) => {\r\n    if (!value ||\r\n        !(isInstanceOfWebGLObject(value, win) || typeof value === 'object'))\r\n        return;\r\n    const name = value.constructor.name;\r\n    const list = variableListFor(ctx, name);\r\n    let index = list.indexOf(value);\r\n    if (index === -1) {\r\n        index = list.length;\r\n        list.push(value);\r\n    }\r\n    return index;\r\n};\r\nfunction serializeArg(value, win, ctx) {\r\n    if (value instanceof Array) {\r\n        return value.map((arg) => serializeArg(arg, win, ctx));\r\n    }\r\n    else if (value === null) {\r\n        return value;\r\n    }\r\n    else if (value instanceof Float32Array ||\r\n        value instanceof Float64Array ||\r\n        value instanceof Int32Array ||\r\n        value instanceof Uint32Array ||\r\n        value instanceof Uint8Array ||\r\n        value instanceof Uint16Array ||\r\n        value instanceof Int16Array ||\r\n        value instanceof Int8Array ||\r\n        value instanceof Uint8ClampedArray) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [Object.values(value)],\r\n        };\r\n    }\r\n    else if (value instanceof ArrayBuffer) {\r\n        const name = value.constructor.name;\r\n        const base64 = encode(value);\r\n        return {\r\n            rr_type: name,\r\n            base64,\r\n        };\r\n    }\r\n    else if (value instanceof DataView) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [\r\n                serializeArg(value.buffer, win, ctx),\r\n                value.byteOffset,\r\n                value.byteLength,\r\n            ],\r\n        };\r\n    }\r\n    else if (value instanceof HTMLImageElement) {\r\n        const name = value.constructor.name;\r\n        const { src } = value;\r\n        return {\r\n            rr_type: name,\r\n            src,\r\n        };\r\n    }\r\n    else if (value instanceof HTMLCanvasElement) {\r\n        const name = 'HTMLImageElement';\r\n        const src = value.toDataURL();\r\n        return {\r\n            rr_type: name,\r\n            src,\r\n        };\r\n    }\r\n    else if (value instanceof ImageData) {\r\n        const name = value.constructor.name;\r\n        return {\r\n            rr_type: name,\r\n            args: [serializeArg(value.data, win, ctx), value.width, value.height],\r\n        };\r\n    }\r\n    else if (isInstanceOfWebGLObject(value, win) || typeof value === 'object') {\r\n        const name = value.constructor.name;\r\n        const index = saveWebGLVar(value, win, ctx);\r\n        return {\r\n            rr_type: name,\r\n            index: index,\r\n        };\r\n    }\r\n    return value;\r\n}\r\nconst serializeArgs = (args, win, ctx) => {\r\n    return [...args].map((arg) => serializeArg(arg, win, ctx));\r\n};\r\nconst isInstanceOfWebGLObject = (value, win) => {\r\n    const webGLConstructorNames = [\r\n        'WebGLActiveInfo',\r\n        'WebGLBuffer',\r\n        'WebGLFramebuffer',\r\n        'WebGLProgram',\r\n        'WebGLRenderbuffer',\r\n        'WebGLShader',\r\n        'WebGLShaderPrecisionFormat',\r\n        'WebGLTexture',\r\n        'WebGLUniformLocation',\r\n        'WebGLVertexArrayObject',\r\n        'WebGLVertexArrayObjectOES',\r\n    ];\r\n    const supportedWebGLConstructorNames = webGLConstructorNames.filter((name) => typeof win[name] === 'function');\r\n    return Boolean(supportedWebGLConstructorNames.find((name) => value instanceof win[name]));\r\n};\n\nexport { isInstanceOfWebGLObject, saveWebGLVar, serializeArg, serializeArgs, variableListFor };\n","import { patch, isBlocked } from '../../../utils.js';\n\nfunction getNormalizedContextName(contextType) {\r\n    return contextType === 'experimental-webgl' ? 'webgl' : contextType;\r\n}\r\nfunction initCanvasContextObserver(win, blockClass, blockSelector, setPreserveDrawingBufferToTrue) {\r\n    const handlers = [];\r\n    try {\r\n        const restoreHandler = patch(win.HTMLCanvasElement.prototype, 'getContext', function (original) {\r\n            return function (contextType, ...args) {\r\n                if (!isBlocked(this, blockClass, blockSelector, true)) {\r\n                    const ctxName = getNormalizedContextName(contextType);\r\n                    if (!('__context' in this))\r\n                        this.__context = ctxName;\r\n                    if (setPreserveDrawingBufferToTrue &&\r\n                        ['webgl', 'webgl2'].includes(ctxName)) {\r\n                        if (args[0] && typeof args[0] === 'object') {\r\n                            const contextAttributes = args[0];\r\n                            if (!contextAttributes.preserveDrawingBuffer) {\r\n                                contextAttributes.preserveDrawingBuffer = true;\r\n                            }\r\n                        }\r\n                        else {\r\n                            args.splice(0, 1, {\r\n                                preserveDrawingBuffer: true,\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                return original.apply(this, [contextType, ...args]);\r\n            };\r\n        });\r\n        handlers.push(restoreHandler);\r\n    }\r\n    catch (_a) {\r\n        console.error('failed to patch HTMLCanvasElement.prototype.getContext');\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvasContextObserver as default };\n","import { CanvasContext } from '../../../../../types/dist/types.js';\nimport { patch, isBlocked, hookSetter } from '../../../utils.js';\nimport { saveWebGLVar, serializeArgs } from './serialize-args.js';\n\nfunction patchGLPrototype(prototype, type, cb, blockClass, blockSelector, mirror, win) {\r\n    const handlers = [];\r\n    const props = Object.getOwnPropertyNames(prototype);\r\n    for (const prop of props) {\r\n        if ([\r\n            'isContextLost',\r\n            'canvas',\r\n            'drawingBufferWidth',\r\n            'drawingBufferHeight',\r\n        ].includes(prop)) {\r\n            continue;\r\n        }\r\n        try {\r\n            if (typeof prototype[prop] !== 'function') {\r\n                continue;\r\n            }\r\n            const restoreHandler = patch(prototype, prop, function (original) {\r\n                return function (...args) {\r\n                    const result = original.apply(this, args);\r\n                    saveWebGLVar(result, win, this);\r\n                    if ('tagName' in this.canvas &&\r\n                        !isBlocked(this.canvas, blockClass, blockSelector, true)) {\r\n                        const recordArgs = serializeArgs([...args], win, this);\r\n                        const mutation = {\r\n                            type,\r\n                            property: prop,\r\n                            args: recordArgs,\r\n                        };\r\n                        cb(this.canvas, mutation);\r\n                    }\r\n                    return result;\r\n                };\r\n            });\r\n            handlers.push(restoreHandler);\r\n        }\r\n        catch (_a) {\r\n            const hookHandler = hookSetter(prototype, prop, {\r\n                set(v) {\r\n                    cb(this.canvas, {\r\n                        type,\r\n                        property: prop,\r\n                        args: [v],\r\n                        setter: true,\r\n                    });\r\n                },\r\n            });\r\n            handlers.push(hookHandler);\r\n        }\r\n    }\r\n    return handlers;\r\n}\r\nfunction initCanvasWebGLMutationObserver(cb, win, blockClass, blockSelector, mirror) {\r\n    const handlers = [];\r\n    handlers.push(...patchGLPrototype(win.WebGLRenderingContext.prototype, CanvasContext.WebGL, cb, blockClass, blockSelector, mirror, win));\r\n    if (typeof win.WebGL2RenderingContext !== 'undefined') {\r\n        handlers.push(...patchGLPrototype(win.WebGL2RenderingContext.prototype, CanvasContext.WebGL2, cb, blockClass, blockSelector, mirror, win));\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvasWebGLMutationObserver as default };\n","function decodeBase64(base64, enableUnicode) {\n    var binaryString = atob(base64);\n    if (enableUnicode) {\n        var binaryView = new Uint8Array(binaryString.length);\n        for (var i = 0, n = binaryString.length; i < n; ++i) {\n            binaryView[i] = binaryString.charCodeAt(i);\n        }\n        return String.fromCharCode.apply(null, new Uint16Array(binaryView.buffer));\n    }\n    return binaryString;\n}\n\nfunction createURL(base64, sourcemapArg, enableUnicodeArg) {\n    var sourcemap = sourcemapArg === undefined ? null : sourcemapArg;\n    var enableUnicode = enableUnicodeArg === undefined ? false : enableUnicodeArg;\n    var source = decodeBase64(base64, enableUnicode);\n    var start = source.indexOf('\\n', 10) + 1;\n    var body = source.substring(start) + (sourcemap ? '\\/\\/# sourceMappingURL=' + sourcemap : '');\n    var blob = new Blob([body], { type: 'application/javascript' });\n    return URL.createObjectURL(blob);\n}\n\nfunction createBase64WorkerFactory(base64, sourcemapArg, enableUnicodeArg) {\n    var url;\n    return function WorkerFactory(options) {\n        url = url || createURL(base64, sourcemapArg, enableUnicodeArg);\n        return new Worker(url, options);\n    };\n}\n\nexport { createBase64WorkerFactory };\n","import { createBase64WorkerFactory } from './_rollup-plugin-web-worker-loader__helper__browser__createBase64WorkerFactory.js';\n\nvar WorkerFactory = createBase64WorkerFactory('Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIC8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICAgIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLg0KDQogICAgUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQogICAgcHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLg0KDQogICAgVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEgNCiAgICBSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCiAgICBBTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsDQogICAgSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NDQogICAgTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCiAgICBPVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SDQogICAgUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS4NCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLw0KDQogICAgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikgew0KICAgICAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH0NCiAgICAgICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvclsidGhyb3ciXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9DQogICAgICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpOw0KICAgICAgICB9KTsNCiAgICB9CgogICAgLyoKICAgICAqIGJhc2U2NC1hcnJheWJ1ZmZlciAxLjAuMSA8aHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlcj4KICAgICAqIENvcHlyaWdodCAoYykgMjAyMSBOaWtsYXMgdm9uIEhlcnR6ZW4gPGh0dHBzOi8vaGVydHplbi5jb20+CiAgICAgKiBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZQogICAgICovCiAgICB2YXIgY2hhcnMgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyc7CiAgICAvLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguCiAgICB2YXIgbG9va3VwID0gdHlwZW9mIFVpbnQ4QXJyYXkgPT09ICd1bmRlZmluZWQnID8gW10gOiBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgIGxvb2t1cFtjaGFycy5jaGFyQ29kZUF0KGkpXSA9IGk7CiAgICB9CiAgICB2YXIgZW5jb2RlID0gZnVuY3Rpb24gKGFycmF5YnVmZmVyKSB7CiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlidWZmZXIpLCBpLCBsZW4gPSBieXRlcy5sZW5ndGgsIGJhc2U2NCA9ICcnOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkgKz0gMykgewogICAgICAgICAgICBiYXNlNjQgKz0gY2hhcnNbYnl0ZXNbaV0gPj4gMl07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1soKGJ5dGVzW2ldICYgMykgPDwgNCkgfCAoYnl0ZXNbaSArIDFdID4+IDQpXTsKICAgICAgICAgICAgYmFzZTY0ICs9IGNoYXJzWygoYnl0ZXNbaSArIDFdICYgMTUpIDw8IDIpIHwgKGJ5dGVzW2kgKyAyXSA+PiA2KV07CiAgICAgICAgICAgIGJhc2U2NCArPSBjaGFyc1tieXRlc1tpICsgMl0gJiA2M107CiAgICAgICAgfQogICAgICAgIGlmIChsZW4gJSAzID09PSAyKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDEpICsgJz0nOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChsZW4gJSAzID09PSAxKSB7CiAgICAgICAgICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgJz09JzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJhc2U2NDsKICAgIH07CgogICAgY29uc3QgbGFzdEJsb2JNYXAgPSBuZXcgTWFwKCk7DQogICAgY29uc3QgdHJhbnNwYXJlbnRCbG9iTWFwID0gbmV3IE1hcCgpOw0KICAgIGZ1bmN0aW9uIGdldFRyYW5zcGFyZW50QmxvYkZvcih3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucykgew0KICAgICAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkgew0KICAgICAgICAgICAgY29uc3QgaWQgPSBgJHt3aWR0aH0tJHtoZWlnaHR9YDsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW50QmxvYk1hcC5oYXMoaWQpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNwYXJlbnRCbG9iTWFwLmdldChpZCk7DQogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2NyZWVuID0gbmV3IE9mZnNjcmVlbkNhbnZhcyh3aWR0aCwgaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBvZmZzY3JlZW4uZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0geWllbGQgYmxvYi5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGJhc2U2NCA9IGVuY29kZShhcnJheUJ1ZmZlcik7DQogICAgICAgICAgICAgICAgdHJhbnNwYXJlbnRCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZTY0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICcnOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQogICAgY29uc3Qgd29ya2VyID0gc2VsZjsNCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHsNCiAgICAgICAgICAgIGlmICgnT2Zmc2NyZWVuQ2FudmFzJyBpbiBnbG9iYWxUaGlzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBpZCwgYml0bWFwLCB3aWR0aCwgaGVpZ2h0LCBkYXRhVVJMT3B0aW9ucyB9ID0gZS5kYXRhOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zcGFyZW50QmFzZTY0ID0gZ2V0VHJhbnNwYXJlbnRCbG9iRm9yKHdpZHRoLCBoZWlnaHQsIGRhdGFVUkxPcHRpb25zKTsNCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzY3JlZW4gPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IG9mZnNjcmVlbi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwKTsNCiAgICAgICAgICAgICAgICBiaXRtYXAuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0geWllbGQgb2Zmc2NyZWVuLmNvbnZlcnRUb0Jsb2IoZGF0YVVSTE9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBibG9iLnR5cGU7DQogICAgICAgICAgICAgICAgY29uc3QgYXJyYXlCdWZmZXIgPSB5aWVsZCBibG9iLmFycmF5QnVmZmVyKCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gZW5jb2RlKGFycmF5QnVmZmVyKTsNCiAgICAgICAgICAgICAgICBpZiAoIWxhc3RCbG9iTWFwLmhhcyhpZCkgJiYgKHlpZWxkIHRyYW5zcGFyZW50QmFzZTY0KSA9PT0gYmFzZTY0KSB7DQogICAgICAgICAgICAgICAgICAgIGxhc3RCbG9iTWFwLnNldChpZCwgYmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtlci5wb3N0TWVzc2FnZSh7IGlkIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobGFzdEJsb2JNYXAuZ2V0KGlkKSA9PT0gYmFzZTY0KQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQgfSk7DQogICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHsNCiAgICAgICAgICAgICAgICAgICAgaWQsDQogICAgICAgICAgICAgICAgICAgIHR5cGUsDQogICAgICAgICAgICAgICAgICAgIGJhc2U2NCwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodCwNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBsYXN0QmxvYk1hcC5zZXQoaWQsIGJhc2U2NCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gd29ya2VyLnBvc3RNZXNzYWdlKHsgaWQ6IGUuZGF0YS5pZCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsKCn0pKCk7Cgo=', null, false);\n/* eslint-enable */\n\nexport { WorkerFactory as default };\n","import { createMirror, snapshot } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { initObservers, mutationBuffers } from './observer.js';\nimport { polyfill, nowTimestamp, on, getWindowWidth, getWindowHeight, getWindowScroll, isSerializedIframe, isSerializedStylesheet, hasShadowRoot } from '../utils.js';\nimport { EventType, IncrementalSource } from '../../../types/dist/types.js';\nimport { IframeManager } from './iframe-manager.js';\nimport { ShadowDomManager } from './shadow-dom-manager.js';\nimport { CanvasManager } from './observers/canvas/canvas-manager.js';\nimport { StylesheetManager } from './stylesheet-manager.js';\nimport ProcessedNodeManager from './processed-node-manager.js';\nimport { callbackWrapper, unregisterErrorHandler, registerErrorHandler } from './error-handler.js';\n\nfunction wrapEvent(e) {\r\n    return Object.assign(Object.assign({}, e), { timestamp: nowTimestamp() });\r\n}\r\nlet wrappedEmit;\r\nlet takeFullSnapshot;\r\nlet canvasManager;\r\nlet recording = false;\r\nconst mirror = createMirror();\r\nfunction record(options = {}) {\r\n    const { emit, checkoutEveryNms, checkoutEveryNth, blockClass = 'rr-block', blockSelector = null, ignoreClass = 'rr-ignore', ignoreSelector = null, maskTextClass = 'rr-mask', maskTextSelector = null, inlineStylesheet = true, maskAllInputs, maskInputOptions: _maskInputOptions, slimDOMOptions: _slimDOMOptions, maskInputFn, maskTextFn, hooks, packFn, sampling = {}, dataURLOptions = {}, mousemoveWait, recordCanvas = false, recordCrossOriginIframes = false, recordAfter = options.recordAfter === 'DOMContentLoaded'\r\n        ? options.recordAfter\r\n        : 'load', userTriggeredOnInput = false, collectFonts = false, inlineImages = false, plugins, keepIframeSrcFn = () => false, ignoreCSSAttributes = new Set([]), errorHandler, } = options;\r\n    registerErrorHandler(errorHandler);\r\n    const inEmittingFrame = recordCrossOriginIframes\r\n        ? window.parent === window\r\n        : true;\r\n    let passEmitsToParent = false;\r\n    if (!inEmittingFrame) {\r\n        try {\r\n            if (window.parent.document) {\r\n                passEmitsToParent = false;\r\n            }\r\n        }\r\n        catch (e) {\r\n            passEmitsToParent = true;\r\n        }\r\n    }\r\n    if (inEmittingFrame && !emit) {\r\n        throw new Error('emit function is required');\r\n    }\r\n    if (mousemoveWait !== undefined && sampling.mousemove === undefined) {\r\n        sampling.mousemove = mousemoveWait;\r\n    }\r\n    mirror.reset();\r\n    const maskInputOptions = maskAllInputs === true\r\n        ? {\r\n            color: true,\r\n            date: true,\r\n            'datetime-local': true,\r\n            email: true,\r\n            month: true,\r\n            number: true,\r\n            range: true,\r\n            search: true,\r\n            tel: true,\r\n            text: true,\r\n            time: true,\r\n            url: true,\r\n            week: true,\r\n            textarea: true,\r\n            select: true,\r\n            password: true,\r\n        }\r\n        : _maskInputOptions !== undefined\r\n            ? _maskInputOptions\r\n            : { password: true };\r\n    const slimDOMOptions = _slimDOMOptions === true || _slimDOMOptions === 'all'\r\n        ? {\r\n            script: true,\r\n            comment: true,\r\n            headFavicon: true,\r\n            headWhitespace: true,\r\n            headMetaSocial: true,\r\n            headMetaRobots: true,\r\n            headMetaHttpEquiv: true,\r\n            headMetaVerification: true,\r\n            headMetaAuthorship: _slimDOMOptions === 'all',\r\n            headMetaDescKeywords: _slimDOMOptions === 'all',\r\n        }\r\n        : _slimDOMOptions\r\n            ? _slimDOMOptions\r\n            : {};\r\n    polyfill();\r\n    let lastFullSnapshotEvent;\r\n    let incrementalSnapshotCount = 0;\r\n    const eventProcessor = (e) => {\r\n        for (const plugin of plugins || []) {\r\n            if (plugin.eventProcessor) {\r\n                e = plugin.eventProcessor(e);\r\n            }\r\n        }\r\n        if (packFn &&\r\n            !passEmitsToParent) {\r\n            e = packFn(e);\r\n        }\r\n        return e;\r\n    };\r\n    wrappedEmit = (e, isCheckout) => {\r\n        var _a;\r\n        if (((_a = mutationBuffers[0]) === null || _a === void 0 ? void 0 : _a.isFrozen()) &&\r\n            e.type !== EventType.FullSnapshot &&\r\n            !(e.type === EventType.IncrementalSnapshot &&\r\n                e.data.source === IncrementalSource.Mutation)) {\r\n            mutationBuffers.forEach((buf) => buf.unfreeze());\r\n        }\r\n        if (inEmittingFrame) {\r\n            emit === null || emit === void 0 ? void 0 : emit(eventProcessor(e), isCheckout);\r\n        }\r\n        else if (passEmitsToParent) {\r\n            const message = {\r\n                type: 'rrweb',\r\n                event: eventProcessor(e),\r\n                origin: window.location.origin,\r\n                isCheckout,\r\n            };\r\n            window.parent.postMessage(message, '*');\r\n        }\r\n        if (e.type === EventType.FullSnapshot) {\r\n            lastFullSnapshotEvent = e;\r\n            incrementalSnapshotCount = 0;\r\n        }\r\n        else if (e.type === EventType.IncrementalSnapshot) {\r\n            if (e.data.source === IncrementalSource.Mutation &&\r\n                e.data.isAttachIframe) {\r\n                return;\r\n            }\r\n            incrementalSnapshotCount++;\r\n            const exceedCount = checkoutEveryNth && incrementalSnapshotCount >= checkoutEveryNth;\r\n            const exceedTime = checkoutEveryNms &&\r\n                e.timestamp - lastFullSnapshotEvent.timestamp > checkoutEveryNms;\r\n            if (exceedCount || exceedTime) {\r\n                takeFullSnapshot(true);\r\n            }\r\n        }\r\n    };\r\n    const wrappedMutationEmit = (m) => {\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.IncrementalSnapshot,\r\n            data: Object.assign({ source: IncrementalSource.Mutation }, m),\r\n        }));\r\n    };\r\n    const wrappedScrollEmit = (p) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.Scroll }, p),\r\n    }));\r\n    const wrappedCanvasMutationEmit = (p) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.CanvasMutation }, p),\r\n    }));\r\n    const wrappedAdoptedStyleSheetEmit = (a) => wrappedEmit(wrapEvent({\r\n        type: EventType.IncrementalSnapshot,\r\n        data: Object.assign({ source: IncrementalSource.AdoptedStyleSheet }, a),\r\n    }));\r\n    const stylesheetManager = new StylesheetManager({\r\n        mutationCb: wrappedMutationEmit,\r\n        adoptedStyleSheetCb: wrappedAdoptedStyleSheetEmit,\r\n    });\r\n    const iframeManager = new IframeManager({\r\n        mirror,\r\n        mutationCb: wrappedMutationEmit,\r\n        stylesheetManager: stylesheetManager,\r\n        recordCrossOriginIframes,\r\n        wrappedEmit,\r\n    });\r\n    for (const plugin of plugins || []) {\r\n        if (plugin.getMirror)\r\n            plugin.getMirror({\r\n                nodeMirror: mirror,\r\n                crossOriginIframeMirror: iframeManager.crossOriginIframeMirror,\r\n                crossOriginIframeStyleMirror: iframeManager.crossOriginIframeStyleMirror,\r\n            });\r\n    }\r\n    const processedNodeManager = new ProcessedNodeManager();\r\n    canvasManager = new CanvasManager({\r\n        recordCanvas,\r\n        mutationCb: wrappedCanvasMutationEmit,\r\n        win: window,\r\n        blockClass,\r\n        blockSelector,\r\n        mirror,\r\n        sampling: sampling.canvas,\r\n        dataURLOptions,\r\n    });\r\n    const shadowDomManager = new ShadowDomManager({\r\n        mutationCb: wrappedMutationEmit,\r\n        scrollCb: wrappedScrollEmit,\r\n        bypassOptions: {\r\n            blockClass,\r\n            blockSelector,\r\n            maskTextClass,\r\n            maskTextSelector,\r\n            inlineStylesheet,\r\n            maskInputOptions,\r\n            dataURLOptions,\r\n            maskTextFn,\r\n            maskInputFn,\r\n            recordCanvas,\r\n            inlineImages,\r\n            sampling,\r\n            slimDOMOptions,\r\n            iframeManager,\r\n            stylesheetManager,\r\n            canvasManager,\r\n            keepIframeSrcFn,\r\n            processedNodeManager,\r\n        },\r\n        mirror,\r\n    });\r\n    takeFullSnapshot = (isCheckout = false) => {\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.Meta,\r\n            data: {\r\n                href: window.location.href,\r\n                width: getWindowWidth(),\r\n                height: getWindowHeight(),\r\n            },\r\n        }), isCheckout);\r\n        stylesheetManager.reset();\r\n        shadowDomManager.init();\r\n        mutationBuffers.forEach((buf) => buf.lock());\r\n        const node = snapshot(document, {\r\n            mirror,\r\n            blockClass,\r\n            blockSelector,\r\n            maskTextClass,\r\n            maskTextSelector,\r\n            inlineStylesheet,\r\n            maskAllInputs: maskInputOptions,\r\n            maskTextFn,\r\n            slimDOM: slimDOMOptions,\r\n            dataURLOptions,\r\n            recordCanvas,\r\n            inlineImages,\r\n            onSerialize: (n) => {\r\n                if (isSerializedIframe(n, mirror)) {\r\n                    iframeManager.addIframe(n);\r\n                }\r\n                if (isSerializedStylesheet(n, mirror)) {\r\n                    stylesheetManager.trackLinkElement(n);\r\n                }\r\n                if (hasShadowRoot(n)) {\r\n                    shadowDomManager.addShadowRoot(n.shadowRoot, document);\r\n                }\r\n            },\r\n            onIframeLoad: (iframe, childSn) => {\r\n                iframeManager.attachIframe(iframe, childSn);\r\n                shadowDomManager.observeAttachShadow(iframe);\r\n            },\r\n            onStylesheetLoad: (linkEl, childSn) => {\r\n                stylesheetManager.attachLinkElement(linkEl, childSn);\r\n            },\r\n            keepIframeSrcFn,\r\n        });\r\n        if (!node) {\r\n            return console.warn('Failed to snapshot the document');\r\n        }\r\n        wrappedEmit(wrapEvent({\r\n            type: EventType.FullSnapshot,\r\n            data: {\r\n                node,\r\n                initialOffset: getWindowScroll(window),\r\n            },\r\n        }), isCheckout);\r\n        mutationBuffers.forEach((buf) => buf.unlock());\r\n        if (document.adoptedStyleSheets && document.adoptedStyleSheets.length > 0)\r\n            stylesheetManager.adoptStyleSheets(document.adoptedStyleSheets, mirror.getId(document));\r\n    };\r\n    try {\r\n        const handlers = [];\r\n        const observe = (doc) => {\r\n            var _a;\r\n            return callbackWrapper(initObservers)({\r\n                mutationCb: wrappedMutationEmit,\r\n                mousemoveCb: (positions, source) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: {\r\n                        source,\r\n                        positions,\r\n                    },\r\n                })),\r\n                mouseInteractionCb: (d) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.MouseInteraction }, d),\r\n                })),\r\n                scrollCb: wrappedScrollEmit,\r\n                viewportResizeCb: (d) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.ViewportResize }, d),\r\n                })),\r\n                inputCb: (v) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.Input }, v),\r\n                })),\r\n                mediaInteractionCb: (p) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.MediaInteraction }, p),\r\n                })),\r\n                styleSheetRuleCb: (r) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.StyleSheetRule }, r),\r\n                })),\r\n                styleDeclarationCb: (r) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.StyleDeclaration }, r),\r\n                })),\r\n                canvasMutationCb: wrappedCanvasMutationEmit,\r\n                fontCb: (p) => wrappedEmit(wrapEvent({\r\n                    type: EventType.IncrementalSnapshot,\r\n                    data: Object.assign({ source: IncrementalSource.Font }, p),\r\n                })),\r\n                selectionCb: (p) => {\r\n                    wrappedEmit(wrapEvent({\r\n                        type: EventType.IncrementalSnapshot,\r\n                        data: Object.assign({ source: IncrementalSource.Selection }, p),\r\n                    }));\r\n                },\r\n                blockClass,\r\n                ignoreClass,\r\n                ignoreSelector,\r\n                maskTextClass,\r\n                maskTextSelector,\r\n                maskInputOptions,\r\n                inlineStylesheet,\r\n                sampling,\r\n                recordCanvas,\r\n                inlineImages,\r\n                userTriggeredOnInput,\r\n                collectFonts,\r\n                doc,\r\n                maskInputFn,\r\n                maskTextFn,\r\n                keepIframeSrcFn,\r\n                blockSelector,\r\n                slimDOMOptions,\r\n                dataURLOptions,\r\n                mirror,\r\n                iframeManager,\r\n                stylesheetManager,\r\n                shadowDomManager,\r\n                processedNodeManager,\r\n                canvasManager,\r\n                ignoreCSSAttributes,\r\n                plugins: ((_a = plugins === null || plugins === void 0 ? void 0 : plugins.filter((p) => p.observer)) === null || _a === void 0 ? void 0 : _a.map((p) => ({\r\n                    observer: p.observer,\r\n                    options: p.options,\r\n                    callback: (payload) => wrappedEmit(wrapEvent({\r\n                        type: EventType.Plugin,\r\n                        data: {\r\n                            plugin: p.name,\r\n                            payload,\r\n                        },\r\n                    })),\r\n                }))) || [],\r\n            }, hooks);\r\n        };\r\n        iframeManager.addLoadListener((iframeEl) => {\r\n            try {\r\n                handlers.push(observe(iframeEl.contentDocument));\r\n            }\r\n            catch (error) {\r\n                console.warn(error);\r\n            }\r\n        });\r\n        const init = () => {\r\n            takeFullSnapshot();\r\n            handlers.push(observe(document));\r\n            recording = true;\r\n        };\r\n        if (document.readyState === 'interactive' ||\r\n            document.readyState === 'complete') {\r\n            init();\r\n        }\r\n        else {\r\n            handlers.push(on('DOMContentLoaded', () => {\r\n                wrappedEmit(wrapEvent({\r\n                    type: EventType.DomContentLoaded,\r\n                    data: {},\r\n                }));\r\n                if (recordAfter === 'DOMContentLoaded')\r\n                    init();\r\n            }));\r\n            handlers.push(on('load', () => {\r\n                wrappedEmit(wrapEvent({\r\n                    type: EventType.Load,\r\n                    data: {},\r\n                }));\r\n                if (recordAfter === 'load')\r\n                    init();\r\n            }, window));\r\n        }\r\n        return () => {\r\n            handlers.forEach((h) => h());\r\n            processedNodeManager.destroy();\r\n            recording = false;\r\n            unregisterErrorHandler();\r\n        };\r\n    }\r\n    catch (error) {\r\n        console.warn(error);\r\n    }\r\n}\r\nrecord.addCustomEvent = (tag, payload) => {\r\n    if (!recording) {\r\n        throw new Error('please add custom event after start recording');\r\n    }\r\n    wrappedEmit(wrapEvent({\r\n        type: EventType.Custom,\r\n        data: {\r\n            tag,\r\n            payload,\r\n        },\r\n    }));\r\n};\r\nrecord.freezePage = () => {\r\n    mutationBuffers.forEach((buf) => buf.freeze());\r\n};\r\nrecord.takeFullSnapshot = (isCheckout) => {\r\n    if (!recording) {\r\n        throw new Error('please take full snapshot after start recording');\r\n    }\r\n    takeFullSnapshot(isCheckout);\r\n};\r\nrecord.mirror = mirror;\n\nexport { record as default };\n","import { __rest, __awaiter } from './../../../../../../ext/tslib/tslib.es6.js';\nimport { isBlocked } from '../../../utils.js';\nimport { CanvasContext } from '../../../../../types/dist/types.js';\nimport initCanvas2DMutationObserver from './2d.js';\nimport initCanvasContextObserver from './canvas.js';\nimport initCanvasWebGLMutationObserver from './webgl.js';\nimport WorkerFactory from '../../../../../../_virtual/image-bitmap-data-url-worker.js';\n\nclass CanvasManager {\r\n    reset() {\r\n        this.pendingCanvasMutations.clear();\r\n        this.resetObservers && this.resetObservers();\r\n    }\r\n    freeze() {\r\n        this.frozen = true;\r\n    }\r\n    unfreeze() {\r\n        this.frozen = false;\r\n    }\r\n    lock() {\r\n        this.locked = true;\r\n    }\r\n    unlock() {\r\n        this.locked = false;\r\n    }\r\n    constructor(options) {\r\n        this.pendingCanvasMutations = new Map();\r\n        this.rafStamps = { latestId: 0, invokeId: null };\r\n        this.frozen = false;\r\n        this.locked = false;\r\n        this.processMutation = (target, mutation) => {\r\n            const newFrame = this.rafStamps.invokeId &&\r\n                this.rafStamps.latestId !== this.rafStamps.invokeId;\r\n            if (newFrame || !this.rafStamps.invokeId)\r\n                this.rafStamps.invokeId = this.rafStamps.latestId;\r\n            if (!this.pendingCanvasMutations.has(target)) {\r\n                this.pendingCanvasMutations.set(target, []);\r\n            }\r\n            this.pendingCanvasMutations.get(target).push(mutation);\r\n        };\r\n        const { sampling = 'all', win, blockClass, blockSelector, recordCanvas, dataURLOptions, } = options;\r\n        this.mutationCb = options.mutationCb;\r\n        this.mirror = options.mirror;\r\n        if (recordCanvas && sampling === 'all')\r\n            this.initCanvasMutationObserver(win, blockClass, blockSelector);\r\n        if (recordCanvas && typeof sampling === 'number')\r\n            this.initCanvasFPSObserver(sampling, win, blockClass, blockSelector, {\r\n                dataURLOptions,\r\n            });\r\n    }\r\n    initCanvasFPSObserver(fps, win, blockClass, blockSelector, options) {\r\n        const canvasContextReset = initCanvasContextObserver(win, blockClass, blockSelector, true);\r\n        const snapshotInProgressMap = new Map();\r\n        const worker = new WorkerFactory();\r\n        worker.onmessage = (e) => {\r\n            const { id } = e.data;\r\n            snapshotInProgressMap.set(id, false);\r\n            if (!('base64' in e.data))\r\n                return;\r\n            const { base64, type, width, height } = e.data;\r\n            this.mutationCb({\r\n                id,\r\n                type: CanvasContext['2D'],\r\n                commands: [\r\n                    {\r\n                        property: 'clearRect',\r\n                        args: [0, 0, width, height],\r\n                    },\r\n                    {\r\n                        property: 'drawImage',\r\n                        args: [\r\n                            {\r\n                                rr_type: 'ImageBitmap',\r\n                                args: [\r\n                                    {\r\n                                        rr_type: 'Blob',\r\n                                        data: [{ rr_type: 'ArrayBuffer', base64 }],\r\n                                        type,\r\n                                    },\r\n                                ],\r\n                            },\r\n                            0,\r\n                            0,\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n        };\r\n        const timeBetweenSnapshots = 1000 / fps;\r\n        let lastSnapshotTime = 0;\r\n        let rafId;\r\n        const getCanvas = () => {\r\n            const matchedCanvas = [];\r\n\r\n            const searchCanvas = (root) => {\r\n                root.querySelectorAll('canvas').forEach((canvas) => {\r\n                    if (!isBlocked(canvas, blockClass, blockSelector, true)) {\r\n                        matchedCanvas.push(canvas);\r\n                    }\r\n                });\r\n                root.querySelectorAll('*').forEach((elem) => {\r\n                    if (elem.shadowRoot) {\r\n                        searchCanvas(elem.shadowRoot);\r\n                    }\r\n                });\r\n            };\r\n\r\n            searchCanvas(win.document);\r\n\r\n            return matchedCanvas;\r\n        };\r\n        const takeCanvasSnapshots = (timestamp) => {\r\n            if (lastSnapshotTime &&\r\n                timestamp - lastSnapshotTime < timeBetweenSnapshots) {\r\n                rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n                return;\r\n            }\r\n            lastSnapshotTime = timestamp;\r\n            getCanvas()\r\n                .forEach((canvas) => __awaiter(this, void 0, void 0, function* () {\r\n                var _a;\r\n                const id = this.mirror.getId(canvas);\r\n                if (snapshotInProgressMap.get(id))\r\n                    return;\r\n\r\n                // The browser throws if the canvas is 0 in size\r\n                // Uncaught (in promise) DOMException: Failed to execute 'createImageBitmap' on 'Window': The source image width is 0.\r\n                // Assuming the same happens with height\r\n                if (canvas.width === 0 || canvas.height === 0) return;\r\n\r\n                snapshotInProgressMap.set(id, true);\r\n                if (['webgl', 'webgl2'].includes(canvas.__context)) {\r\n                    const context = canvas.getContext(canvas.__context);\r\n                    if (((_a = context === null || context === void 0 ? void 0 : context.getContextAttributes()) === null || _a === void 0 ? void 0 : _a.preserveDrawingBuffer) === false) {\r\n                        context.clear(context.COLOR_BUFFER_BIT);\r\n                    }\r\n                }\r\n\r\n                const width = canvas.clientWidth;\r\n                const height = canvas.clientHeight;\r\n                \r\n                const bitmap = yield createImageBitmap(canvas, {\r\n                    resizeWidth: width,\r\n                    resizeHeight: height\r\n                })\r\n                worker.postMessage({\r\n                    id,\r\n                    bitmap,\r\n                    width: width,\r\n                    height: height,\r\n                    dataURLOptions: options.dataURLOptions,\r\n                }, [bitmap]);\r\n            }));\r\n            rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n        };\r\n        rafId = requestAnimationFrame(takeCanvasSnapshots);\r\n        this.resetObservers = () => {\r\n            canvasContextReset();\r\n            cancelAnimationFrame(rafId);\r\n        };\r\n    }\r\n    initCanvasMutationObserver(win, blockClass, blockSelector) {\r\n        this.startRAFTimestamping();\r\n        this.startPendingCanvasMutationFlusher();\r\n        const canvasContextReset = initCanvasContextObserver(win, blockClass, blockSelector, false);\r\n        const canvas2DReset = initCanvas2DMutationObserver(this.processMutation.bind(this), win, blockClass, blockSelector);\r\n        const canvasWebGL1and2Reset = initCanvasWebGLMutationObserver(this.processMutation.bind(this), win, blockClass, blockSelector, this.mirror);\r\n        this.resetObservers = () => {\r\n            canvasContextReset();\r\n            canvas2DReset();\r\n            canvasWebGL1and2Reset();\r\n        };\r\n    }\r\n    startPendingCanvasMutationFlusher() {\r\n        requestAnimationFrame(() => this.flushPendingCanvasMutations());\r\n    }\r\n    startRAFTimestamping() {\r\n        const setLatestRAFTimestamp = (timestamp) => {\r\n            this.rafStamps.latestId = timestamp;\r\n            requestAnimationFrame(setLatestRAFTimestamp);\r\n        };\r\n        requestAnimationFrame(setLatestRAFTimestamp);\r\n    }\r\n    flushPendingCanvasMutations() {\r\n        this.pendingCanvasMutations.forEach((values, canvas) => {\r\n            const id = this.mirror.getId(canvas);\r\n            this.flushPendingCanvasMutationFor(canvas, id);\r\n        });\r\n        requestAnimationFrame(() => this.flushPendingCanvasMutations());\r\n    }\r\n    flushPendingCanvasMutationFor(canvas, id) {\r\n        if (this.frozen || this.locked) {\r\n            return;\r\n        }\r\n        const valuesWithType = this.pendingCanvasMutations.get(canvas);\r\n        if (!valuesWithType || id === -1)\r\n            return;\r\n        const values = valuesWithType.map((value) => {\r\n            const rest = __rest(value, [\"type\"]);\r\n            return rest;\r\n        });\r\n        const { type } = valuesWithType[0];\r\n        this.mutationCb({ id, type, commands: values });\r\n        this.pendingCanvasMutations.delete(canvas);\r\n    }\r\n}\n\nexport { CanvasManager };\n","import { CanvasContext } from '../../../../../types/dist/types.js';\nimport { patch, isBlocked, hookSetter } from '../../../utils.js';\nimport { serializeArgs } from './serialize-args.js';\n\nfunction initCanvas2DMutationObserver(cb, win, blockClass, blockSelector) {\r\n    const handlers = [];\r\n    const props2D = Object.getOwnPropertyNames(win.CanvasRenderingContext2D.prototype);\r\n    for (const prop of props2D) {\r\n        try {\r\n            if (typeof win.CanvasRenderingContext2D.prototype[prop] !== 'function') {\r\n                continue;\r\n            }\r\n            const restoreHandler = patch(win.CanvasRenderingContext2D.prototype, prop, function (original) {\r\n                return function (...args) {\r\n                    if (!isBlocked(this.canvas, blockClass, blockSelector, true)) {\r\n                        setTimeout(() => {\r\n                            const recordArgs = serializeArgs([...args], win, this);\r\n                            cb(this.canvas, {\r\n                                type: CanvasContext['2D'],\r\n                                property: prop,\r\n                                args: recordArgs,\r\n                            });\r\n                        }, 0);\r\n                    }\r\n                    return original.apply(this, args);\r\n                };\r\n            });\r\n            handlers.push(restoreHandler);\r\n        }\r\n        catch (_a) {\r\n            const hookHandler = hookSetter(win.CanvasRenderingContext2D.prototype, prop, {\r\n                set(v) {\r\n                    cb(this.canvas, {\r\n                        type: CanvasContext['2D'],\r\n                        property: prop,\r\n                        args: [v],\r\n                        setter: true,\r\n                    });\r\n                },\r\n            });\r\n            handlers.push(hookHandler);\r\n        }\r\n    }\r\n    return () => {\r\n        handlers.forEach((h) => h());\r\n    };\r\n}\n\nexport { initCanvas2DMutationObserver as default };\n","import { stringifyRule } from '../../../rrweb-snapshot/es/rrweb-snapshot.js';\nimport { StyleSheetMirror } from '../utils.js';\n\nclass StylesheetManager {\r\n    constructor(options) {\r\n        this.trackedLinkElements = new WeakSet();\r\n        this.styleMirror = new StyleSheetMirror();\r\n        this.mutationCb = options.mutationCb;\r\n        this.adoptedStyleSheetCb = options.adoptedStyleSheetCb;\r\n    }\r\n    attachLinkElement(linkEl, childSn) {\r\n        if ('_cssText' in childSn.attributes)\r\n            this.mutationCb({\r\n                adds: [],\r\n                removes: [],\r\n                texts: [],\r\n                attributes: [\r\n                    {\r\n                        id: childSn.id,\r\n                        attributes: childSn\r\n                            .attributes,\r\n                    },\r\n                ],\r\n            });\r\n        this.trackLinkElement(linkEl);\r\n    }\r\n    trackLinkElement(linkEl) {\r\n        if (this.trackedLinkElements.has(linkEl))\r\n            return;\r\n        this.trackedLinkElements.add(linkEl);\r\n        this.trackStylesheetInLinkElement(linkEl);\r\n    }\r\n    adoptStyleSheets(sheets, hostId) {\r\n        if (sheets.length === 0)\r\n            return;\r\n        const adoptedStyleSheetData = {\r\n            id: hostId,\r\n            styleIds: [],\r\n        };\r\n        const styles = [];\r\n        for (const sheet of sheets) {\r\n            let styleId;\r\n            if (!this.styleMirror.has(sheet)) {\r\n                styleId = this.styleMirror.add(sheet);\r\n                const rules = Array.from(sheet.rules || CSSRule);\r\n                styles.push({\r\n                    styleId,\r\n                    rules: rules.map((r, index) => {\r\n                        return {\r\n                            rule: stringifyRule(r),\r\n                            index,\r\n                        };\r\n                    }),\r\n                });\r\n            }\r\n            else\r\n                styleId = this.styleMirror.getId(sheet);\r\n            adoptedStyleSheetData.styleIds.push(styleId);\r\n        }\r\n        if (styles.length > 0)\r\n            adoptedStyleSheetData.styles = styles;\r\n        this.adoptedStyleSheetCb(adoptedStyleSheetData);\r\n    }\r\n    reset() {\r\n        this.styleMirror.reset();\r\n        this.trackedLinkElements = new WeakSet();\r\n    }\r\n    trackStylesheetInLinkElement(linkEl) {\r\n    }\r\n}\n\nexport { StylesheetManager };\n","class ProcessedNodeManager {\r\n    constructor() {\r\n        this.nodeMap = new WeakMap();\r\n        this.loop = true;\r\n        this.periodicallyClear();\r\n    }\r\n    periodicallyClear() {\r\n        requestAnimationFrame(() => {\r\n            this.clear();\r\n            if (this.loop)\r\n                this.periodicallyClear();\r\n        });\r\n    }\r\n    inOtherBuffer(node, thisBuffer) {\r\n        const buffers = this.nodeMap.get(node);\r\n        return (buffers && Array.from(buffers).some((buffer) => buffer !== thisBuffer));\r\n    }\r\n    add(node, buffer) {\r\n        this.nodeMap.set(node, (this.nodeMap.get(node) || new Set()).add(buffer));\r\n    }\r\n    clear() {\r\n        this.nodeMap = new WeakMap();\r\n    }\r\n    destroy() {\r\n        this.loop = false;\r\n    }\r\n}\n\nexport { ProcessedNodeManager as default };\n","class StackFrame {\r\n    constructor(obj) {\r\n        this.fileName = obj.fileName || '';\r\n        this.functionName = obj.functionName || '';\r\n        this.lineNumber = obj.lineNumber;\r\n        this.columnNumber = obj.columnNumber;\r\n    }\r\n    toString() {\r\n        const lineNumber = this.lineNumber || '';\r\n        const columnNumber = this.columnNumber || '';\r\n        if (this.functionName)\r\n            return `${this.functionName} (${this.fileName}:${lineNumber}:${columnNumber})`;\r\n        return `${this.fileName}:${lineNumber}:${columnNumber}`;\r\n    }\r\n}\r\nconst FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\r\nconst CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\r\nconst SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\r\nconst ErrorStackParser = {\r\n    parse: function (error) {\r\n        if (!error) {\r\n            return [];\r\n        }\r\n        if (typeof error.stacktrace !== 'undefined' ||\r\n            typeof error['opera#sourceloc'] !== 'undefined') {\r\n            return this.parseOpera(error);\r\n        }\r\n        else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\r\n            return this.parseV8OrIE(error);\r\n        }\r\n        else if (error.stack) {\r\n            return this.parseFFOrSafari(error);\r\n        }\r\n        else {\r\n            console.warn('[console-record-plugin]: Failed to parse error object:', error);\r\n            return [];\r\n        }\r\n    },\r\n    extractLocation: function (urlLike) {\r\n        if (urlLike.indexOf(':') === -1) {\r\n            return [urlLike];\r\n        }\r\n        const regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\r\n        const parts = regExp.exec(urlLike.replace(/[()]/g, ''));\r\n        if (!parts)\r\n            throw new Error(`Cannot parse given url: ${urlLike}`);\r\n        return [parts[1], parts[2] || undefined, parts[3] || undefined];\r\n    },\r\n    parseV8OrIE: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return !!line.match(CHROME_IE_STACK_REGEXP);\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            if (line.indexOf('(eval ') > -1) {\r\n                line = line\r\n                    .replace(/eval code/g, 'eval')\r\n                    .replace(/(\\(eval at [^()]*)|(\\),.*$)/g, '');\r\n            }\r\n            let sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(');\r\n            const location = sanitizedLine.match(/ (\\((.+):(\\d+):(\\d+)\\)$)/);\r\n            sanitizedLine = location\r\n                ? sanitizedLine.replace(location[0], '')\r\n                : sanitizedLine;\r\n            const tokens = sanitizedLine.split(/\\s+/).slice(1);\r\n            const locationParts = this.extractLocation(location ? location[1] : tokens.pop());\r\n            const functionName = tokens.join(' ') || undefined;\r\n            const fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1\r\n                ? undefined\r\n                : locationParts[0];\r\n            return new StackFrame({\r\n                functionName,\r\n                fileName,\r\n                lineNumber: locationParts[1],\r\n                columnNumber: locationParts[2],\r\n            });\r\n        }, this);\r\n    },\r\n    parseFFOrSafari: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return !line.match(SAFARI_NATIVE_CODE_REGEXP);\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            if (line.indexOf(' > eval') > -1) {\r\n                line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\r\n            }\r\n            if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\r\n                return new StackFrame({\r\n                    functionName: line,\r\n                });\r\n            }\r\n            else {\r\n                const functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\r\n                const matches = line.match(functionNameRegex);\r\n                const functionName = matches && matches[1] ? matches[1] : undefined;\r\n                const locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\r\n                return new StackFrame({\r\n                    functionName,\r\n                    fileName: locationParts[0],\r\n                    lineNumber: locationParts[1],\r\n                    columnNumber: locationParts[2],\r\n                });\r\n            }\r\n        }, this);\r\n    },\r\n    parseOpera: function (e) {\r\n        if (!e.stacktrace ||\r\n            (e.message.indexOf('\\n') > -1 &&\r\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\r\n            return this.parseOpera9(e);\r\n        }\r\n        else if (!e.stack) {\r\n            return this.parseOpera10(e);\r\n        }\r\n        else {\r\n            return this.parseOpera11(e);\r\n        }\r\n    },\r\n    parseOpera9: function (e) {\r\n        const lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\r\n        const lines = e.message.split('\\n');\r\n        const result = [];\r\n        for (let i = 2, len = lines.length; i < len; i += 2) {\r\n            const match = lineRE.exec(lines[i]);\r\n            if (match) {\r\n                result.push(new StackFrame({\r\n                    fileName: match[2],\r\n                    lineNumber: parseFloat(match[1]),\r\n                }));\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n    parseOpera10: function (e) {\r\n        const lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\r\n        const lines = e.stacktrace.split('\\n');\r\n        const result = [];\r\n        for (let i = 0, len = lines.length; i < len; i += 2) {\r\n            const match = lineRE.exec(lines[i]);\r\n            if (match) {\r\n                result.push(new StackFrame({\r\n                    functionName: match[3] || undefined,\r\n                    fileName: match[2],\r\n                    lineNumber: parseFloat(match[1]),\r\n                }));\r\n            }\r\n        }\r\n        return result;\r\n    },\r\n    parseOpera11: function (error) {\r\n        const filtered = error.stack.split('\\n').filter(function (line) {\r\n            return (!!line.match(FIREFOX_SAFARI_STACK_REGEXP) &&\r\n                !line.match(/^Error created at/));\r\n        }, this);\r\n        return filtered.map(function (line) {\r\n            const tokens = line.split('@');\r\n            const locationParts = this.extractLocation(tokens.pop());\r\n            const functionCall = tokens.shift() || '';\r\n            const functionName = functionCall\r\n                .replace(/<anonymous function(: (\\w+))?>/, '$2')\r\n                .replace(/\\([^)]*\\)/g, '') || undefined;\r\n            return new StackFrame({\r\n                functionName,\r\n                fileName: locationParts[0],\r\n                lineNumber: locationParts[1],\r\n                columnNumber: locationParts[2],\r\n            });\r\n        }, this);\r\n    },\r\n};\n\nexport { ErrorStackParser, StackFrame };\n","function pathToSelector(node) {\r\n    if (!node || !node.outerHTML) {\r\n        return '';\r\n    }\r\n    let path = '';\r\n    while (node.parentElement) {\r\n        let name = node.localName;\r\n        if (!name) {\r\n            break;\r\n        }\r\n        name = name.toLowerCase();\r\n        const parent = node.parentElement;\r\n        const domSiblings = [];\r\n        if (parent.children && parent.children.length > 0) {\r\n            for (let i = 0; i < parent.children.length; i++) {\r\n                const sibling = parent.children[i];\r\n                if (sibling.localName && sibling.localName.toLowerCase) {\r\n                    if (sibling.localName.toLowerCase() === name) {\r\n                        domSiblings.push(sibling);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (domSiblings.length > 1) {\r\n            name += `:eq(${domSiblings.indexOf(node)})`;\r\n        }\r\n        path = name + (path ? '>' + path : '');\r\n        node = parent;\r\n    }\r\n    return path;\r\n}\r\nfunction isObject(obj) {\r\n    return Object.prototype.toString.call(obj) === '[object Object]';\r\n}\r\nfunction isObjTooDeep(obj, limit) {\r\n    if (limit === 0) {\r\n        return true;\r\n    }\r\n    const keys = Object.keys(obj);\r\n    for (const key of keys) {\r\n        if (isObject(obj[key]) &&\r\n            isObjTooDeep(obj[key], limit - 1)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction stringify(obj, stringifyOptions) {\r\n    const options = {\r\n        numOfKeysLimit: 50,\r\n        depthOfLimit: 4,\r\n    };\r\n    Object.assign(options, stringifyOptions);\r\n    const stack = [];\r\n    const keys = [];\r\n    return JSON.stringify(obj, function (key, value) {\r\n        if (stack.length > 0) {\r\n            const thisPos = stack.indexOf(this);\r\n            ~thisPos ? stack.splice(thisPos + 1) : stack.push(this);\r\n            ~thisPos ? keys.splice(thisPos, Infinity, key) : keys.push(key);\r\n            if (~stack.indexOf(value)) {\r\n                if (stack[0] === value) {\r\n                    value = '[Circular ~]';\r\n                }\r\n                else {\r\n                    value =\r\n                        '[Circular ~.' +\r\n                            keys.slice(0, stack.indexOf(value)).join('.') +\r\n                            ']';\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            stack.push(value);\r\n        }\r\n        if (value === null)\r\n            return value;\r\n        if (value === undefined)\r\n            return 'undefined';\r\n        if (shouldIgnore(value)) {\r\n            return toString(value);\r\n        }\r\n        if (value instanceof Event) {\r\n            const eventResult = {};\r\n            for (const eventKey in value) {\r\n                const eventValue = value[eventKey];\r\n                if (Array.isArray(eventValue)) {\r\n                    eventResult[eventKey] = pathToSelector((eventValue.length ? eventValue[0] : null));\r\n                }\r\n                else {\r\n                    eventResult[eventKey] = eventValue;\r\n                }\r\n            }\r\n            return eventResult;\r\n        }\r\n        else if (value instanceof Node) {\r\n            if (value instanceof HTMLElement) {\r\n                return value ? value.outerHTML : '';\r\n            }\r\n            return value.nodeName;\r\n        }\r\n        else if (value instanceof Error) {\r\n            return value.stack\r\n                ? value.stack + '\\nEnd of stack for Error object'\r\n                : value.name + ': ' + value.message;\r\n        }\r\n        return value;\r\n    });\r\n    function shouldIgnore(_obj) {\r\n        if (isObject(_obj) && Object.keys(_obj).length > options.numOfKeysLimit) {\r\n            return true;\r\n        }\r\n        if (typeof _obj === 'function') {\r\n            return true;\r\n        }\r\n        if (isObject(_obj) &&\r\n            isObjTooDeep(_obj, options.depthOfLimit)) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    function toString(_obj) {\r\n        let str = _obj.toString();\r\n        if (options.stringLengthLimit && str.length > options.stringLengthLimit) {\r\n            str = `${str.slice(0, options.stringLengthLimit)}...`;\r\n        }\r\n        return str;\r\n    }\r\n}\n\nexport { stringify };\n","import { patch } from '../../../utils.js';\nimport { ErrorStackParser } from './error-stack-parser.js';\nimport { stringify } from './stringify.js';\n\nconst defaultLogOptions = {\r\n    level: [\r\n        'assert',\r\n        'clear',\r\n        'count',\r\n        'countReset',\r\n        'debug',\r\n        'dir',\r\n        'dirxml',\r\n        'error',\r\n        'group',\r\n        'groupCollapsed',\r\n        'groupEnd',\r\n        'info',\r\n        'log',\r\n        'table',\r\n        'time',\r\n        'timeEnd',\r\n        'timeLog',\r\n        'trace',\r\n        'warn',\r\n    ],\r\n    lengthThreshold: 1000,\r\n    logger: 'console',\r\n};\r\nfunction initLogObserver(cb, win, options) {\r\n    const logOptions = (options ? Object.assign({}, defaultLogOptions, options) : defaultLogOptions);\r\n    const loggerType = logOptions.logger;\r\n    if (!loggerType) {\r\n        return () => {\r\n        };\r\n    }\r\n    let logger;\r\n    if (typeof loggerType === 'string') {\r\n        logger = win[loggerType];\r\n    }\r\n    else {\r\n        logger = loggerType;\r\n    }\r\n    let logCount = 0;\r\n    let inStack = false;\r\n    const cancelHandlers = [];\r\n    if (logOptions.level.includes('error')) {\r\n        const errorHandler = (event) => {\r\n            const message = event.message, error = event.error;\r\n            const trace = ErrorStackParser.parse(error).map((stackFrame) => stackFrame.toString());\r\n            const payload = [stringify(message, logOptions.stringifyOptions)];\r\n            cb({\r\n                level: 'error',\r\n                trace,\r\n                payload,\r\n            });\r\n        };\r\n        win.addEventListener('error', errorHandler);\r\n        cancelHandlers.push(() => {\r\n            win.removeEventListener('error', errorHandler);\r\n        });\r\n        const unhandledrejectionHandler = (event) => {\r\n            let error;\r\n            let payload;\r\n            if (event.reason instanceof Error) {\r\n                error = event.reason;\r\n                payload = [\r\n                    stringify(`Uncaught (in promise) ${error.name}: ${error.message}`, logOptions.stringifyOptions),\r\n                ];\r\n            }\r\n            else {\r\n                error = new Error();\r\n                payload = [\r\n                    stringify('Uncaught (in promise)', logOptions.stringifyOptions),\r\n                    stringify(event.reason, logOptions.stringifyOptions),\r\n                ];\r\n            }\r\n            const trace = ErrorStackParser.parse(error).map((stackFrame) => stackFrame.toString());\r\n            cb({\r\n                level: 'error',\r\n                trace,\r\n                payload,\r\n            });\r\n        };\r\n        win.addEventListener('unhandledrejection', unhandledrejectionHandler);\r\n        cancelHandlers.push(() => {\r\n            win.removeEventListener('unhandledrejection', unhandledrejectionHandler);\r\n        });\r\n    }\r\n    for (const levelType of logOptions.level) {\r\n        cancelHandlers.push(replace(logger, levelType));\r\n    }\r\n    return () => {\r\n        cancelHandlers.forEach((h) => h());\r\n    };\r\n    function replace(_logger, level) {\r\n        if (!_logger[level]) {\r\n            return () => {\r\n            };\r\n        }\r\n        return patch(_logger, level, (original) => {\r\n            return (...args) => {\r\n                original.apply(this, args);\r\n                if (inStack) {\r\n                    return;\r\n                }\r\n                inStack = true;\r\n                try {\r\n                    const trace = ErrorStackParser.parse(new Error())\r\n                        .map((stackFrame) => stackFrame.toString())\r\n                        .splice(1);\r\n                    const payload = args.map((s) => stringify(s, logOptions.stringifyOptions));\r\n                    logCount++;\r\n                    if (logCount < logOptions.lengthThreshold) {\r\n                        cb({\r\n                            level,\r\n                            trace,\r\n                            payload,\r\n                        });\r\n                    }\r\n                    else if (logCount === logOptions.lengthThreshold) {\r\n                        cb({\r\n                            level: 'warn',\r\n                            trace: [],\r\n                            payload: [\r\n                                stringify('The number of log records reached the threshold.'),\r\n                            ],\r\n                        });\r\n                    }\r\n                }\r\n                catch (error) {\r\n                    original('rrweb logger error:', error, ...args);\r\n                }\r\n                finally {\r\n                    inStack = false;\r\n                }\r\n            };\r\n        });\r\n    }\r\n}\r\nconst PLUGIN_NAME = 'rrweb/console@1';\r\nconst getRecordConsolePlugin = (options) => ({\r\n    name: PLUGIN_NAME,\r\n    observer: initLogObserver,\r\n    options: options,\r\n});\n\nexport { PLUGIN_NAME, getRecordConsolePlugin };\n","// eslint-disable-next-line posthog-js/no-direct-array-check\nconst nativeIsArray = Array.isArray\nconst ObjProto = Object.prototype\nexport const hasOwnProperty = ObjProto.hasOwnProperty\nconst toString = ObjProto.toString\n\nexport const _isArray =\n    nativeIsArray ||\n    function (obj: any): obj is any[] {\n        return toString.call(obj) === '[object Array]'\n    }\nexport const _isUint8Array = function (x: unknown): x is Uint8Array {\n    return toString.call(x) === '[object Uint8Array]'\n}\n// from a comment on http://dbj.org/dbj/?p=286\n// fails on only one very rare and deliberate custom object:\n// let bomb = { toString : undefined, valueOf: function(o) { return \"function BOMBA!\"; }};\nexport const _isFunction = function (f: any): f is (...args: any[]) => any {\n    // eslint-disable-next-line posthog-js/no-direct-function-check\n    return typeof f === 'function'\n}\n// Underscore Addons\nexport const _isObject = function (x: unknown): x is Record<string, any> {\n    // eslint-disable-next-line posthog-js/no-direct-object-check\n    return x === Object(x) && !_isArray(x)\n}\nexport const _isEmptyObject = function (x: unknown): x is Record<string, any> {\n    if (_isObject(x)) {\n        for (const key in x) {\n            if (hasOwnProperty.call(x, key)) {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\nexport const _isUndefined = function (x: unknown): x is undefined {\n    return x === void 0\n}\n\nexport const _isString = function (x: unknown): x is string {\n    // eslint-disable-next-line posthog-js/no-direct-string-check\n    return toString.call(x) == '[object String]'\n}\n\nexport const _isEmptyString = function (x: unknown): boolean {\n    return _isString(x) && x.trim().length === 0\n}\n\nexport const _isNull = function (x: unknown): x is null {\n    // eslint-disable-next-line posthog-js/no-direct-null-check\n    return x === null\n}\n\n/*\n    sometimes you want to check if something is null or undefined\n    that's what this is for\n */\nexport const _isNullish = function (x: unknown): x is null | undefined {\n    return _isUndefined(x) || _isNull(x)\n}\n\nexport const _isDate = function (x: unknown): x is Date {\n    // eslint-disable-next-line posthog-js/no-direct-date-check\n    return toString.call(x) == '[object Date]'\n}\nexport const _isNumber = function (x: unknown): x is number {\n    // eslint-disable-next-line posthog-js/no-direct-number-check\n    return toString.call(x) == '[object Number]'\n}\nexport const _isBoolean = function (x: unknown): x is boolean {\n    // eslint-disable-next-line posthog-js/no-direct-boolean-check\n    return toString.call(x) === '[object Boolean]'\n}\n\nexport const _isDocument = (x: unknown): x is Document => {\n    // eslint-disable-next-line posthog-js/no-direct-document-check\n    return x instanceof Document\n}\n\nexport const _isFormData = (x: unknown): x is FormData => {\n    // eslint-disable-next-line posthog-js/no-direct-form-data-check\n    return x instanceof FormData\n}\n\nexport const _isFile = (x: unknown): x is File => {\n    // eslint-disable-next-line posthog-js/no-direct-file-check\n    return x instanceof File\n}\n","/*\n * Global helpers to protect access to browser globals in a way that is safer for different targets\n * like DOM, SSR, Web workers etc.\n *\n * NOTE: Typically we want the \"window\" but globalThis works for both the typical browser context as\n * well as other contexts such as the web worker context. Window is still exported for any bits that explicitly require it.\n * If in doubt - export the global you need from this file and use that as an optional value. This way the code path is forced\n * to handle the case where the global is not available.\n */\n\n// eslint-disable-next-line no-restricted-globals\nconst win: (Window & typeof globalThis) | undefined = typeof window !== 'undefined' ? window : undefined\n\nconst global: typeof globalThis | undefined = typeof globalThis !== 'undefined' ? globalThis : win\n\nexport const ArrayProto = Array.prototype\nexport const nativeForEach = ArrayProto.forEach\nexport const nativeIndexOf = ArrayProto.indexOf\n\nexport const navigator = global?.navigator\nexport const document = global?.document\nexport const location = global?.location\nexport const fetch = global?.fetch\nexport const XMLHttpRequest =\n    global?.XMLHttpRequest && 'withCredentials' in new global.XMLHttpRequest() ? global.XMLHttpRequest : undefined\nexport const AbortController = global?.AbortController\nexport const userAgent = navigator?.userAgent\nexport const assignableWindow: Window & typeof globalThis & Record<string, any> = win ?? ({} as any)\n\nexport { win as window }\n","import Config from '../config'\nimport { _isUndefined } from './type-utils'\nimport { assignableWindow, window } from './globals'\n\nconst LOGGER_PREFIX = '[PostHog.js]'\nexport const logger = {\n    _log: (level: 'log' | 'warn' | 'error', ...args: any[]) => {\n        if (\n            window &&\n            (Config.DEBUG || assignableWindow.POSTHOG_DEBUG) &&\n            !_isUndefined(window.console) &&\n            window.console\n        ) {\n            const consoleLog =\n                '__rrweb_original__' in window.console[level]\n                    ? (window.console[level] as any)['__rrweb_original__']\n                    : window.console[level]\n\n            // eslint-disable-next-line no-console\n            consoleLog(LOGGER_PREFIX, ...args)\n        }\n    },\n\n    info: (...args: any[]) => {\n        logger._log('log', ...args)\n    },\n\n    warn: (...args: any[]) => {\n        logger._log('warn', ...args)\n    },\n\n    error: (...args: any[]) => {\n        logger._log('error', ...args)\n    },\n\n    critical: (...args: any[]) => {\n        // Critical errors are always logged to the console\n        // eslint-disable-next-line no-console\n        console.error(LOGGER_PREFIX, ...args)\n    },\n\n    uninitializedWarning: (methodName: string) => {\n        logger.error(`You must initialize PostHog before calling ${methodName}`)\n    },\n}\n","import { Breaker, EventHandler, Properties } from '../types'\nimport {\n    _isArray,\n    _isDate,\n    _isFormData,\n    _isFunction,\n    _isNull,\n    _isNullish,\n    _isObject,\n    _isString,\n    hasOwnProperty,\n} from './type-utils'\nimport { logger } from './logger'\nimport { window, document, nativeForEach, nativeIndexOf } from './globals'\n\nconst breaker: Breaker = {}\n\n// UNDERSCORE\n// Embed part of the Underscore Library\nexport const _trim = function (str: string): string {\n    return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '')\n}\n\nexport const _bind_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = obj[func].bind(obj)\n        }\n    }\n}\n\nexport function _eachArray<E = any>(\n    obj: E[] | null | undefined,\n    iterator: (value: E, key: number) => void | Breaker,\n    thisArg?: any\n): void {\n    if (_isArray(obj)) {\n        if (nativeForEach && obj.forEach === nativeForEach) {\n            obj.forEach(iterator, thisArg)\n        } else if ('length' in obj && obj.length === +obj.length) {\n            for (let i = 0, l = obj.length; i < l; i++) {\n                if (i in obj && iterator.call(thisArg, obj[i], i) === breaker) {\n                    return\n                }\n            }\n        }\n    }\n}\n\n/**\n * @param {*=} obj\n * @param {function(...*)=} iterator\n * @param {Object=} thisArg\n */\nexport function _each(obj: any, iterator: (value: any, key: any) => void | Breaker, thisArg?: any): void {\n    if (_isNullish(obj)) {\n        return\n    }\n    if (_isArray(obj)) {\n        return _eachArray(obj, iterator, thisArg)\n    }\n    if (_isFormData(obj)) {\n        for (const pair of obj.entries()) {\n            if (iterator.call(thisArg, pair[1], pair[0]) === breaker) {\n                return\n            }\n        }\n        return\n    }\n    for (const key in obj) {\n        if (hasOwnProperty.call(obj, key)) {\n            if (iterator.call(thisArg, obj[key], key) === breaker) {\n                return\n            }\n        }\n    }\n}\n\nexport const _extend = function (obj: Record<string, any>, ...args: Record<string, any>[]): Record<string, any> {\n    _eachArray(args, function (source) {\n        for (const prop in source) {\n            if (source[prop] !== void 0) {\n                obj[prop] = source[prop]\n            }\n        }\n    })\n    return obj\n}\n\nexport const _include = function (\n    obj: null | string | Array<any> | Record<string, any>,\n    target: any\n): boolean | Breaker {\n    let found = false\n    if (_isNull(obj)) {\n        return found\n    }\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) {\n        return obj.indexOf(target) != -1\n    }\n    _each(obj, function (value) {\n        if (found || (found = value === target)) {\n            return breaker\n        }\n        return\n    })\n    return found\n}\n\nexport function _includes<T = any>(str: T[] | string, needle: T): boolean {\n    return (str as any).indexOf(needle) !== -1\n}\n\n/**\n * Object.entries() polyfill\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\n */\nexport function _entries<T = any>(obj: Record<string, T>): [string, T][] {\n    const ownProps = Object.keys(obj)\n    let i = ownProps.length\n    const resArray = new Array(i) // preallocate the Array\n\n    while (i--) {\n        resArray[i] = [ownProps[i], obj[ownProps[i]]]\n    }\n    return resArray\n}\n\nexport const _isValidRegex = function (str: string): boolean {\n    try {\n        new RegExp(str)\n    } catch (error) {\n        return false\n    }\n    return true\n}\n\nexport const _encodeDates = function (obj: Properties): Properties {\n    _each(obj, function (v, k) {\n        if (_isDate(v)) {\n            obj[k] = _formatDate(v)\n        } else if (_isObject(v)) {\n            obj[k] = _encodeDates(v) // recurse\n        }\n    })\n    return obj\n}\n\nexport const _timestamp = function (): number {\n    Date.now =\n        Date.now ||\n        function () {\n            return +new Date()\n        }\n    return Date.now()\n}\n\nexport const _formatDate = function (d: Date): string {\n    // YYYY-MM-DDTHH:MM:SS in UTC\n    function pad(n: number) {\n        return n < 10 ? '0' + n : n\n    }\n    return (\n        d.getUTCFullYear() +\n        '-' +\n        pad(d.getUTCMonth() + 1) +\n        '-' +\n        pad(d.getUTCDate()) +\n        'T' +\n        pad(d.getUTCHours()) +\n        ':' +\n        pad(d.getUTCMinutes()) +\n        ':' +\n        pad(d.getUTCSeconds())\n    )\n}\n\nexport const _try = function <T>(fn: () => T): T | undefined {\n    try {\n        return fn()\n    } catch (e) {\n        return undefined\n    }\n}\n\nexport const _safewrap = function <F extends (...args: any[]) => any = (...args: any[]) => any>(f: F): F {\n    return function (...args) {\n        try {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            return f.apply(this, args)\n        } catch (e) {\n            logger.critical(\n                'Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A.'\n            )\n            logger.critical(e)\n        }\n    } as F\n}\n\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport const _safewrap_class = function (klass: Function, functions: string[]): void {\n    for (let i = 0; i < functions.length; i++) {\n        klass.prototype[functions[i]] = _safewrap(klass.prototype[functions[i]])\n    }\n}\n\nexport const _safewrap_instance_methods = function (obj: Record<string, any>): void {\n    for (const func in obj) {\n        if (_isFunction(obj[func])) {\n            obj[func] = _safewrap(obj[func])\n        }\n    }\n}\n\nexport const _strip_empty_properties = function (p: Properties): Properties {\n    const ret: Properties = {}\n    _each(p, function (v, k) {\n        if (_isString(v) && v.length > 0) {\n            ret[k] = v\n        }\n    })\n    return ret\n}\n\n/**\n * Deep copies an object.\n * It handles cycles by replacing all references to them with `undefined`\n * Also supports customizing native values\n *\n * @param value\n * @param customizer\n * @returns {{}|undefined|*}\n */\nfunction deepCircularCopy<T extends Record<string, any> = Record<string, any>>(\n    value: T,\n    customizer?: <K extends keyof T = keyof T>(value: T[K], key?: K) => T[K]\n): T | undefined {\n    const COPY_IN_PROGRESS_SET = new Set()\n\n    function internalDeepCircularCopy(value: T, key?: string): T | undefined {\n        if (value !== Object(value)) return customizer ? customizer(value as any, key) : value // primitive value\n\n        if (COPY_IN_PROGRESS_SET.has(value)) return undefined\n        COPY_IN_PROGRESS_SET.add(value)\n        let result: T\n\n        if (_isArray(value)) {\n            result = [] as any as T\n            _eachArray(value, (it) => {\n                result.push(internalDeepCircularCopy(it))\n            })\n        } else {\n            result = {} as T\n            _each(value, (val, key) => {\n                if (!COPY_IN_PROGRESS_SET.has(val)) {\n                    ;(result as any)[key] = internalDeepCircularCopy(val, key)\n                }\n            })\n        }\n        return result\n    }\n    return internalDeepCircularCopy(value)\n}\n\nexport function _copyAndTruncateStrings<T extends Record<string, any> = Record<string, any>>(\n    object: T,\n    maxStringLength: number | null\n): T {\n    return deepCircularCopy(object, (value: any) => {\n        if (_isString(value) && !_isNull(maxStringLength)) {\n            return (value as string).slice(0, maxStringLength)\n        }\n        return value\n    }) as T\n}\n\nexport function _base64Encode(data: null): null\nexport function _base64Encode(data: undefined): undefined\nexport function _base64Encode(data: string): string\nexport function _base64Encode(data: string | null | undefined): string | null | undefined {\n    const b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n    let o1,\n        o2,\n        o3,\n        h1,\n        h2,\n        h3,\n        h4,\n        bits,\n        i = 0,\n        ac = 0,\n        enc = ''\n    const tmp_arr: string[] = []\n\n    if (!data) {\n        return data\n    }\n\n    data = _utf8Encode(data)\n\n    do {\n        // pack three octets into four hexets\n        o1 = data.charCodeAt(i++)\n        o2 = data.charCodeAt(i++)\n        o3 = data.charCodeAt(i++)\n\n        bits = (o1 << 16) | (o2 << 8) | o3\n\n        h1 = (bits >> 18) & 0x3f\n        h2 = (bits >> 12) & 0x3f\n        h3 = (bits >> 6) & 0x3f\n        h4 = bits & 0x3f\n\n        // use hexets to index into b64, and append result to encoded string\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4)\n    } while (i < data.length)\n\n    enc = tmp_arr.join('')\n\n    switch (data.length % 3) {\n        case 1:\n            enc = enc.slice(0, -2) + '=='\n            break\n        case 2:\n            enc = enc.slice(0, -1) + '='\n            break\n    }\n\n    return enc\n}\n\nexport const _utf8Encode = function (string: string): string {\n    string = (string + '').replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n')\n\n    let utftext = '',\n        start,\n        end\n    let stringl = 0,\n        n\n\n    start = end = 0\n    stringl = string.length\n\n    for (n = 0; n < stringl; n++) {\n        const c1 = string.charCodeAt(n)\n        let enc = null\n\n        if (c1 < 128) {\n            end++\n        } else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192, (c1 & 63) | 128)\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128)\n        }\n        if (!_isNull(enc)) {\n            if (end > start) {\n                utftext += string.substring(start, end)\n            }\n            utftext += enc\n            start = end = n + 1\n        }\n    }\n\n    if (end > start) {\n        utftext += string.substring(start, string.length)\n    }\n\n    return utftext\n}\n\nexport const _register_event = (function () {\n    // written by Dean Edwards, 2005\n    // with input from Tino Zijdel - crisp@xs4all.nl\n    // with input from Carl Sverre - mail@carlsverre.com\n    // with input from PostHog\n    // http://dean.edwards.name/weblog/2005/10/add-event/\n    // https://gist.github.com/1930440\n\n    /**\n     * @param {Object} element\n     * @param {string} type\n     * @param {function(...*)} handler\n     * @param {boolean=} oldSchool\n     * @param {boolean=} useCapture\n     */\n    const register_event = function (\n        element: Element | Window | Document | Node,\n        type: string,\n        handler: EventHandler,\n        oldSchool?: boolean,\n        useCapture?: boolean\n    ) {\n        if (!element) {\n            logger.error('No valid element provided to register_event')\n            return\n        }\n\n        if (element.addEventListener && !oldSchool) {\n            element.addEventListener(type, handler, !!useCapture)\n        } else {\n            const ontype = 'on' + type\n            const old_handler = (element as any)[ontype] // can be undefined\n            ;(element as any)[ontype] = makeHandler(element, handler, old_handler)\n        }\n    }\n\n    function makeHandler(\n        element: Element | Window | Document | Node,\n        new_handler: EventHandler,\n        old_handlers: EventHandler\n    ) {\n        return function (event: Event): boolean | void {\n            event = event || fixEvent(window?.event)\n\n            // this basically happens in firefox whenever another script\n            // overwrites the onload callback and doesn't pass the event\n            // object to previously defined callbacks.  All the browsers\n            // that don't define window.event implement addEventListener\n            // so the dom_loaded handler will still be fired as usual.\n            if (!event) {\n                return undefined\n            }\n\n            let ret = true\n            let old_result: any\n\n            if (_isFunction(old_handlers)) {\n                old_result = old_handlers(event)\n            }\n            const new_result = new_handler.call(element, event)\n\n            if (false === old_result || false === new_result) {\n                ret = false\n            }\n\n            return ret\n        }\n    }\n\n    function fixEvent(event: Event | undefined): Event | undefined {\n        if (event) {\n            event.preventDefault = fixEvent.preventDefault\n            event.stopPropagation = fixEvent.stopPropagation\n        }\n        return event\n    }\n    fixEvent.preventDefault = function () {\n        ;(this as any as Event).returnValue = false\n    }\n    fixEvent.stopPropagation = function () {\n        ;(this as any as Event).cancelBubble = true\n    }\n\n    return register_event\n})()\n\nexport function loadScript(scriptUrlToLoad: string, callback: (error?: string | Event, event?: Event) => void): void {\n    const addScript = () => {\n        if (!document) {\n            return callback('document not found')\n        }\n        const scriptTag = document.createElement('script')\n        scriptTag.type = 'text/javascript'\n        scriptTag.src = scriptUrlToLoad\n        scriptTag.onload = (event) => callback(undefined, event)\n        scriptTag.onerror = (error) => callback(error)\n\n        const scripts = document.querySelectorAll('body > script')\n        if (scripts.length > 0) {\n            scripts[0].parentNode?.insertBefore(scriptTag, scripts[0])\n        } else {\n            // In exceptional situations this call might load before the DOM is fully ready.\n            document.body.appendChild(scriptTag)\n        }\n    }\n\n    if (document?.body) {\n        addScript()\n    } else {\n        document?.addEventListener('DOMContentLoaded', addScript)\n    }\n}\n\nexport function isCrossDomainCookie(documentLocation: Location | undefined) {\n    const hostname = documentLocation?.hostname\n\n    if (!_isString(hostname)) {\n        return false\n    }\n    // split and slice isn't a great way to match arbitrary domains,\n    // but it's good enough for ensuring we only match herokuapp.com when it is the TLD\n    // for the hostname\n    return hostname.split('.').slice(-2).join('.') !== 'herokuapp.com'\n}\n\nexport function isDistinctIdStringLike(value: string): boolean {\n    return ['distinct_id', 'distinctid'].includes(value.toLowerCase())\n}\n","import { _each, _isValidRegex } from './'\n\nimport { _isArray, _isFile, _isUndefined } from './type-utils'\nimport { logger } from './logger'\nimport { document } from './globals'\n\nconst localDomains = ['localhost', '127.0.0.1']\n\n/**\n * IE11 doesn't support `new URL`\n * so we can create an anchor element and use that to parse the URL\n * there's a lot of overlap between HTMLHyperlinkElementUtils and URL\n * meaning useful properties like `pathname` are available on both\n */\nexport const convertToURL = (url: string): HTMLAnchorElement | null => {\n    const location = document?.createElement('a')\n    if (_isUndefined(location)) {\n        return null\n    }\n\n    location.href = url\n    return location\n}\n\nexport const _isUrlMatchingRegex = function (url: string, pattern: string): boolean {\n    if (!_isValidRegex(pattern)) return false\n    return new RegExp(pattern).test(url)\n}\n\nexport const _formDataToQuery = function (formdata: Record<string, any> | FormData, arg_separator = '&'): string {\n    let use_val: string\n    let use_key: string\n    const tph_arr: string[] = []\n\n    _each(formdata, function (val: File | string | undefined, key: string | undefined) {\n        // the key might be literally the string undefined for e.g. if {undefined: 'something'}\n        if (_isUndefined(val) || _isUndefined(key) || key === 'undefined') {\n            return\n        }\n\n        use_val = encodeURIComponent(_isFile(val) ? val.name : val.toString())\n        use_key = encodeURIComponent(key)\n        tph_arr[tph_arr.length] = use_key + '=' + use_val\n    })\n\n    return tph_arr.join(arg_separator)\n}\n\nexport const _getQueryParam = function (url: string, param: string): string {\n    const withoutHash: string = url.split('#')[0] || ''\n    const queryParams: string = withoutHash.split('?')[1] || ''\n\n    const queryParts = queryParams.split('&')\n    let keyValuePair\n\n    for (let i = 0; i < queryParts.length; i++) {\n        const parts = queryParts[i].split('=')\n        if (parts[0] === param) {\n            keyValuePair = parts\n            break\n        }\n    }\n\n    if (!_isArray(keyValuePair) || keyValuePair.length < 2) {\n        return ''\n    } else {\n        let result = keyValuePair[1]\n        try {\n            result = decodeURIComponent(result)\n        } catch (err) {\n            logger.error('Skipping decoding for malformed query param: ' + result)\n        }\n        return result.replace(/\\+/g, ' ')\n    }\n}\n\nexport const _getHashParam = function (hash: string, param: string): string | null {\n    const matches = hash.match(new RegExp(param + '=([^&]*)'))\n    return matches ? matches[1] : null\n}\n\nexport const isLocalhost = (): boolean => {\n    return localDomains.includes(location.hostname)\n}\n","import { CapturedNetworkRequest, NetworkRecordOptions, PostHogConfig } from '../../types'\nimport { _isFunction, _isNullish, _isString, _isUndefined } from '../../utils/type-utils'\nimport { convertToURL } from '../../utils/request-utils'\nimport { logger } from '../../utils/logger'\nimport { shouldCaptureValue } from '../../autocapture-utils'\nimport { _each } from '../../utils'\n\nconst LOGGER_PREFIX = '[SessionRecording]'\n\nexport const defaultNetworkOptions: NetworkRecordOptions = {\n    initiatorTypes: [\n        'audio',\n        'beacon',\n        'body',\n        'css',\n        'early-hint',\n        'embed',\n        'fetch',\n        'frame',\n        'iframe',\n        'icon',\n        'image',\n        'img',\n        'input',\n        'link',\n        'navigation',\n        'object',\n        'ping',\n        'script',\n        'track',\n        'video',\n        'xmlhttprequest',\n    ],\n    maskRequestFn: (data: CapturedNetworkRequest) => data,\n    recordHeaders: false,\n    recordBody: false,\n    recordInitialRequests: false,\n    recordPerformance: false,\n    performanceEntryTypeToObserve: [\n        // 'event', // This is too noisy as it covers all browser events\n        'first-input',\n        // 'mark', // Mark is used too liberally. We would need to filter for specific marks\n        // 'measure', // Measure is used too liberally. We would need to filter for specific measures\n        'navigation',\n        'paint',\n        'resource',\n    ],\n    payloadSizeLimitBytes: 1000000,\n}\n\nconst HEADER_DENY_LIST = [\n    'authorization',\n    'x-forwarded-for',\n    'authorization',\n    'cookie',\n    'set-cookie',\n    'x-api-key',\n    'x-real-ip',\n    'remote-addr',\n    'forwarded',\n    'proxy-authorization',\n    'x-csrf-token',\n    'x-csrftoken',\n    'x-xsrf-token',\n]\n\nconst PAYLOAD_CONTENT_DENY_LIST = [\n    'password',\n    'secret',\n    'passwd',\n    'api_key',\n    'apikey',\n    'auth',\n    'credentials',\n    'mysql_pwd',\n    'privatekey',\n    'private_key',\n    'token',\n]\n\n// we always remove headers on the deny list because we never want to capture this sensitive data\nconst removeAuthorizationHeader = (data: CapturedNetworkRequest): CapturedNetworkRequest => {\n    _each(Object.keys(data.requestHeaders ?? {}), (header) => {\n        if (HEADER_DENY_LIST.includes(header.toLowerCase())) delete data.requestHeaders?.[header]\n    })\n    return data\n}\n\nconst POSTHOG_PATHS_TO_IGNORE = ['/s/', '/e/', '/i/']\n// want to ignore posthog paths when capturing requests, or we can get trapped in a loop\n// because calls to PostHog would be reported using a call to PostHog which would be reported....\nconst ignorePostHogPaths = (data: CapturedNetworkRequest): CapturedNetworkRequest | undefined => {\n    const url = convertToURL(data.name)\n    if (url && url.pathname && POSTHOG_PATHS_TO_IGNORE.some((path) => url.pathname.indexOf(path) === 0)) {\n        return undefined\n    }\n    return data\n}\n\nfunction estimateBytes(payload: string): number {\n    return new Blob([payload]).size\n}\n\nfunction enforcePayloadSizeLimit(\n    payload: string | null | undefined,\n    headers: Record<string, any> | undefined,\n    limit: number,\n    description: string\n): string | null | undefined {\n    if (_isNullish(payload)) {\n        return payload\n    }\n\n    let requestContentLength: string | number = headers?.['content-length'] || estimateBytes(payload)\n    if (_isString(requestContentLength)) {\n        requestContentLength = parseInt(requestContentLength)\n    }\n\n    if (requestContentLength > limit) {\n        return LOGGER_PREFIX + ` ${description} body too large to record (${requestContentLength} bytes)`\n    }\n\n    return payload\n}\n\n// people can have arbitrarily large payloads on their site, but we don't want to ingest them\nconst limitPayloadSize = (\n    options: NetworkRecordOptions\n): ((data: CapturedNetworkRequest | undefined) => CapturedNetworkRequest | undefined) => {\n    // the smallest of 1MB or the specified limit if there is one\n    const limit = Math.min(1000000, options.payloadSizeLimitBytes ?? 1000000)\n\n    return (data) => {\n        if (data?.requestBody) {\n            data.requestBody = enforcePayloadSizeLimit(data.requestBody, data.requestHeaders, limit, 'Request')\n        }\n\n        if (data?.responseBody) {\n            data.responseBody = enforcePayloadSizeLimit(data.responseBody, data.responseHeaders, limit, 'Response')\n        }\n\n        return data\n    }\n}\n\nfunction scrubPayload(payload: string | null | undefined, label: 'Request' | 'Response'): string | null | undefined {\n    if (_isNullish(payload)) {\n        return payload\n    }\n    let scrubbed = payload\n\n    if (!shouldCaptureValue(scrubbed, false)) {\n        scrubbed = LOGGER_PREFIX + ' ' + label + ' body redacted'\n    }\n    _each(PAYLOAD_CONTENT_DENY_LIST, (text) => {\n        if (scrubbed?.length && scrubbed?.indexOf(text) !== -1) {\n            scrubbed = LOGGER_PREFIX + ' ' + label + ' body redacted as might contain: ' + text\n        }\n    })\n\n    return scrubbed\n}\n\nfunction scrubPayloads(capturedRequest: CapturedNetworkRequest | undefined): CapturedNetworkRequest | undefined {\n    if (_isUndefined(capturedRequest)) {\n        return undefined\n    }\n\n    capturedRequest.requestBody = scrubPayload(capturedRequest.requestBody, 'Request')\n    capturedRequest.responseBody = scrubPayload(capturedRequest.responseBody, 'Response')\n\n    return capturedRequest\n}\n\n/**\n *  whether a maskRequestFn is provided or not,\n *  we ensure that we remove the denied header from requests\n *  we _never_ want to record that header by accident\n *  if someone complains then we'll add an opt-in to let them override it\n */\nexport const buildNetworkRequestOptions = (\n    instanceConfig: PostHogConfig,\n    remoteNetworkOptions: Pick<NetworkRecordOptions, 'recordHeaders' | 'recordBody' | 'recordPerformance'>\n): NetworkRecordOptions => {\n    const config: NetworkRecordOptions = {\n        payloadSizeLimitBytes: defaultNetworkOptions.payloadSizeLimitBytes,\n        performanceEntryTypeToObserve: [...defaultNetworkOptions.performanceEntryTypeToObserve],\n    }\n    // client can always disable despite remote options\n    const canRecordHeaders =\n        instanceConfig.session_recording.recordHeaders === false ? false : remoteNetworkOptions.recordHeaders\n    const canRecordBody =\n        instanceConfig.session_recording.recordBody === false ? false : remoteNetworkOptions.recordBody\n    const canRecordPerformance =\n        instanceConfig.capture_performance === false ? false : remoteNetworkOptions.recordPerformance\n\n    const payloadLimiter = limitPayloadSize(config)\n\n    const enforcedCleaningFn: NetworkRecordOptions['maskRequestFn'] = (d: CapturedNetworkRequest) =>\n        payloadLimiter(ignorePostHogPaths(removeAuthorizationHeader(d)))\n\n    const hasDeprecatedMaskFunction = _isFunction(instanceConfig.session_recording.maskNetworkRequestFn)\n\n    if (hasDeprecatedMaskFunction && _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)) {\n        logger.warn(\n            'Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored.'\n        )\n    }\n\n    if (hasDeprecatedMaskFunction) {\n        instanceConfig.session_recording.maskCapturedNetworkRequestFn = (data: CapturedNetworkRequest) => {\n            const cleanedURL = instanceConfig.session_recording.maskNetworkRequestFn!({ url: data.name })\n            return {\n                ...data,\n                name: cleanedURL?.url,\n            } as CapturedNetworkRequest\n        }\n    }\n\n    config.maskRequestFn = _isFunction(instanceConfig.session_recording.maskCapturedNetworkRequestFn)\n        ? (data) => {\n              const cleanedRequest = enforcedCleaningFn(data)\n              return cleanedRequest\n                  ? instanceConfig.session_recording.maskCapturedNetworkRequestFn?.(cleanedRequest) ?? undefined\n                  : undefined\n          }\n        : (data) => scrubPayloads(enforcedCleaningFn(data))\n\n    return {\n        ...defaultNetworkOptions,\n        ...config,\n        recordHeaders: canRecordHeaders,\n        recordBody: canRecordBody,\n        recordPerformance: canRecordPerformance,\n        recordInitialRequests: canRecordPerformance,\n    }\n}\n","import { version } from 'rrweb/package.json'\n\n// Same as loader-globals.ts except includes rrweb2 scripts.\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport rrwebRecord from 'rrweb/es/rrweb/packages/rrweb/src/record'\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { getRecordConsolePlugin } from 'rrweb/es/rrweb/packages/rrweb/src/plugins/console/record'\n\n// rrweb/network@1 code starts\n// most of what is below here will be removed when rrweb release their code for this\n// see https://github.com/rrweb-io/rrweb/pull/1105\n/// <reference lib=\"dom\" />\n// NB adopted from https://github.com/rrweb-io/rrweb/pull/1105 which looks like it will be accepted into rrweb\n// however, in the PR, it throws when the performance observer data is not available\n// and assumes it is running in a browser with the Request API (i.e. not IE11)\n// copying here so that we can use it before rrweb adopt it\nimport type { IWindow, listenerHandler, RecordPlugin } from '@rrweb/types'\nimport { CapturedNetworkRequest, Headers, InitiatorType, NetworkRecordOptions } from './types'\nimport {\n    _isArray,\n    _isBoolean,\n    _isDocument,\n    _isFormData,\n    _isFunction,\n    _isNull,\n    _isNullish,\n    _isObject,\n    _isString,\n    _isUndefined,\n} from './utils/type-utils'\nimport { logger } from './utils/logger'\nimport { window } from './utils/globals'\nimport { defaultNetworkOptions } from './extensions/replay/config'\nimport { _formDataToQuery } from './utils/request-utils'\n\nexport type NetworkData = {\n    requests: CapturedNetworkRequest[]\n    isInitial?: boolean\n}\n\ntype networkCallback = (data: NetworkData) => void\n\nconst isNavigationTiming = (entry: PerformanceEntry): entry is PerformanceNavigationTiming =>\n    entry.entryType === 'navigation'\nconst isResourceTiming = (entry: PerformanceEntry): entry is PerformanceResourceTiming => entry.entryType === 'resource'\n\ntype ObservedPerformanceEntry = (PerformanceNavigationTiming | PerformanceResourceTiming) & {\n    responseStatus?: number\n}\n\n// import { patch } from 'rrweb/typings/utils'\n// copied from https://github.com/rrweb-io/rrweb/blob/8aea5b00a4dfe5a6f59bd2ae72bb624f45e51e81/packages/rrweb/src/utils.ts#L129\n// which was copied from https://github.com/getsentry/sentry-javascript/blob/b2109071975af8bf0316d3b5b38f519bdaf5dc15/packages/utils/src/object.ts\nexport function patch(\n    source: { [key: string]: any },\n    name: string,\n    replacement: (...args: unknown[]) => unknown\n): () => void {\n    try {\n        if (!(name in source)) {\n            return () => {\n                //\n            }\n        }\n\n        const original = source[name] as () => unknown\n        const wrapped = replacement(original)\n\n        // Make sure it's a function first, as we need to attach an empty prototype for `defineProperties` to work\n        // otherwise it'll throw \"TypeError: Object.defineProperties called on non-object\"\n        if (_isFunction(wrapped)) {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            wrapped.prototype = wrapped.prototype || {}\n            Object.defineProperties(wrapped, {\n                __rrweb_original__: {\n                    enumerable: false,\n                    value: original,\n                },\n                __posthog_wrapped__: {\n                    enumerable: false,\n                    value: true,\n                },\n            })\n        }\n\n        source[name] = wrapped\n\n        return () => {\n            source[name] = original\n        }\n    } catch {\n        return () => {\n            //\n        }\n        // This can throw if multiple fill happens on a global object like XMLHttpRequest\n        // Fixes https://github.com/getsentry/sentry-javascript/issues/2043\n    }\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T) => boolean): T | undefined {\n    const length = array.length\n    for (let i = length - 1; i >= 0; i -= 1) {\n        if (predicate(array[i])) {\n            return array[i]\n        }\n    }\n    return undefined\n}\n\nfunction initPerformanceObserver(cb: networkCallback, win: IWindow, options: Required<NetworkRecordOptions>) {\n    // if we are only observing timings then we could have a single observer for all types, with buffer true,\n    // but we are going to filter by initiatorType _if we are wrapping fetch and xhr as the wrapped functions\n    // will deal with those.\n    // so we have a block which captures requests from before fetch/xhr is wrapped\n    // these are marked `isInitial` so playback can display them differently if needed\n    // they will never have method/status/headers/body because they are pre-wrapping that provides that\n    if (options.recordInitialRequests) {\n        const initialPerformanceEntries = win.performance\n            .getEntries()\n            .filter(\n                (entry): entry is ObservedPerformanceEntry =>\n                    isNavigationTiming(entry) ||\n                    (isResourceTiming(entry) && options.initiatorTypes.includes(entry.initiatorType as InitiatorType))\n            )\n        cb({\n            requests: initialPerformanceEntries.flatMap((entry) =>\n                prepareRequest(entry, undefined, undefined, {}, true)\n            ),\n            isInitial: true,\n        })\n    }\n    const observer = new win.PerformanceObserver((entries) => {\n        // if recordBody or recordHeaders is true then we don't want to record fetch or xhr here\n        // as the wrapped functions will do that. Otherwise, this filter becomes a noop\n        // because we do want to record them here\n        const wrappedInitiatorFilter = (entry: ObservedPerformanceEntry) =>\n            options.recordBody || options.recordHeaders\n                ? entry.initiatorType !== 'xmlhttprequest' && entry.initiatorType !== 'fetch'\n                : true\n\n        const performanceEntries = entries.getEntries().filter(\n            (entry): entry is ObservedPerformanceEntry =>\n                isNavigationTiming(entry) ||\n                (isResourceTiming(entry) &&\n                    options.initiatorTypes.includes(entry.initiatorType as InitiatorType) &&\n                    // TODO if we are _only_ capturing timing we don't want to filter initiator here\n                    wrappedInitiatorFilter(entry))\n        )\n\n        cb({\n            requests: performanceEntries.flatMap((entry) => prepareRequest(entry, undefined, undefined, {})),\n        })\n    })\n    // compat checked earlier\n    // eslint-disable-next-line compat/compat\n    const entryTypes = PerformanceObserver.supportedEntryTypes.filter((x) =>\n        options.performanceEntryTypeToObserve.includes(x)\n    )\n    // initial records are gathered above, so we don't need to observe and buffer each type separately\n    observer.observe({ entryTypes })\n    return () => {\n        observer.disconnect()\n    }\n}\n\nfunction shouldRecordHeaders(type: 'request' | 'response', recordHeaders: NetworkRecordOptions['recordHeaders']) {\n    return !!recordHeaders && (_isBoolean(recordHeaders) || recordHeaders[type])\n}\n\nfunction shouldRecordBody(\n    type: 'request' | 'response',\n    recordBody: NetworkRecordOptions['recordBody'],\n    headers: Headers\n) {\n    function matchesContentType(contentTypes: string[]) {\n        const contentTypeHeader = Object.keys(headers).find((key) => key.toLowerCase() === 'content-type')\n        const contentType = contentTypeHeader && headers[contentTypeHeader]\n        return contentTypes.some((ct) => contentType?.includes(ct))\n    }\n\n    if (!recordBody) return false\n    if (_isBoolean(recordBody)) return true\n    if (_isArray(recordBody)) return matchesContentType(recordBody)\n    const recordBodyType = recordBody[type]\n    if (_isBoolean(recordBodyType)) return recordBodyType\n    return matchesContentType(recordBodyType)\n}\n\nasync function getRequestPerformanceEntry(\n    win: IWindow,\n    initiatorType: string,\n    url: string,\n    after?: number,\n    before?: number,\n    attempt = 0\n): Promise<PerformanceResourceTiming | null> {\n    if (attempt > 10) {\n        logger.warn('Failed to get performance entry for request', { url, initiatorType })\n        return null\n    }\n    const urlPerformanceEntries = win.performance.getEntriesByName(url) as PerformanceResourceTiming[]\n    const performanceEntry = findLast(\n        urlPerformanceEntries,\n        (entry) =>\n            isResourceTiming(entry) &&\n            entry.initiatorType === initiatorType &&\n            (!after || entry.startTime >= after) &&\n            (!before || entry.startTime <= before)\n    )\n    if (!performanceEntry) {\n        await new Promise((resolve) => setTimeout(resolve, 50 * attempt))\n        return getRequestPerformanceEntry(win, initiatorType, url, after, before, attempt + 1)\n    }\n    return performanceEntry\n}\n\n/**\n * According to MDN https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/response\n * xhr response is typed as any but can be an ArrayBuffer, a Blob, a Document, a JavaScript object,\n * or a string, depending on the value of XMLHttpRequest.responseType, that contains the response entity body.\n *\n * XHR request body is Document | XMLHttpRequestBodyInit | null | undefined\n */\nfunction _tryReadXHRBody(body: Document | XMLHttpRequestBodyInit | any | null | undefined): string | null {\n    if (_isNullish(body)) {\n        return null\n    }\n\n    if (_isString(body)) {\n        return body\n    }\n\n    if (_isDocument(body)) {\n        return body.textContent\n    }\n\n    if (_isFormData(body)) {\n        return _formDataToQuery(body)\n    }\n\n    if (_isObject(body)) {\n        try {\n            return JSON.stringify(body)\n        } catch (e) {\n            return '[SessionReplay] Failed to stringify response object'\n        }\n    }\n\n    return '[SessionReplay] Cannot read body of type ' + toString.call(body)\n}\n\nfunction initXhrObserver(cb: networkCallback, win: IWindow, options: Required<NetworkRecordOptions>): listenerHandler {\n    if (!options.initiatorTypes.includes('xmlhttprequest')) {\n        return () => {\n            //\n        }\n    }\n    const recordRequestHeaders = shouldRecordHeaders('request', options.recordHeaders)\n    const recordResponseHeaders = shouldRecordHeaders('response', options.recordHeaders)\n\n    const restorePatch = patch(\n        win.XMLHttpRequest.prototype,\n        'open',\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        (originalOpen: typeof XMLHttpRequest.prototype.open) => {\n            return function (\n                method: string,\n                url: string | URL,\n                async = true,\n                username?: string | null,\n                password?: string | null\n            ) {\n                // because this function is returned in its actual context `this` _is_ an XMLHttpRequest\n                // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n                // @ts-ignore\n                const xhr = this as XMLHttpRequest\n\n                // check IE earlier than this, we only initialize if Request is present\n                // eslint-disable-next-line compat/compat\n                const req = new Request(url)\n                const networkRequest: Partial<CapturedNetworkRequest> = {}\n                let after: number | undefined\n                let before: number | undefined\n\n                const requestHeaders: Headers = {}\n                const originalSetRequestHeader = xhr.setRequestHeader.bind(xhr)\n                xhr.setRequestHeader = (header: string, value: string) => {\n                    requestHeaders[header] = value\n                    return originalSetRequestHeader(header, value)\n                }\n                if (recordRequestHeaders) {\n                    networkRequest.requestHeaders = requestHeaders\n                }\n\n                const originalSend = xhr.send.bind(xhr)\n                xhr.send = (body) => {\n                    if (shouldRecordBody('request', options.recordBody, requestHeaders)) {\n                        if (_isUndefined(body) || _isNull(body)) {\n                            networkRequest.requestBody = null\n                        } else {\n                            networkRequest.requestBody = _tryReadXHRBody(body)\n                        }\n                    }\n                    after = win.performance.now()\n                    return originalSend(body)\n                }\n\n                xhr.addEventListener('readystatechange', () => {\n                    if (xhr.readyState !== xhr.DONE) {\n                        return\n                    }\n                    before = win.performance.now()\n                    const responseHeaders: Headers = {}\n                    const rawHeaders = xhr.getAllResponseHeaders()\n                    const headers = rawHeaders.trim().split(/[\\r\\n]+/)\n                    headers.forEach((line) => {\n                        const parts = line.split(': ')\n                        const header = parts.shift()\n                        const value = parts.join(': ')\n                        if (header) {\n                            responseHeaders[header] = value\n                        }\n                    })\n                    if (recordResponseHeaders) {\n                        networkRequest.responseHeaders = responseHeaders\n                    }\n                    if (shouldRecordBody('response', options.recordBody, responseHeaders)) {\n                        if (_isNullish(xhr.response)) {\n                            networkRequest.responseBody = null\n                        } else {\n                            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n                            networkRequest.responseBody = _tryReadXHRBody(xhr.response)\n                        }\n                    }\n                    getRequestPerformanceEntry(win, 'xmlhttprequest', req.url, after, before)\n                        .then((entry) => {\n                            if (_isNull(entry)) {\n                                return\n                            }\n                            const requests = prepareRequest(entry, req.method, xhr?.status, networkRequest)\n                            cb({ requests })\n                        })\n                        .catch(() => {\n                            //\n                        })\n                })\n                originalOpen.call(xhr, method, url, async, username, password)\n            }\n        }\n    )\n    return () => {\n        restorePatch()\n    }\n}\n\n/**\n *  Check if this PerformanceEntry is either a PerformanceResourceTiming or a PerformanceNavigationTiming\n *  NB PerformanceNavigationTiming extends PerformanceResourceTiming\n *  Here we don't care which interface it implements as both expose `serverTimings`\n */\nconst exposesServerTiming = (event: PerformanceEntry): event is PerformanceResourceTiming =>\n    event.entryType === 'navigation' || event.entryType === 'resource'\n\nfunction prepareRequest(\n    entry: PerformanceResourceTiming,\n    method: string | undefined,\n    status: number | undefined,\n    networkRequest: Partial<CapturedNetworkRequest>,\n    isInitial?: boolean\n): CapturedNetworkRequest[] {\n    // kudos to sentry javascript sdk for excellent background on why to use Date.now() here\n    // https://github.com/getsentry/sentry-javascript/blob/e856e40b6e71a73252e788cd42b5260f81c9c88e/packages/utils/src/time.ts#L70\n    // can't start observer if performance.now() is not available\n    // eslint-disable-next-line compat/compat\n    const timeOrigin = Math.floor(Date.now() - performance.now())\n    // clickhouse can't ingest timestamps that are floats\n    // (in this case representing fractions of a millisecond we don't care about anyway)\n    const timestamp = Math.floor(timeOrigin + entry.startTime)\n\n    const requests: CapturedNetworkRequest[] = [\n        {\n            ...entry.toJSON(),\n            startTime: Math.round(entry.startTime),\n            endTime: Math.round(entry.responseEnd),\n            timeOrigin,\n            timestamp,\n            method: method,\n            initiatorType: entry.initiatorType as InitiatorType,\n            status,\n            requestHeaders: networkRequest.requestHeaders,\n            requestBody: networkRequest.requestBody,\n            responseHeaders: networkRequest.responseHeaders,\n            responseBody: networkRequest.responseBody,\n            isInitial,\n        },\n    ]\n\n    if (exposesServerTiming(entry)) {\n        for (const timing of entry.serverTiming || []) {\n            requests.push({\n                timeOrigin,\n                timestamp,\n                startTime: Math.round(entry.startTime),\n                name: timing.name,\n                duration: timing.duration,\n                // the spec has a closed list of possible types\n                // https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry/entryType\n                // but, we need to know this was a server timing so that we know to\n                // match it to the appropriate navigation or resource timing\n                // that matching will have to be on timestamp and $current_url\n                entryType: 'serverTiming',\n            })\n        }\n    }\n\n    return requests\n}\n\nconst contentTypePrefixDenyList = ['video/', 'audio/']\n\nfunction _checkForCannotReadResponseBody(r: Response): string | null {\n    if (r.headers.get('Transfer-Encoding') === 'chunked') {\n        return 'Chunked Transfer-Encoding is not supported'\n    }\n\n    // `get` and `has` are case-insensitive\n    // but return the header value with the casing that was supplied\n    const contentType = r.headers.get('Content-Type')?.toLowerCase()\n    const contentTypeIsDenied = contentTypePrefixDenyList.some((prefix) => contentType?.startsWith(prefix))\n    if (contentType && contentTypeIsDenied) {\n        return `Content-Type ${contentType} is not supported`\n    }\n\n    return null\n}\n\nfunction _tryReadBody(r: Request | Response): Promise<string> {\n    // there are now already multiple places where we're using Promise...\n    // eslint-disable-next-line compat/compat\n    return new Promise((resolve, reject) => {\n        const timeout = setTimeout(() => resolve('[SessionReplay] Timeout while trying to read body'), 500)\n        r.clone()\n            .text()\n            .then(\n                (txt) => resolve(txt),\n                (reason) => reject(reason)\n            )\n            .finally(() => clearTimeout(timeout))\n    })\n}\n\nasync function _tryReadResponseBody(r: Response): Promise<string> {\n    const cannotReadBodyReason: string | null = _checkForCannotReadResponseBody(r)\n    if (!_isNull(cannotReadBodyReason)) {\n        return Promise.resolve(cannotReadBodyReason)\n    }\n\n    return _tryReadBody(r)\n}\n\nfunction initFetchObserver(\n    cb: networkCallback,\n    win: IWindow,\n    options: Required<NetworkRecordOptions>\n): listenerHandler {\n    if (!options.initiatorTypes.includes('fetch')) {\n        return () => {\n            //\n        }\n    }\n    const recordRequestHeaders = shouldRecordHeaders('request', options.recordHeaders)\n    const recordResponseHeaders = shouldRecordHeaders('response', options.recordHeaders)\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const restorePatch = patch(win, 'fetch', (originalFetch: typeof fetch) => {\n        return async function (url: URL | RequestInfo, init?: RequestInit | undefined) {\n            // check IE earlier than this, we only initialize if Request is present\n            // eslint-disable-next-line compat/compat\n            const req = new Request(url, init)\n            let res: Response | undefined\n            const networkRequest: Partial<CapturedNetworkRequest> = {}\n            let after: number | undefined\n            let before: number | undefined\n            try {\n                const requestHeaders: Headers = {}\n                req.headers.forEach((value, header) => {\n                    requestHeaders[header] = value\n                })\n                if (recordRequestHeaders) {\n                    networkRequest.requestHeaders = requestHeaders\n                }\n                if (shouldRecordBody('request', options.recordBody, requestHeaders)) {\n                    networkRequest.requestBody = await _tryReadBody(req)\n                }\n\n                after = win.performance.now()\n                res = await originalFetch(req)\n                before = win.performance.now()\n\n                const responseHeaders: Headers = {}\n                res.headers.forEach((value, header) => {\n                    responseHeaders[header] = value\n                })\n                if (recordResponseHeaders) {\n                    networkRequest.responseHeaders = responseHeaders\n                }\n                if (shouldRecordBody('response', options.recordBody, responseHeaders)) {\n                    networkRequest.responseBody = await _tryReadResponseBody(res)\n                }\n\n                return res\n            } finally {\n                getRequestPerformanceEntry(win, 'fetch', req.url, after, before)\n                    .then((entry) => {\n                        if (_isNull(entry)) {\n                            return\n                        }\n                        const requests = prepareRequest(entry, req.method, res?.status, networkRequest)\n                        cb({ requests })\n                    })\n                    .catch(() => {\n                        //\n                    })\n            }\n        }\n    })\n    return () => {\n        restorePatch()\n    }\n}\n\nfunction initNetworkObserver(\n    callback: networkCallback,\n    win: IWindow, // top window or in an iframe\n    options: NetworkRecordOptions\n): listenerHandler {\n    if (!('performance' in win)) {\n        return () => {\n            //\n        }\n    }\n    const networkOptions = (\n        options ? Object.assign({}, defaultNetworkOptions, options) : defaultNetworkOptions\n    ) as Required<NetworkRecordOptions>\n\n    const cb: networkCallback = (data) => {\n        const requests: CapturedNetworkRequest[] = []\n        data.requests.forEach((request) => {\n            const maskedRequest = networkOptions.maskRequestFn(request)\n            if (maskedRequest) {\n                requests.push(maskedRequest)\n            }\n        })\n\n        if (requests.length > 0) {\n            callback({ ...data, requests })\n        }\n    }\n    const performanceObserver = initPerformanceObserver(cb, win, networkOptions)\n\n    // only wrap fetch and xhr if headers or body are being recorded\n    let xhrObserver: listenerHandler = () => {}\n    let fetchObserver: listenerHandler = () => {}\n    if (networkOptions.recordHeaders || networkOptions.recordBody) {\n        xhrObserver = initXhrObserver(cb, win, networkOptions)\n        fetchObserver = initFetchObserver(cb, win, networkOptions)\n    }\n\n    return () => {\n        performanceObserver()\n        xhrObserver()\n        fetchObserver()\n    }\n}\n\n// use the plugin name so that when this functionality is adopted into rrweb\n// we can remove this plugin and use the core functionality with the same data\nexport const NETWORK_PLUGIN_NAME = 'rrweb/network@1'\n\n// TODO how should this be typed?\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nexport const getRecordNetworkPlugin: (options?: NetworkRecordOptions) => RecordPlugin = (options) => {\n    return {\n        name: NETWORK_PLUGIN_NAME,\n        observer: initNetworkObserver,\n        options: options,\n    }\n}\n\n// rrweb/networ@1 ends\n\nif (window) {\n    ;(window as any).rrweb = { record: rrwebRecord, version: 'v2', rrwebVersion: version }\n    ;(window as any).rrwebConsoleRecord = { getRecordConsolePlugin }\n    ;(window as any).getRecordNetworkPlugin = getRecordNetworkPlugin\n}\n\nexport default rrwebRecord\n"],"names":["NodeType","isShadowRoot","n","host","Boolean","shadowRoot","isNativeShadowDom","Object","prototype","toString","call","stringifyStylesheet","s","rules","cssRules","cssText","Array","from","map","stringifyRule","join","includes","replace","error","rule","importStringified","isCSSImportRule","styleSheet","split","length","statement","concat","JSON","stringify","href","layerName","push","supportsText","media","mediaText","escapeImportStatement","cssStringified","regex","validateStringifiedCssRule","Mirror","this","idNodeMap","Map","nodeMetaMap","WeakMap","getId","_a","id","getMeta","getNode","get","getIds","keys","removeNodeFromMap","_this","childNodes","forEach","childNode","has","hasNode","node","add","meta","set","oldNode","reset","maskInputValue","element","maskInputOptions","tagName","type","value","maskInputFn","text","actualType","toLowerCase","repeat","str","ORIGINAL_ATTRIBUTE_NAME","getInputType","hasAttribute","canvasService","canvasCtx","_id","tagNameRegex","RegExp","IGNORED_NODE","genId","URL_IN_CSS_REF","URL_PROTOCOL_MATCH","URL_WWW_MATCH","DATA_URI","absoluteToStylesheet","origin","quote1","path1","quote2","path2","path3","url","filePath","maybeQuote","test","indexOf","slice","stack","parts","pop","_i","parts_1","part","SRCSET_NOT_SPACES","SRCSET_COMMAS_OR_SPACES","absoluteToDoc","doc","attributeValue","trim","a","createElement","isSVGElement","el","ownerSVGElement","getHref","document","transformAttribute","name","pos","collectCharacters","regEx","chars","match","exec","substring","output","descriptorsStr","inParens","c","charAt","getAbsoluteSrcsetString","ignoreAttribute","_value","classMatchesRegex","checkAncestors","nodeType","ELEMENT_NODE","parentNode","eIndex","classList","className","needMaskingText","maskTextClass","maskTextSelector","parentElement","contains","closest","matches","e","serializeNode","options","mirror","blockClass","blockSelector","inlineStylesheet","maskTextFn","_b","dataURLOptions","inlineImages","recordCanvas","keepIframeSrcFn","_c","newlyAddedElement","rootId","docId","undefined","getRootId","DOCUMENT_NODE","compatMode","Document","DOCUMENT_TYPE_NODE","DocumentType","publicId","systemId","needBlock","_isBlockedElement","HTMLFormElement","processedTagName","getValidTagName","attributes","len","i","attr","stylesheet","styleSheets","find","rel","_cssText","sheet","innerText","textContent","checked","selected","__context","canvas","ctx","getContext","x","width","y","height","getImageData","originalGetImageData","Uint32Array","Math","min","data","buffer","some","pixel","is2DCanvasBlank","rr_dataURL","toDataURL","quality","canvasDataURL","blankCanvas","image_1","oldValue_1","crossOrigin","recordInlineImage_1","removeEventListener","naturalWidth","naturalHeight","drawImage","err","console","warn","currentSrc","removeAttribute","complete","addEventListener","rr_mediaState","paused","rr_mediaCurrentTime","currentTime","scrollLeft","rr_scrollLeft","scrollTop","rr_scrollTop","_d","getBoundingClientRect","class","rr_width","rr_height","src","contentDocument","rr_src","Element","isSVG","serializeElementNode","TEXT_NODE","parentTagName","isStyle","isScript","nextSibling","previousSibling","Text","serializeTextNode","CDATA_SECTION_NODE","CDATA","COMMENT_NODE","Comment","lowerIfExists","maybeAttr","serializeNodeWithId","skipChild","slimDOMOptions","_e","_f","onSerialize","onIframeLoad","_g","iframeLoadTimeout","onStylesheetLoad","_h","stylesheetLoadTimeout","_j","_k","_l","preserveWhiteSpace","_serializedNode","sn","comment","script","as","endsWith","headFavicon","headMetaDescKeywords","headMetaSocial","property","headMetaRobots","headMetaHttpEquiv","headMetaAuthorship","headMetaVerification","slimDOMExcluded","serializedNode","assign","recordChild","isShadowHost","headWhitespace","bypassOptions","_m","serializedChildNode","isElement","_o","_p","isShadow","iframeEl","listener","win","contentWindow","readyState","fired","blankUrl","location","setTimeout","timer_1","clearTimeout","onceIframeLoaded","iframeDoc","serializedIframeNode","link","styleSheetLoadTimeout","styleSheetLoaded","timer","onceStylesheetLoaded","serializedLinkNode","on","fn","target","arguments","capture","passive","DEPARTED_MIRROR_ACCESS_WARNING","_mirror","throttle","func","wait","timeout","previous","_len","args","_key","now","Date","leading","remaining","context","apply","trailing","hookSetter","key","d","isRevoked","window","original","getOwnPropertyDescriptor","defineProperty","patch","source","replacement","wrapped","defineProperties","__rrweb_original__","enumerable","Proxy","Reflect","prop","receiver","nowTimestamp","getWindowScroll","left","scrollingElement","pageXOffset","documentElement","body","top","pageYOffset","getWindowHeight","innerHeight","clientHeight","getWindowWidth","innerWidth","clientWidth","isBlocked","isIgnored","isAncestorRemoved","legacy_isTouchEvent","event","changedTouches","isSerializedIframe","nodeName","isSerializedStylesheet","getAttribute","hasShadowRoot","getTime","StyleSheetMirror","_classCallCheck","styleIDMap","idStyleMap","_createClass","newId","getShadowHost","shadowHost","getRootNode","Node","DOCUMENT_FRAGMENT_NODE","shadowHostInDom","ownerDocument","rootShadowHost","getRootShadowHost","inDom","EventType","EventType2","IncrementalSource","IncrementalSource2","MouseInteractions","MouseInteractions2","PointerTypes","PointerTypes2","CanvasContext","CanvasContext2","isNodeInLinkedList","errorHandler","DoubleLinkedList","head","tail","position","Error","current","index","next","__ln","moveKey","parentId","MutationBuffer","frozen","locked","texts","removes","mapRemoves","movedMap","addedSet","Set","movedSet","droppedSet","unattachedDoc","processMutations","mutations","processMutation","emit","adds","addedIds","addList","getNextId","ns","nextId","pushAdd","addNode","currentN","iframeManager","addIframe","stylesheetManager","trackLinkElement","shadowDomManager","addShadowRoot","iframe","childSn","attachIframe","observeAttachShadow","attachLinkElement","shift","_step","_iterator","_createForOfIteratorHelper","done","isParentRemoved","f","_step2","_iterator2","isAncestorInSet","candidate","tailNode","_node","unhandledNode","removeNode","payload","filter","attribute","style","diffAsStr","styleDiff","unchangedAsStr","_unchangedStyles","mutationCb","m","oldValue","attributeName","item","setAttribute","implementation","createHTMLDocument","old","_Array$from","pname","newValue","getPropertyValue","newPriority","getPropertyPriority","_i2","_Array$from2","addedNodes","genAdds","removedNodes","nodeId","isSerialized","deepDelete","processedNodeManager","inOtherBuffer","targetId","delete","childN","_this2","canvasManager","freeze","unfreeze","lock","unlock","addsSet","_isParentRemoved","r","size","_isAncestorInSet","registerErrorHandler","handler","unregisterErrorHandler","callbackWrapper","cb","mutationBuffers","getEventTarget","path","composedPath","initMutationObserver","rootEl","mutationBuffer","init","mutationObserverCtor","MutationObserver","__rrMutationObserver","angularZoneSymbol","Zone","__symbol__","observer","bind","observe","attributeOldValue","characterData","characterDataOldValue","childList","subtree","initMouseInteractionObserver","_ref3","mouseInteractionCb","sampling","mouseInteraction","disableMap","handlers","currentPointerType","Number","isNaN","eventKey","eventName","pointerType","thisEventKey","Mouse","Touch","Pen","MouseDown","MouseUp","startsWith","Click","clientX","clientY","getHandler","PointerEvent","TouchStart","TouchEnd","h","initScrollObserver","_ref4","scrollCb","evt","defaultView","scrollLeftTop","scroll","wrapEventWithUserTriggeredFlag","v","enable","userTriggered","INPUT_TAGS","lastInputValueMap","getNestedCSSRulePositions","childRule","hasNestedCSSRule","parentRule","CSSGroupingRule","CSSMediaRule","CSSSupportsRule","CSSConditionRule","unshift","parentStyleSheet","recurse","getIdAndStyleId","styleMirror","styleId","ownerNode","initAdoptedStyleSheetObserver","_ref14","hostId","patchTarget","ShadowRoot","originalPropertyDescriptor","configurable","sheets","result","adoptStyleSheets","initObservers","o","hooks","currentWindow","mousemoveCb","viewportResizeCb","inputCb","mediaInteractionCb","styleSheetRuleCb","styleDeclarationCb","canvasMutationCb","fontCb","selectionCb","mutation","mousemove","viewportResize","input","mediaInteaction","styleSheetRule","styleDeclaration","canvasMutation","font","selection","mergeHooks","mutationObserver","mousemoveHandler","_ref","timeBaseline","threshold","callbackThreshold","mousemoveCallback","positions","wrappedCb","totalOffset","p","timeOffset","updatePosition","_ref2","DragEvent","Drag","MouseEvent","MouseMove","TouchMove","initMoveObserver","mouseInteractionHandler","scrollHandler","viewportResizeHandler","_ref5","_ref6","lastH","lastW","initViewportResizeObserver","inputHandler","_ref7","ignoreClass","ignoreSelector","userTriggeredOnInput","eventHandler","isTrusted","isChecked","cbWithDedup","querySelectorAll","lastInputValue","propertyDescriptor","HTMLInputElement","hookProperties","HTMLSelectElement","HTMLTextAreaElement","HTMLOptionElement","_toConsumableArray","initInputObserver","mediaInteractionHandler","_ref17","volume","muted","playbackRate","initMediaInteractionObserver","styleSheetObserver","_ref8","_ref9","CSSStyleSheet","insertRule","thisArg","argumentsList","_argumentsList","_slicedToArray","_getIdAndStyleId","replaceSync","deleteRule","_getIdAndStyleId2","_getIdAndStyleId3","_getIdAndStyleId4","supportedNestedCSSRuleTypes","canMonkeyPatchNestedCSSRule","unmodifiedFunctions","entries","_ref10","_ref11","typeKey","_argumentsList5","_getIdAndStyleId5","_getIdAndStyleId6","_ref12","_ref13","initStyleSheetObserver","adoptedStyleSheetObserver","styleDeclarationObserver","_ref15","_ref16","ignoreCSSAttributes","setProperty","CSSStyleDeclaration","_argumentsList7","priority","_getIdAndStyleId7","removeProperty","_getIdAndStyleId8","remove","initStyleDeclarationObserver","fontObserver","collectFonts","_ref18","fontMap","originalFontFace","FontFace","family","descriptors","fontFace","fontSource","Uint8Array","restoreHandler","fonts","initFontObserver","selectionObserver","param","collapsed","updateSelection","getSelection","isCollapsed","ranges","count","rangeCount","range","getRangeAt","startContainer","startOffset","endContainer","endOffset","start","end","initSelectionObserver","pluginHandlers","plugins","plugin","callback","b","disconnect","CrossOriginIframeMirror","generateIdFn","iframeIdToRemoteIdMap","iframeRemoteIdToIdMap","remoteId","idToRemoteMap","remoteToIdMap","idToRemoteIdMap","getIdToRemoteIdMap","remoteIdToIdMap","getRemoteIdToIdMap","ids","getRemoteId","IframeManager","iframes","crossOriginIframeMap","crossOriginIframeMirror","crossOriginIframeRootIdMap","wrappedEmit","recordCrossOriginIframes","crossOriginIframeStyleMirror","generateId","handleMessage","loadListener","isAttachIframe","adoptedStyleSheets","message","crossOriginMessageEvent","transformedEvent","transformCrossOriginEvent","isCheckout","FullSnapshot","replaceIdOnNode","patchRootIdOnNode","timestamp","IncrementalSnapshot","Mutation","Meta","Load","DomContentLoaded","Plugin","Custom","replaceIds","ViewportResize","MediaInteraction","MouseInteraction","Scroll","CanvasMutation","Input","StyleSheetRule","StyleDeclaration","replaceStyleIds","Font","Selection","AdoptedStyleSheet","styles","iframeMirror","obj","isArray","child","_this3","ShadowDomManager","shadowDoms","WeakSet","restoreHandlers","patchAttachShadow","iframeElement","manager","option","__awaiter","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","rejected","then","lookup","charCodeAt","canvasVarMap","saveWebGLVar","isInstanceOfWebGLObject","_typeof","list","ctor","contextMap","variableListFor","constructor","serializeArg","arg","Float32Array","Float64Array","Int32Array","Uint16Array","Int16Array","Int8Array","Uint8ClampedArray","rr_type","values","ArrayBuffer","base64","arraybuffer","bytes","encode","DataView","byteOffset","byteLength","HTMLImageElement","HTMLCanvasElement","ImageData","serializeArgs","supportedWebGLConstructorNames","initCanvasContextObserver","setPreserveDrawingBufferToTrue","contextType","ctxName","getNormalizedContextName","contextAttributes","preserveDrawingBuffer","splice","patchGLPrototype","getOwnPropertyNames","_loop","recordArgs","hookHandler","setter","createURL","sourcemapArg","enableUnicodeArg","sourcemap","enableUnicode","binaryString","atob","binaryView","String","fromCharCode","decodeBase64","blob","Blob","URL","createObjectURL","takeFullSnapshot","WorkerFactory","Worker","CanvasManager","pendingCanvasMutations","rafStamps","latestId","invokeId","_options$sampling","initCanvasMutationObserver","initCanvasFPSObserver","clear","resetObservers","fps","canvasContextReset","snapshotInProgressMap","worker","onmessage","_e$data","commands","rafId","timeBetweenSnapshots","lastSnapshotTime","requestAnimationFrame","takeCanvasSnapshots","matchedCanvas","searchCanvas","root","elem","_regeneratorRuntime","mark","_callee","bitmap","wrap","_context","prev","abrupt","getContextAttributes","COLOR_BUFFER_BIT","createImageBitmap","resizeWidth","resizeHeight","sent","postMessage","stop","cancelAnimationFrame","startRAFTimestamping","startPendingCanvasMutationFlusher","canvas2DReset","CanvasRenderingContext2D","initCanvas2DMutationObserver","canvasWebGL1and2Reset","WebGLRenderingContext","WebGL","WebGL2RenderingContext","WebGL2","initCanvasWebGLMutationObserver","flushPendingCanvasMutations","_this4","setLatestRAFTimestamp","_this5","flushPendingCanvasMutationFor","valuesWithType","rest","t","hasOwnProperty","getOwnPropertySymbols","propertyIsEnumerable","__rest","StylesheetManager","trackedLinkElements","adoptedStyleSheetCb","linkEl","trackStylesheetInLinkElement","adoptedStyleSheetData","styleIds","CSSRule","ProcessedNodeManager","nodeMap","loop","periodicallyClear","thisBuffer","buffers","wrapEvent","recording","record","checkoutEveryNms","checkoutEveryNth","_options$blockClass","_options$blockSelecto","_options$ignoreClass","_options$ignoreSelect","_options$maskTextClas","_options$maskTextSele","_options$inlineStyles","maskAllInputs","_maskInputOptions","_slimDOMOptions","packFn","_options$dataURLOptio","mousemoveWait","_options$recordCanvas","_options$recordCrossO","_options$recordAfter","recordAfter","_options$userTriggere","_options$collectFonts","_options$inlineImages","_options$keepIframeSr","_options$ignoreCSSAtt","inEmittingFrame","parent","passEmitsToParent","lastFullSnapshotEvent","color","date","email","month","number","search","tel","time","week","textarea","select","password","NodeList","DOMTokenList","_len2","_key2","TypeError","polyfill","incrementalSnapshotCount","eventProcessor","isFrozen","buf","exceedCount","exceedTime","wrappedMutationEmit","wrappedScrollEmit","wrappedCanvasMutationEmit","getMirror","nodeMirror","slimDOM","snapshot","initialOffset","addLoadListener","destroy","addCustomEvent","tag","freezePage","StackFrame","fileName","functionName","lineNumber","columnNumber","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","ErrorStackParser","parse","stacktrace","parseOpera","parseV8OrIE","parseFFOrSafari","extractLocation","urlLike","line","sanitizedLine","tokens","locationParts","functionNameRegex","parseOpera9","parseOpera11","parseOpera10","lineRE","lines","parseFloat","pathToSelector","outerHTML","localName","domSiblings","children","sibling","isObject","isObjTooDeep","limit","_keys","stringifyOptions","numOfKeysLimit","depthOfLimit","thisPos","Infinity","_obj","shouldIgnore","stringLengthLimit","Event","eventResult","eventValue","HTMLElement","defaultLogOptions","level","lengthThreshold","logger","initLogObserver","logOptions","loggerType","logCount","inStack","cancelHandlers","trace","stackFrame","unhandledrejectionHandler","reason","levelType","_logger","nativeIsArray","ObjProto","_isArray","_isFunction","_isObject","_isUndefined","_isString","_isNull","_isNullish","_isBoolean","_isDocument","_isFormData","FormData","global","globalThis","nativeForEach","navigator","fetch","XMLHttpRequest","AbortController","userAgent","assignableWindow","LOGGER_PREFIX","_log","consoleLog","info","_len3","_key3","_len4","_key4","critical","_console","_len5","_key5","uninitializedWarning","methodName","breaker","_each","iterator","l","_eachArray","pair","_formDataToQuery","formdata","use_val","use_key","arg_separator","tph_arr","val","encodeURIComponent","File","defaultNetworkOptions","initiatorTypes","maskRequestFn","recordHeaders","recordBody","recordInitialRequests","recordPerformance","performanceEntryTypeToObserve","payloadSizeLimitBytes","isNavigationTiming","entry","entryType","isResourceTiming","__posthog_wrapped__","_unused","findLast","array","predicate","initPerformanceObserver","initialPerformanceEntries","performance","getEntries","initiatorType","requests","flatMap","prepareRequest","isInitial","PerformanceObserver","performanceEntries","wrappedInitiatorFilter","entryTypes","supportedEntryTypes","shouldRecordHeaders","shouldRecordBody","headers","matchesContentType","contentTypes","contentTypeHeader","contentType","ct","recordBodyType","getRequestPerformanceEntry","_x","_x2","_x3","_x4","_x5","_getRequestPerformanceEntry","_asyncToGenerator","_callee2","after","before","attempt","urlPerformanceEntries","performanceEntry","_args2","_context2","getEntriesByName","startTime","_tryReadXHRBody","exposesServerTiming","method","status","networkRequest","timeOrigin","floor","_objectSpread","toJSON","round","endTime","responseEnd","requestHeaders","requestBody","responseHeaders","responseBody","serverTiming","timing","duration","contentTypePrefixDenyList","_checkForCannotReadResponseBody","_r$headers$get","contentTypeIsDenied","prefix","_tryReadBody","clone","txt","finally","_tryReadResponseBody","_x6","_tryReadResponseBody2","_callee3","cannotReadBodyReason","_context3","initNetworkObserver","networkOptions","request","maskedRequest","performanceObserver","xhrObserver","fetchObserver","recordRequestHeaders","recordResponseHeaders","restorePatch","originalOpen","async","username","xhr","req","Request","originalSetRequestHeader","setRequestHeader","header","originalSend","send","DONE","getAllResponseHeaders","response","catch","initXhrObserver","originalFetch","res","_res","finish","_x7","_x8","initFetchObserver","NETWORK_PLUGIN_NAME","getRecordNetworkPlugin","rrweb","rrwebRecord","version","rrwebVersion","rrwebConsoleRecord","getRecordConsolePlugin"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}